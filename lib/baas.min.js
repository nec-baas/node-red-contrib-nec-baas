/*!
 * NEC Mobile Backend Platform JavaScript SDK version 5.0.0
 *
 * Copyright (C) 2014-2016, NEC CORPORATION
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, 
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice, 
 *   this list of conditions and the following disclaimer in the documentation 
 *   and/or other materials provided with the distribution.
 * * Neither the name of the <organization> nor the names of its contributors 
 *   may be used to endorse or promote products derived from this software 
 *   without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";var XMLHttpRequest,localStorage;/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.2.1
 */
(function(){function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function r(e){Q=e}function n(e){W=e}function s(){return function(){process.nextTick(c)}}function o(){return function(){G(c)}}function i(){var e=0,t=new z(c),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function a(){var e=new MessageChannel;return e.port1.onmessage=c,function(){e.port2.postMessage(0)}}function u(){return function(){setTimeout(c,1)}}function c(){for(var e=0;V>e;e+=2){var t=ee[e],r=ee[e+1];t(r),ee[e]=void 0,ee[e+1]=void 0}V=0}function l(){try{var e=require,t=e("vertx");return G=t.runOnLoop||t.runOnContext,o()}catch(e){return u()}}function p(e,t){var r=this,n=new this.constructor(h);void 0===n[ne]&&A(n);var s=r._state;if(s){var o=arguments[s-1];W(function(){T(s,n,o,r._result)})}else B(r,n,e,t);return n}function f(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(h);return k(r,e),r}function h(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function _(e){try{return e.then}catch(e){return ae.error=e,ae}}function v(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function g(e,t,r){W(function(e){var n=!1,s=v(r,t,function(r){n||(n=!0,t!==r?k(e,r):N(e,r))},function(t){n||(n=!0,w(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&s&&(n=!0,w(e,s))},e)}function m(e,t){t._state===oe?N(e,t._result):t._state===ie?w(e,t._result):B(t,void 0,function(t){k(e,t)},function(t){w(e,t)})}function b(e,r,n){r.constructor===e.constructor&&n===te&&constructor.resolve===re?m(e,r):n===ae?w(e,ae.error):void 0===n?N(e,r):t(n)?g(e,r,n):N(e,r)}function k(t,r){t===r?w(t,d()):e(r)?b(t,r,_(r)):N(t,r)}function S(e){e._onerror&&e._onerror(e._result),C(e)}function N(e,t){e._state===se&&(e._result=t,e._state=oe,0!==e._subscribers.length&&W(C,e))}function w(e,t){e._state===se&&(e._state=ie,e._result=t,W(S,e))}function B(e,t,r,n){var s=e._subscribers,o=s.length;e._onerror=null,s[o]=t,s[o+oe]=r,s[o+ie]=n,0===o&&e._state&&W(C,e)}function C(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n,s,o=e._result,i=0;i<t.length;i+=3)n=t[i],s=t[i+r],n?T(r,n,s,o):s(o);e._subscribers.length=0}}function E(){this.error=null}function O(e,t){try{return e(t)}catch(e){return ue.error=e,ue}}function T(e,r,n,s){var o,i,a,u,c=t(n);if(c){if(o=O(n,s),o===ue?(u=!0,i=o.error,o=null):a=!0,r===o)return void w(r,y())}else o=s,a=!0;r._state!==se||(c&&a?k(r,o):u?w(r,i):e===oe?N(r,o):e===ie&&w(r,o))}function j(e,t){try{t(function(t){k(e,t)},function(t){w(e,t)})}catch(t){w(e,t)}}function P(){return ce++}function A(e){e[ne]=ce++,e._state=void 0,e._result=void 0,e._subscribers=[]}function I(e){return new de(this,e).promise}function L(e){var t=this;return new t(H(e)?function(r,n){for(var s=e.length,o=0;s>o;o++)t.resolve(e[o]).then(r,n)}:function(e,t){t(new TypeError("You must pass an array to race."))})}function R(e){var t=this,r=new t(h);return w(r,e),r}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this[ne]=P(),this._result=this._state=void 0,this._subscribers=[],h!==e&&("function"!=typeof e&&M(),this instanceof F?j(this,e):U())}function q(e,t){this._instanceConstructor=e,this.promise=new e(h),this.promise[ne]||A(this.promise),H(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?N(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&N(this.promise,this._result))):w(this.promise,D())}function D(){return new Error("Array Methods must be provided an Array")}function x(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;(!t||"[object Promise]"!==Object.prototype.toString.call(t.resolve())||t.cast)&&(e.Promise=he)}var J;J=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var G,Q,K,H=J,V=0,W=function(e,t){ee[V]=e,ee[V+1]=t,V+=2,2===V&&(Q?Q(c):K())},Y="undefined"!=typeof window?window:void 0,$=Y||{},z=$.MutationObserver||$.WebKitMutationObserver,X="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ee=new Array(1e3);K=X?s():z?i():Z?a():void 0===Y&&"function"==typeof require?l():u();var te=p,re=f,ne=Math.random().toString(36).substring(16),se=void 0,oe=1,ie=2,ae=new E,ue=new E,ce=0,le=I,pe=L,fe=R,he=F;F.all=le,F.race=pe,F.resolve=re,F.reject=fe,F._setScheduler=r,F._setAsap=n,F._asap=W,F.prototype={constructor:F,then:te,catch:function(e){return this.then(null,e)}};var de=q;q.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===se&&e>r;r++)this._eachEntry(t[r],r)},q.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===re){var s=_(e);if(s===te&&e._state!==se)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(r===he){var o=new r(h);b(o,e,s),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){t(e)}),t)}else this._willSettleAt(n(e),t)},q.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===se&&(this._remaining--,e===ie?w(n,r):this._result[t]=r),0===this._remaining&&N(n,this._result)},q.prototype._willSettleAt=function(e,t){var r=this;B(e,void 0,function(e){r._settledAt(oe,t,e)},function(e){r._settledAt(ie,t,e)})};var ye=x,_e={Promise:he,polyfill:ye};"function"==typeof define&&define.amd?define(function(){return _e}):"undefined"!=typeof module&&module.exports?module.exports=_e:"undefined"!=typeof this&&(this.ES6Promise=_e),ye()}).call(this),function(){var e=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},t=this;"undefined"!=typeof window&&null!==window||null==XMLHttpRequest&&(XMLHttpRequest=require("xhr2"));var r=function(e){"undefined"!=typeof console&&console.log("[BAAS ERROR] : "+e)},n=function(e){"debug"===x.getDebugMode()&&"undefined"!=typeof console&&console.log("[BAAS] : "+e)},s=function(e,t){n(t+"#invalid parameter.");var r=i(400,"Invalid Arguments","Invalid Arguments");return e&&e.error?void e.error(r):Promise.reject(r)},o=function(e,t){return t?void e.then(function(e){t.success&&t.success(e)}).catch(function(e){t.error&&t.error(e)}):e},i=function(e,t,r,n){var s=new Error(t+"("+e+")");return s.status=e,s.statusText=t,s.responseText=r,n&&(s.data=n),s},a=function(e){return e&&e.message?e.message:e},u=function(e){var t=typeof e;return e&&"object"===t||"function"===t},c=function(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var s=0,o=r;s<o.length;s++){var i=o[s];if(u(e[i])&&u(t[i])){if(!c(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1}return!0},l=function(){function e(e,t,r){this._onReadyStateChange=this._onReadyStateChange.bind(this),n("HttpRequest#start:path = "+t),this._service=e,this._httpRequest=null,this._url=this._service.getBaseUri(),r&&r.noprefix||(this._url+="/"+this._service.getRestApiVersion()+"/"+this._service.getTenantID()),this._url=encodeURI(this._url+t),this._headers=[],this._contentType=null,this._responseType=null,this._queryParams=null,this._data=null;var s=this._service.getCurrentUser();null===s?this._sessionToken=null:this._sessionToken=s.sessionToken}return e.prototype._createHttpRequest=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;throw new Error("No XMLHttpRequest")},e.prototype.execute=function(){var e=this;return new Promise(function(r,n){e._resolve=r,e._reject=n,e._headers["X-Application-Id"]=e._service.getAppID(),e._headers["X-Application-Key"]=e._service.getAppKey(),null!==e._contentType&&(e._headers["Content-Type"]=e._contentType),null!==e._sessionToken&&(e._headers["X-Session-Token"]=e._sessionToken);var s=e._url;if(e._queryParams){for(var o=[],i=0,a=Object.keys(e._queryParams);i<a.length;i++){var u=a[i];e._queryParams.hasOwnProperty(u)&&o.push(encodeURIComponent(u)+"="+encodeURIComponent(e._queryParams[u]))}o.length>0&&(s+="?"+o.join("&"))}var c;c=null==e._data?null:"string"==typeof e._data||"undefined"!=typeof Blob&&null!==Blob&&e._data instanceof Blob||"undefined"!=typeof Buffer&&null!==Buffer&&Buffer.isBuffer(e._data)?e._data:JSON.stringify(e._data),e._httpRequest=e._createHttpRequest(),e._httpRequest.open(e._method,s,!0),e._httpRequest.onreadystatechange=e._onReadyStateChange;for(var l=0,p=Object.keys(e._headers);l<p.length;l++){var u=p[l],f=e._headers[u];e._httpRequest.setRequestHeader(u,f)}try{var h=t.navigator.userAgent.toLowerCase();(h.match(/msie/)||h.match(/trident/))&&(e._httpRequest.setRequestHeader("Pragma","no-cache"),e._httpRequest.setRequestHeader("Cache-Control","no-cache"),e._httpRequest.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT"))}catch(e){}return null!=e._responseType&&(e._httpRequest.responseType=e._responseType),e._httpRequest.send(c)})},e.prototype._onReadyStateChange=function(){var e=this._httpRequest;if(4===e.readyState){if(e.status>=200&&e.status<300)return null!=e.response?this._resolve(e.response):this._resolve(e.responseText);var t=i(e.status,e.statusText,"");return"blob"!==e.responseType&&(t.responseText=e.responseText),0===e.status&&(t.statusText="Not Found",t.responseText="Not found anything that matches the request URI."),r("HTTP Request Error: "+t.message+" "+t.responseText),this._reject(t)}},e.prototype.setMethod=function(e){return this._method=e},e.prototype.setContentType=function(e){return this._contentType=e},e.prototype.setQueryParams=function(e){return this._queryParams=e},e.prototype.setQueryParam=function(e,t){return this._queryParams||(this._queryParams={}),this._queryParams[e]=t},e.prototype.setData=function(e){return this._data=e},e.prototype.setSessionToken=function(e){return this._sessionToken=e},e.prototype.setResponseType=function(e){return this._responseType=e},e.prototype.addRequestHeader=function(e,t){return void 0!==this._headers[e]&&n("HTTP Request Warning : This header already exists."),this._headers[e]=t},e}(),p=function(){function e(e,t){n("_SdeRequest(), className="+e+", methodName="+t),this._className=e,this._methodName=t,this._data=null}return e.prototype.setData=function(e){return this._data=e},e.prototype.execute=function(){var t={},r=new Promise(function(e,r){return t.success=e,t.error=r}),s=e._createRequestId();e._callbacks[s]=t,n("_SdeRequest.execute(), reqId="+s),null==this._data&&(this._data={});var o={data:this._data},i={action:this._className+"."+this._methodName,request_id:s,params:JSON.stringify(o),callback:"Nebula._SdeRequest.sdeCallback"};return n("_SdeRequest.execute(), sdeParams="+JSON.stringify(i)),sde.smt.common.exIfExecute("NebulaSdePlugin","execute",i),r},e._createRequestId=function(){for(var e=0;e<1e3;e++){var t="id_"+this._requestId;if(this._requestId++,this._requestId>=1e3&&(this._requestId=0),!this._callbacks[t])return n("_SdeRequest._createRequestId(), requestId="+t),t}throw n("FATAL Error: Nebula._SdeRequest._createRequestId(), callback slot full!"),"Could not create request ID, callback slot full!"},e.sdeCallback=function(t){try{n("_SdeRequest.sdeCallback()"),n("  params="+JSON.stringify(t)),n("  requestId="+t.requestId),n("  status="+t.status),n("  statusText="+t.statusText),n("  responseText="+t.responseText),n("  response="+t.response);var s=t.requestId;if(null!=s&&null!=e._callbacks[s]){var o=e._callbacks[s];n("  requestId="+s),n("  _callbacks[requestId]="+o);var a=t.status;if(a||(n("_SdeRequest.sdeCallback(), warning:: not found status property"),a=0),a>=200&&a<300)n("_SdeRequest.sdeCallback(), call success callback"),o.success(JSON.stringify(t.response));else{var u=i(t.status,t.statusText,t.responseText);n("Nebula._SdeRequest.sdeCallback(), call error callback: "+u.message+" "+u.responseText),o.error(u)}delete e._callbacks[s],n("_SdeRequest.sdeCallback(), _callbacks : "+JSON.stringify(e._callbacks))}else r("_SdeRequest.sdeCallback(), not found requestId="+s)}catch(e){r("_SdeRequest.sdeCallback(), e="+e)}},e}();p._callbacks={},p._requestId=0;var f=function(){function e(){}return e.setCallback=function(e){this._callback=e,n("_SdeNetworkEventListener.setCallback(), callback="+e);var t={};e?t.set=!0:t.set=!1;var r={params:JSON.stringify(t),callback:""};return n("_SdeNetworkEventListener.setCallback(), sdeParams="+JSON.stringify(r)),sde.smt.common.exIfExecute("NebulaNetworkEventManager","setNetworkEventListener",r)},e.onNetworkStateChanged=function(e){try{n("_SdeNetworkEventListener.onNetworkStateChanged(), params="+JSON.stringify(e)),null!=this._callback&&null!=this._callback.onNetworkStateChanged?null!=e.isOnline?this._callback.onNetworkStateChanged(e.isOnline):r("_SdeNetworkEventListener.onNetworkStateChanged(), invalid parameters"):n("_SdeNetworkEventListener.onNetworkStateChanged(), no callback")}catch(e){r("_SdeNetworkEventListener.onNetworkStateChanged(), exception="+e)}},e}(),h=function(){function e(){}return e.setListener=function(e,t){if(null==e)return void r("_SdeSyncEventListener.setCallback(), no bucket");n("_SdeSyncEventListener.setCallback(), before : _listeners="+JSON.stringify(this._listeners));var s=e.getBucketName(),o=e.getBucketMode();null==t?(this._listeners[s]=t,this._bucketMode[s]=o):(null!=this._listeners[s]&&delete this._listeners[s],null!=this._bucketMode[s]&&delete this._bucketMode[s]),n("_SdeSyncEventListener.setCallback(), after  : _listeners="+JSON.stringify(this._listeners));var i={};i.bucketName=s,i.bucketMode=o,t?i.set=!0:i.set=!1;var a={params:JSON.stringify(i),callback:""};return n("_SyncEventListener.setCallback(), sdeParams="+JSON.stringify(a)),sde.smt.common.exIfExecute("NebulaSyncEventManager","setSyncEventListener",a)},e.resolveConflict=function(e){n("_SyncEventListener.resolveConflict(), data="+e);var t={params:JSON.stringify(e),callback:""};return n("_SyncEventListener.resolveConflict(), sdeParams="+JSON.stringify(t)),sde.smt.common.exIfExecute("NebulaSyncEventManager","resolveConflict",t)},e.onSyncStart=function(t){try{if(n("_SdeSyncEventListener.onSyncStart(), params="+JSON.stringify(t)),null!=t.bucketName){var r=t.bucketName,s=e._listeners[r];s&&s.onSyncStart?s.onSyncStart(r):n("_SdeSyncEventListener.onSyncStart(), no callback or onSyncStart")}else n("_SdeSyncEventListener.onSyncStart(), no bucketName")}catch(e){n("_SdeSyncEventListener.onSyncStart(), exception="+e)}},e.onSyncCompleted=function(t){try{if(n("_SdeSyncEventListener.onSyncCompleted(), params="+JSON.stringify(t)),n("_SdeSyncEventListener.onSyncCompleted(), bucketName="+t.bucketName),n("_SdeSyncEventListener.onSyncCompleted(), objectIds="+t.objectIds),null!=t.bucketName&&null!=t.objectIds){var r=t.bucketName,s=e._listeners[r];s&&s.onSyncCompleted?s.onSyncCompleted(r,t.objectIds):n("_SdeSyncEventListener.onSyncCompleted(), no callback or onSyncCompleted")}else n("_SdeSyncEventListener.onSyncCompleted(), no bucketName or objectIds")}catch(e){n("_SdeSyncEventListener.onSyncCompleted(), exception="+e)}},e.onSyncConflicted=function(e){try{if(n("_SdeSyncEventListener.onSyncConflicted(), params="+JSON.stringify(e)),n("_SdeSyncEventListener.onSyncConflicted(), bucketName="+e.bucketName),n("_SdeSyncEventListener.onSyncConflicted(), resolveId="+e.resolveId),n("_SdeSyncEventListener.onSyncConflicted(), client="+e.client),n("_SdeSyncEventListener.onSyncConflicted(), server="+e.server),null!=e.bucketName&&null!=e.resolveId&&null!=e.client&&null!=e.server){var t=e.bucketName,r=this._bucketMode[t];null==r&&(r=x.BUCKET_MODE_REPLICA);var s=this._listeners[t];if(s&&s.onSyncConflicted){var o=new x.ObjectBucket(t,r);o._setResolveId(e.resolveId),s.onSyncConflicted(o,e.client,e.server)}else n("_SdeSyncEventListener.onSyncConflicted(), no callback or onSyncCompleted")}else n("_SdeSyncEventListener.onSyncConflicted(), invalid parameters")}catch(e){n("_SdeSyncEventListener.onSyncConflicted(), exception="+e)}},e.onResolveConflict=function(t){try{if(n("_SdeSyncEventListener.onResolveConflict(), params="+JSON.stringify(t)),n("_SdeSyncEventListener.onResolveConflict(), resolve="+t.resolve),n("_SdeSyncEventListener.onResolveConflict(), object="+t.object),null!=t.bucketName&&null!=t.resolve&&null!=t.object){var r=t.bucketName,s=e._listeners[r];s&&s.onResolveConflict?s.onResolveConflict(t.object,t.resolve):n("Nebula._SdeSyncEventListener.onResolveConflict(), no callback or onResolveConflict")}else n("_SdeSyncEventListener.onSyncConflicted(), invalid parameters")}catch(e){n("_SdeSyncEventListener.onResolveConflict(), exception="+e)}},e.onSyncError=function(t){try{if(n("_SdeSyncEventListener.onSyncError(), params="+JSON.stringify(t)),n("_SdeSyncEventListener.onSyncError(), errorCode="+t.errorCode),n("_SdeSyncEventListener.onSyncError(), object="+t.object),null!=t.bucketName&&null!=t.errorCode&&null!=t.object){var r=t.bucketName,s=e._listeners[r];null!=s&&null!=s.onSyncError?s.onSyncError(t.errorCode,t.object):n("_SdeSyncEventListener.onSyncError(), no callback or onSyncError")}else n("_SdeSyncEventListener.onSyncError(), invalid parameters")}catch(e){n("_SdeSyncEventListener.onSyncError(), exception="+e)}},e}();h._listeners={},h._bucketMode={};var d=function(){function e(){this.data={}}return e.prototype.getItem=function(e){return this.data[e]},e.prototype.setItem=function(e,t){return this.data[e]=t},e.prototype.removeItem=function(e){return delete this.data[e]},e}(),y=function(){function e(e){this.offline=!1,this.allowSelfSignedCert=!1,this.debugMode="release",null!==e&&(this.tenant=e.tenant,this.appId=e.appId,this.appKey=e.appKey,this.baseUri=e.baseUri,"/"===this.baseUri.slice(-1)&&(this.baseUri=this.baseUri.slice(0,-1)),void 0!==e.offline&&e.offline===!0&&(this.offline=e.offline),void 0!==e.allowSelfSignedCert&&e.allowSelfSignedCert===!0&&(this.allowSelfSignedCert=e.allowSelfSignedCert),void 0!==e.serviceId&&(this.serviceId=e.serviceId),void 0!==e.debugMode&&(this.debugMode=e.debugMode))}return e}(),_=function(){function e(){if(w(this),C(this),j(this),A(this),L(this),q(this),"undefined"!=typeof x)for(var e=0,t=Object.keys(x);e<t.length;e++){var r=t[e];r in this||(this[r]=x[r])}}return e.prototype.getRestApiVersion=function(){return 1},e.prototype.getTenantID=function(){return void 0===this._config?null:this._config.tenant},e.prototype.getBaseUri=function(){return void 0===this._config?null:this._config.baseUri},e.prototype.getAppID=function(){return void 0===this._config?null:this._config.appId},e.prototype.getAppKey=function(){return void 0===this._config?null:this._config.appKey},e.prototype.setAppKey=function(e){if(!this._config)throw new Error("Not initialized");return this._config.appKey=e},e.prototype.getServiceID=function(){return void 0===this._config?null:this._config.serviceId},e.prototype.getDebugMode=function(){return void 0===this._config?null:this._config.debugMode},e.prototype.isOffline=function(){return this._config.offline},e.prototype.isAllowSelfSignedCert=function(){return this._config.allowSelfSignedCert},e.prototype.getCurrentUser=function(){var e=this._localStorage.getItem(this._userItemKey());if(!e)return null;try{var t=JSON.parse(e);return"expire"in t&&!(t.expire<(new Date).getTime()/1e3)||(t=null),t}catch(e){return n("Nebula.getCurrentUser#"+e.message),null}},e.prototype.setCurrentUser=function(e){var t={_id:e.get("_id"),username:e.get("username"),email:e.get("email"),sessionToken:e.get("sessionToken"),expire:e.get("expire"),options:e.get("options"),groups:e.get("groups")};return this._localStorage.setItem(this._userItemKey(),JSON.stringify(t))},e.prototype.removeCurrentUser=function(){return this._localStorage.removeItem(this._userItemKey())},e.prototype._userItemKey=function(){var e=this.getServiceID();return void 0!==e?this.getTenantID()+"_"+this.getAppID()+"_"+e:(n("serviceId is 'undefined'"),this.getTenantID()+"_"+this.getAppID())},e.prototype.initialize=function(e){var t=this;if(this._config=new y(e),void 0===x._localStorage&&(this._localStorage=new d),this._config.offline){if(this!==x)throw new Error("No offline mode supported for multi-tenant instance.");try{var r=new p("Nebula","initialize"),s={tenant:this.getTenantID(),appId:this.getAppID(),appKey:this.getAppKey(),baseUri:this.getBaseUri(),offline:this.isOffline(),allowSelfSignedCert:this.isAllowSelfSignedCert(),debugMode:this.getDebugMode()};r.setData(s),r.execute().then(function(e){return n("Nebula.initialize#Success"),n("Nebula.initialize#response = "+e)}).catch(function(e){return n("Nebula.initialize#Error = "+a(e)),t._config.offline=!1})}catch(e){n("Nebula.initialize#"+e.message),this._config.offline=!1}}},e.prototype.setLoginCacheValidTime=function(e,t){if(n("Nebula.setLoginCacheValidTime#start"),e<=0)return s(t,"Nebula.setLoginCacheValidTime");var r=null;if(this.isOffline()){var u=new p("Nebula","setLoginCacheValidTime"),c={expire:e};u.setData(c),r=u.execute().then(function(){n("Nebula.setLoginCacheValidTime#Success")}).catch(function(e){return n("Nebula.setLoginCacheValidTime#error = "+a(e)),Promise.reject(e)})}else{n("Nebula.setLoginCacheValidTime#error online mode.");var l=i(400,"Disabled Offline","online mode.");r=Promise.reject(l)}return n("Nebula.setLoginCacheValidTime#end"),o(r,t)},e.prototype.getLoginCacheValidTime=function(e){n("Nebula.getLoginCacheValidTime#start");var t=null;if(this.isOffline()){var s=new p("Nebula","getLoginCacheValidTime");t=s.execute().then(function(e){n("Nebula.getLoginCacheValidTime#Success");var t;try{t=JSON.parse(e)}catch(e){r("Nebula.getLoginCacheValidTime#"+e.message),t=null}if(null!==t)return t.expire;var s=i(400,"Bad Response","Response json error.");return Promise.reject(s)}).catch(function(e){return n("Nebula.getLoginCacheValidTime#error callback start"),n("Nebula.getLoginCacheValidTime#error = "+a(e)),Promise.reject(e)})}else{n("Nebula.getLoginCacheValidTime#error online mode.");var u=i(400,"Disabled Offline","online mode.");t=Promise.reject(u)}return n("Nebula.getLoginCacheValidTime#end"),o(t,e)},e.prototype.setNetworkEventListener=function(e){n("Nebula.setNetworkEventListener#start");var t=!1;return 1===arguments.length&&(null!=e&&void 0!==e.onNetworkStateChanged&&(t=!0),null===e&&(t=!0)),t?(this.isOffline()?f.setCallback(e):n("Nebula.setNetworkEventListener#Disabled Offline"),n("Nebula.setNetworkEventListener#end")):void r("Nebula.setNetworkEventListener#invalid parameter.")},e}(),v={READ:"r",WRITE:"w",CREATE:"c",UPDATE:"u",DELETE:"d",ADMIN:"admin",OWNER:"owner"},g={AUTHENTICATED:"g:authenticated",ANONYMOUS:"g:anonymous"},m=function(){function e(t){n("Acl(), json="+t),this._acl={r:[],w:[],c:[],u:[],d:[],admin:[]},t&&(t[e.OWNER]&&(this._acl[e.OWNER]=t[e.OWNER]),t[e.READ]&&(this._acl[e.READ]=t[e.READ]),t[e.WRITE]&&(this._acl[e.WRITE]=t[e.WRITE]),t[e.CREATE]&&(this._acl[e.CREATE]=t[e.CREATE]),t[e.UPDATE]&&(this._acl[e.UPDATE]=t[e.UPDATE]),t[e.DELETE]&&(this._acl[e.DELETE]=t[e.DELETE]),t[e.ADMIN]&&(this._acl[e.ADMIN]=t[e.ADMIN]))}return e.prototype.addEntry=function(e,t){var r=this._acl[e];if(!r)return!1;if(!t)return!1;var s=null;s=t instanceof N?t.get("_id"):t instanceof B?"g:"+t.get("groupname"):t;for(var o=!1,i=0,a=r;i<a.length;i++){var u=a[i];if(u===s){o=!0;break}}return!o&&(r.push(s),n("Acl.addEntry(), added entry="+s),!0)},e.prototype.removeEntry=function(e,t){var r=this._acl[e];if(!r)return!1;if(!t)return!1;var s=null;s=t instanceof N?t.get("_id"):t instanceof B?"g:"+t.get("groupname"):t;for(var o=0;o<r.length;o++){var i=r[o];if(i===s){r.splice(o,1),n("Acl.removeEntry(), removed entry="+s);break}}},e.prototype._setOwner=function(t){this._acl[e.OWNER]=t},e.prototype.getOwner=function(){return this._acl[e.OWNER]?this._acl[e.OWNER]:null},e.prototype.getEntries=function(e){var t=this._acl[e];return t?t:null},e.prototype._set=function(e){this._acl=e},e.prototype._hasEntry=function(e,t){var r=this._acl[e];if(r)for(var n=0,s=r;n<s.length;n++){var o=s[n];if(o===t)return!0}return!1},e.prototype._toString=function(e){return JSON.stringify(this._toJsonObject(e))},e.prototype._toJsonObject=function(e){if("ACL"===e||"contentACL"===e){var t={};return t[e]=this._acl,t}return this._acl},e}();m.READ="r",m.WRITE="w",m.CREATE="c",m.UPDATE="u",m.DELETE="d",m.ADMIN="admin",m.OWNER="owner",m.AUTHENTICATED="g:authenticated",m.ANONYMOUS="g:anonymous";var b={CASE_INSENSITIVITY:"i"},k=function(){function e(e){null!=e?this._clause=e:this._clause={}}return e.prototype._setParams=function(e,t,r,n){if(null===t)this._clause[e]=r;else{var s={};u(this._clause[e])&&(s=this._clause[e]),s[t]=r,n&&(s.$options=n),this._clause[e]=s}return this},e.prototype.json=function(){return this._clause},e.equals=function(t,r){return(new e).equals(t,r)},e.prototype.equals=function(e,t){var r=null;return null!=t&&u(t)&&(r="$eq"),this._setParams(e,r,t)},e.notEquals=function(t,r){return(new e).notEquals(t,r)},e.prototype.notEquals=function(e,t){return this._setParams(e,"$ne",t)},e.lessThan=function(t,r){return(new e).lessThan(t,r)},e.prototype.lessThan=function(e,t){return this._setParams(e,"$lt",t)},e.lessThanOrEqual=function(t,r){return(new e).lessThanOrEqual(t,r)},e.prototype.lessThanOrEqual=function(e,t){return this._setParams(e,"$lte",t)},e.greaterThan=function(t,r){return(new e).greaterThan(t,r)},e.prototype.greaterThan=function(e,t){return this._setParams(e,"$gt",t)},e.greaterThanOrEqual=function(t,r){return(new e).greaterThanOrEqual(t,r)},e.prototype.greaterThanOrEqual=function(e,t){return this._setParams(e,"$gte",t)},e.in=function(t,r){return(new e).in(t,r)},e.prototype.in=function(e,t){return this._setParams(e,"$in",t)},e.all=function(t,r){return(new e).all(t,r)},e.prototype.all=function(e,t){return this._setParams(e,"$all",t)},e.exist=function(t,r){return(new e).exist(t,r)},e.prototype.exist=function(e,t){if("boolean"==typeof t)return this._setParams(e,"$exists",t);throw"exist: value is not boolean"},e.regex=function(t,r,n){return(new e).regex(t,r,n)},e.prototype.regex=function(e,t,r){return this._setParams(e,"$regex",t,r)},e.prototype.not=function(e){var t;return null===this._clause||null==this._clause[e]?null:(u(this._clause[e])?(t={$not:this._clause[e]},this._clause[e]=t):(t={$not:{$eq:this._clause[e]}},this._clause[e]=t),this)},e.and=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e._convertClauseArray(t);return(new e)._setParams("$and",null,n)},e.or=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e._convertClauseArray(t);return(new e)._setParams("$or",null,n)},e._convertClauseArray=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var s=n[r],o=s.json();null!=o&&t.push(o)}return t},e}(),S=function(){function e(){this._clause=null,this._limit=-1,this._skip=0,this._sort=[],this._deleteMark=!1,this._countQuery=!1,this._projection=null}return e.prototype.getClause=function(){return this._clause},e.prototype.getLimit=function(){return this._limit},e.prototype.getSkipCount=function(){return this._skip},e.prototype.getSortOrder=function(){return this._sort},e.prototype._getDeleteMark=function(){return this._deleteMark},e.prototype.getProjection=function(){return this._projection},e.prototype._setDeleteMark=function(e){if("boolean"!=typeof e)throw new Error("deleteMark must be boolean");n("ObjectQuery._setDeleteMark(), mark="+e+", cur="+this._deleteMark),this._deleteMark=e},e.prototype._toParam=function(){var e=this._toParamJson();return e.where&&(e.where=JSON.stringify(e.where)),e.projection&&(e.projection=JSON.stringify(e.projection)),e},e.prototype._toParamJson=function(){var e={};this._clause&&(e.where=this._clause.json());for(var t=[],r=0;r<this._sort.length;r++){var n=this._sort[r],s=Object.keys(n)[0];void 0!==s&&(n[s]===!0?t.push(s):t.push("-"+s))}return t.length>0&&(e.order=t.join(",")),e.skip=this._skip,e.limit=this._limit,this._countQuery&&(e.count=1),this._deleteMark&&(e.deleteMark=1),this._projection&&(e.projection=this._projection),e},e._toObjectQuery=function(t){var r=new e;if(n("ObjectQuery._toObjectQuery(), queryJson="+JSON.stringify(t)),null!=t.limit&&r.setLimit(t.limit),null!=t.skip&&r.setSkipCount(t.skip),null!=t.sort)for(var s=0,o=Object.keys(t.sort);s<o.length;s++){var i=o[s];r.setSortOrder(i,t.sort[i])}if(null!=t.clause&&0!==Object.keys(t.clause).length){var a=new k(t.clause);r.setClause(a)}return null!=t.deleteMark&&r._setDeleteMark(t.deleteMark),null!=t.countQuery&&r._setCountQuery(t.countQuery),r},e.prototype._equals=function(e){if(this._limit!==e.getLimit())return!1;if(this._skip!==e.getSkipCount())return!1;if(this._deleteMark!==e._getDeleteMark())return!1;if(this._countQuery!==e._isCountQuery())return!1;if(this._projection){if(!e.getProjection())return!1;if(!c(this._projection,e.getProjection()))return!1}else if(e.getProjection())return!1;if(this._clause){if(!e.getClause())return!1;if(!c(this._clause.json(),e.getClause().json()))return!1}else if(e.getClause())return!1;return c(this._sort,e.getSortOrder())},e.prototype.setClause=function(e){if(e&&e instanceof k)this._clause=e;else{if(null!==e)throw new Error("clause must be instanceof Nebula.Clause or null");this._clause=null}return this},e.prototype.setLimit=function(e){if(!(e>=-1))throw new Error("Invalid limit range");return this._limit=e,this},e.prototype.setSkipCount=function(e){if(!(e>=0))throw new Error("Invalid skip range");return this._skip=e,this},e.prototype.setSortOrder=function(e,t){if(!e)throw new Error("No key");if("boolean"!=typeof t)throw new Error("isAsc must be boolean");var r={};r[e]=t;for(var n=0;n<this._sort.length;n++){var s=this._sort[n];if(e in s)return this._sort[n]=r,this}return this._sort.push(r),this},e.prototype.clearSortOrder=function(e){if(!e)throw new Error("No key");for(var t=0;t<this._sort.length;t++){var r=this._sort[t];if(e in r){this._sort.splice(t,1);break}}return this},e.prototype._setCountQuery=function(e){if("boolean"!=typeof e)throw new Error("countQuery must be boolean");return this._countQuery=e,this},e.prototype._isCountQuery=function(){return this._countQuery},e.prototype.setProjection=function(e){if(e&&u(e))this._projection=e;else{if(null!==e)throw new Error("projection must be object or null");this._projection=null}return this},e}(),N=function(){function e(e){this._service=e,this.__id=null,this._username=null,this._email=null,this._password=null,this._options=null,this._groups=null,this._createdAt=null,this._updatedAt=null,this._sessionToken=null,this._expire=null}return Object.defineProperty(e.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"email",{get:function(){return this._email},set:function(e){this._email=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"password",{get:function(){return this._password},set:function(e){this._password=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatedAt",{get:function(){return this._updatedAt;
},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionToken",{get:function(){return this._sessionToken},set:function(e){this._sessionToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expire",{get:function(){return this._expire},set:function(e){this._expire=e},enumerable:!0,configurable:!0}),e.prototype._setUserInfo=function(e){n("User._setUserInfo#start");var t;try{t=JSON.parse(e)}catch(e){r("User._setUserInfo#json error."),t=null}if(null!==t&&(void 0!==t._id&&(this._id=t._id),void 0!==t.username&&(this.username=t.username),void 0!==t.email&&(this.email=t.email),void 0!==t.password&&(this.password=t.password),void 0!==t.options&&(this.options=t.options),void 0!==t.groups&&(this.groups=t.groups),void 0!==t.createdAt&&(this.createdAt=t.createdAt),void 0!==t.updatedAt&&(this.updatedAt=t.updatedAt),void 0!==t.sessionToken&&(this.sessionToken=t.sessionToken),void 0!==t.expire))return this.expire=t.expire},e.prototype.set=function(e,t){switch(e){case"_id":this._id=t;break;case"username":this.username=t;break;case"email":this.email=t;break;case"password":this.password=t;break;case"options":this.options=t;break;case"createdAt":this.createdAt=t;break;case"updatedAt":this._updatedAt=t;break;case"sessionToken":this.sessionToken=t;break;case"expire":this.expire=t;break;default:throw r("Invalid property: "+e),new Error("Invalid property: "+e)}},e.prototype.get=function(e){switch(e){case"_id":return this._id;case"username":return this.username;case"email":return this.email;case"password":return this.password;case"options":return this.options;case"groups":return this.groups;case"createdAt":return this.createdAt;case"updatedAt":return this.updatedAt;case"sessionToken":return this.sessionToken;case"expire":return this.expire;default:throw r("Invalid property"),new Error("Invalid property name")}},e.prototype.register=function(e){var t=this;n("User.register#start");var r;if(this._service.isOffline())r=new p("NebulaUser","register");else{var s="/users";n("User.register#REST API Request path = "+s),r=new l(this._service,s),r.setMethod("POST"),r.setContentType("application/json")}var i;i=null===this.username?{email:this.email,password:this.password}:{email:this.email,password:this.password,username:this.username},null!==this.options&&(i.options=this.options),r.setData(i);var u=r.execute().then(function(e){return n("User.register#success callback start"),n("User.register#response = "+e),t._setUserInfo(e),t}).catch(function(e){return n("User.register#error callback start"),n("User.register#error = "+a(e)),Promise.reject(e)});return n("User.register#end"),o(u,e)},e._login=function(e,t,r){n("User.login#start");var i=null!=t&&(void 0!==t.email||void 0!==t.username||void 0!==t.password);if(!i)return s(r,"User.login");var u;if(e.isOffline())u=new p("NebulaUser","login");else{var c="/login";n("User.login#REST API Request path = "+c),u=new l(e,c),u.setSessionToken(null),u.setMethod("POST"),u.setContentType("application/json")}var f,h=new e.User;void 0!==t.email&&void 0!==t.username?(f={email:t.email,password:t.password,username:t.username},h.set("email",t.email),h.set("username",t.username)):void 0!==t.email&&void 0===t.username?(f={email:t.email,password:t.password},h.set("email",t.email)):void 0===t.email&&void 0!==t.username&&(f={username:t.username,password:t.password},h.set("username",t.username)),u.setData(f);var d=u.execute().then(function(t){return n("User.login#success callback start"),n("User.login#response = "+t),h._setUserInfo(t),e.setCurrentUser(h),h}).catch(function(e){return n("User.login#error callback start"),n("User.login#error = "+a(e)),Promise.reject(e)});return n("User.login#end"),o(d,r)},e._logout=function(e,t){n("User.logout#start");var r;if(e.isOffline())r=new p("NebulaUser","logout");else{var s="/login";n("User.logout#REST API Request path = "+s),r=new l(e,s),r.setMethod("DELETE"),r.setContentType("application/json")}var i=r.execute().then(function(t){n("User.logout#success callback start"),n("User.logout#response = "+t),e.removeCurrentUser()}).catch(function(t){return n("User.logout#error callback start"),n("User.logout#error = "+a(t)),e.removeCurrentUser(),Promise.reject(t)});return n("User.logout#end"),o(i,t)},e._current=function(e,t){var r=null,n=e.getCurrentUser();return null!==n&&(r=new e.User,r._setUserInfo(JSON.stringify(n))),t&&t.success&&t.success(r),r},e._saveCurrent=function(e,t){if(e.isOffline())throw new Error("Not supported in offline mode");if(null===t)return e.removeCurrentUser();var r=e.getCurrentUser()||{};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);var s=new e.User;return s._setUserInfo(JSON.stringify(r)),e.setCurrentUser(s)},e._queryCurrent=function(e,t){n("User.queryCurrent#start");var r=e.getCurrentUser();if(null===r)return o(Promise.resolve(null),t);var s;if(e.isOffline())s=new p("NebulaUser","current");else{var i="/users/current";n("User.queryCurrent#REST API Request path = "+i),s=new l(e,i),s.setSessionToken(r.sessionToken),s.setMethod("GET"),s.setContentType("application/json")}var u=s.execute().then(function(t){n("User.queryCurrent#success callback start"),n("User.queryCurrent#response = "+t);var r=new e.User;return r._setUserInfo(t),r}).catch(function(e){return n("User.queryCurrent#error callback start"),n("User.queryCurrent#error = "+a(e)),Promise.reject(e)});return n("User.queryCurrent#end"),o(u,t)},e._query=function(e,t,r){n("User.query#start");var s;if(e.isOffline())s=new p("NebulaUser","query"),null!==t&&s.setData(t);else{var u="/users",c={};try{t&&(t._id?u="/users/"+encodeURIComponent(t._id):t.email?c.email=t.email:t.username&&(c.username=t.username),t.skip&&(c.skip=t.skip),t.limit&&(c.limit=t.limit))}catch(e){var f=i(400,"Bad Request",e);return o(Promise.reject(f),r)}n("User.query#REST API Request path = "+u),s=new l(e,u),s.setMethod("GET"),s.setQueryParams(c),s.setContentType("application/json")}var h=s.execute().then(function(r){n("User.query#success callback start"),n("User.query#response = "+r);var s=JSON.parse(r),o=[],i=[],a=0;for(void 0===s.results?o.push(s):o=s.results;a<o.length;){var u=new e.User;u._setUserInfo(JSON.stringify(o[a])),i.push(u),a++}return null!=t&&t.countQuery?{users:i,count:s.count}:i}).catch(function(e){return n("User.query#error callback start"),n("User.query#error = "+a(e)),Promise.reject(e)});return n("User.query#end"),o(h,r)},e._update=function(t,r,n){return r instanceof e?r._service!==t?s(n,"Service does not match"):r._update(n):s(n,"Invalid user")},e.prototype._update=function(e){var t,r,s,u=this;if(n("User.update#start"),null===this.get("_id"))return n("User.logout#invalid user."),s=i(404,"Not Found","invalid user id."),o(Promise.reject(s),e);var c={};this._service.isOffline()?(r=new p("NebulaUser","update"),c._id=this.get("_id")):(t="/users/"+this.get("_id"),n("User.update#REST API Request path = "+t),r=new l(this._service,t),r.setMethod("PUT"),r.setContentType("application/json"),delete c._id),null!==this.get("email")&&(c.email=this.get("email")),null!==this.get("username")&&(c.username=this.get("username")),null!==this.get("password")&&(c.password=this.get("password")),null!==this.get("options")&&(c.options=this.get("options")),r.setData(c);var f=r.execute().then(function(e){return n("User.update#success callback start"),n("User.update#response = "+e),u._setUserInfo(e),u}).catch(function(e){return n("User.update#error callback start"),n("User.update#error = "+a(e)),Promise.reject(e)});return n("User.update#end"),o(f,e)},e._remove=function(t,r,n){return r instanceof e?r._service!==t?s(n,"User.remove"):r._remove(n):s(n,"User.remove")},e.prototype._remove=function(e){var t=this;if(n("User.remove#start"),null===this.get("_id")){n("User.remove#invalid user.");var r=i(404,"Not Found","invalid user id.");return o(Promise.reject(r),e)}var s;if(this._service.isOffline())s=new p("NebulaUser","delete"),s.setData({_id:this.get("_id")});else{var u="/users/"+this.get("_id");n("User.remove#REST API Request path = "+u),s=new l(this._service,u),s.setMethod("DELETE")}var c=s.execute().then(function(e){n("User.remove#success callback start"),n("User.remove#response = "+e);var r=t._service.getCurrentUser();null!==r&&t.get("_id")===r._id&&(n("User.remove#delete user is current user"),t._service.removeCurrentUser())}).catch(function(e){return n("User.remove#error callback start"),n("User.remove#error = "+a(e)),Promise.reject(e)});return n("User.remove#end"),o(c,e)},e._resetPassword=function(e,t,r){n("User.resetPassword#start");var i=null!=t&&(void 0!==t.email||void 0!==t.username);if(!i)return s(r,"User.login");var u;if(e.isOffline())u=new p("NebulaUser","resetPassword");else{var c="/request_password_reset";n("User.resetPassword#REST API Request path = "+c),u=new l(e,c),u.setSessionToken(null),u.setMethod("POST"),u.setContentType("application/json")}var f;void 0!==t.email&&void 0!==t.username?f={email:t.email,username:t.username}:void 0!==t.email&&void 0===t.username?f={email:t.email}:void 0===t.email&&void 0!==t.username&&(f={username:t.username}),u.setData(f);var h=u.execute().then(function(e){n("User.resetPassword#success callback start"),n("User.resetPassword#response = "+e)}).catch(function(e){return n("User.resetPassword#error callback start"),n("User.resetPassword#error = "+a(e)),Promise.reject(e)});return n("User.delete#end"),o(h,r)},e}(),w=function(t){t.User=(r=function(r){function s(){var e=this;return n("User.constructor#start"),e=r.call(this,t)||this}return e(s,r),s.prototype.set=function(e,t){return r.prototype.set.call(this,e,t)},s.prototype.get=function(e){return r.prototype.get.call(this,e)},s.prototype.register=function(e){return r.prototype.register.call(this,e)},s.login=function(e,n){return r._login.call(this,t,e,n)},s.logout=function(e){return r._logout.call(this,t,e)},s.current=function(e){return r._current.call(this,t,e)},s.saveCurrent=function(e){return r._saveCurrent.call(this,t,e)},s.queryCurrent=function(e){return r._queryCurrent.call(this,t,e)},s.query=function(e,n){return r._query.call(this,t,e,n)},s.update=function(e,n){return r._update.call(this,t,e,n)},s.remove=function(e,n){return r._remove.call(this,t,e,n)},s.resetPassword=function(e,n){return r._resetPassword.call(this,t,e,n)},s}(N),r.delete=r.remove,r);var r},B=function(){function e(e,t){this._service=e,this._id=null,this.groupname=null,this.users=[],this.groups=[],this.acl=null,this.createdAt=null,this.updatedAt=null,this.etag=null,"string"==typeof t&&""!==t&&(this.groupname=t)}return Object.defineProperty(e.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupname",{get:function(){return this._groupname},set:function(e){this._groupname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"users",{get:function(){return this._users},set:function(e){this._users=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acl",{get:function(){return this._acl},set:function(e){this._acl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatedAt",{get:function(){return this._updatedAt},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"etag",{get:function(){return this._etag},set:function(e){this._etag=e},enumerable:!0,configurable:!0}),e.prototype._setGroupInfo=function(e){var t;try{t=JSON.parse(e)}catch(e){return void r("Group._setGroupInfo#json error.")}if(void 0!==t._id&&(this._id=t._id),void 0!==t.name&&(this.groupname=t.name),void 0!==t.users&&(this.users=t.users),void 0!==t.groups&&(this.groups=t.groups),void 0!==t.ACL&&(this.acl=new m,this.acl._set(t.ACL),void 0!==t.ACL[m.OWNER]&&this.acl._setOwner(t.ACL[m.OWNER])),void 0!==t.createdAt&&(this.createdAt=t.createdAt),void 0!==t.updatedAt&&(this.updatedAt=t.updatedAt),void 0!==t.etag)return this.etag=t.etag},e.prototype.set=function(e,t){switch(e){case"_id":this._id=t;break;case"groupname":this.groupname=t;break;case"users":this.users=t;break;case"groups":this.groups=t;break;case"acl":this.acl=t;break;case"createdAt":this.createdAt=t;break;case"updatedAt":this.updatedAt=t;break;case"etag":this.etag=t;break;default:throw r("Invalid property: "+e),new Error("Invalid property: "+e)}},e.prototype.get=function(e){switch(e){case"_id":return this._id;case"groupname":return this.groupname;case"users":return this.users;case"groups":return this.groups;case"acl":return this.acl;case"createdAt":return this.createdAt;case"updatedAt":return this.updatedAt;case"etag":return this.etag;default:throw r("Invalid property: "+e),new Error("Invalid property: "+e)}},e.prototype.addEntry=function(e){n("Group.addEntry#start");var t=[],s=null;if(e instanceof this._service.User)s=e.get("_id"),t=this.users;else{if(!(e instanceof this._service.Group))return r("Invalid entry"),!1;s=e.get("groupname"),t=this.groups}for(var o=!1,i=0,a=t;i<a.length;i++){var u=a[i];u===s&&(o=!0)}return o||t.push(s),n("Group.addEntry#end"),!0},e.prototype.removeEntry=function(e){n("Group.removeEntry#start");var t=[],s=null;if(e instanceof this._service.User)s=e.get("_id"),t=this.users;else{if(!(e instanceof this._service.Group))return r("Invalid entry"),!1;s=e.get("groupname"),t=this.groups}for(var o=0;o<t.length;o++)if(t[o]===s){t.splice(o,1);break}return n("Group.removeEntry#end"),!0},e.prototype.save=function(e){var t=this;if(n("Group.save#start"),null==this.groupname)return s(e,"User.register");var r,i={};if(this._service.isOffline())r=new p("NebulaGroup","save"),i.groupname=this.groupname,null!=this.etag&&(i.etag=this.etag);else{var u="/groups/"+this.groupname;n("Group.save#REST API Request path = "+u),r=new l(this._service,u),null!=this.etag&&r.setQueryParam("etag",this.etag),r.setMethod("PUT"),r.setContentType("application/json")}i.users=this.users,i.groups=this.groups,null!==this.acl&&this.acl instanceof m&&(i.ACL=this.acl._toJsonObject()),r.setData(i);var c=r.execute().then(function(e){return n("Group.save#success callback start"),n("Group.save#response = "+e),t._setGroupInfo(e),t}).catch(function(e){return n("Group.save#error callback start"),n("Group.save#error = "+a(e)),Promise.reject(e)});return n("Group.save#end"),o(c,e)},e._remove=function(t,r,n){return r instanceof e?r._service!==t?s(n,"Service does not match"):r._remove(n):s(n,"Group.delete")},e.prototype._remove=function(e){n("Group.delete#start");var t,r;if(this._service.isOffline()){t=new p("NebulaGroup","delete"),r={groupname:this.get("groupname")};var s=this.get("etag");null!=s&&(r.etag=s),t.setData(r)}else{var i="/groups/"+this.get("groupname");n("Group.delete#REST API Request path = "+i),t=new l(this._service,i);var s=this.get("etag");null!=s&&t.setQueryParam("etag",s),t.setMethod("DELETE")}var u=t.execute().then(function(e){n("Group.delete#success callback start"),n("Group.delete#response = "+e)}).catch(function(e){return n("Group.delete#error callback start"),n("Group.delete#error = "+a(e)),Promise.reject(e)});return n("Group.delete#end"),o(u,e)},e._query=function(e,t,r){if(n("Group.query#start"),!(null===t||t&&null!=t.groupname))return s(r,"Group.query");var i;if(e.isOffline())i=new p("NebulaGroup","query"),null!==t&&void 0!==t.groupname&&i.setData({groupname:t.groupname});else{var u=void 0;u=null!==t&&void 0!==t.groupname?"/groups/"+t.groupname:"/groups",n("Group.query#REST API Request path = "+u),i=new l(e,u),i.setMethod("GET"),i.setContentType("application/json")}var c=i.execute().then(function(t){n("Group.query#response = "+t);var r=JSON.parse(t),s=[],o=[];void 0===r.results?s.push(r):s=r.results;for(var i=0,a=s;i<a.length;i++){var u=a[i],c=new e.Group(u.name);c._setGroupInfo(JSON.stringify(u)),o.push(c)}return o}).catch(function(e){return n("Group.query#error = "+a(e)),Promise.reject(e)});return n("Group.query#end"),o(c,r)},e}(),C=function(t){t.Group=(r=function(r){function s(e){var s=this;return n("Group.constructor#start"),s=r.call(this,t,e)||this}return e(s,r),s.prototype.set=function(e,t){return r.prototype.set.call(this,e,t)},s.prototype.get=function(e){return r.prototype.get.call(this,e)},s.prototype.addEntry=function(e){return r.prototype.addEntry.call(this,e)},s.prototype.removeEntry=function(e){return r.prototype.removeEntry.call(this,e)},s.prototype.save=function(e){return r.prototype.save.call(this,e)},s.remove=function(e,n){return r._remove.call(this,t,e,n)},s.query=function(e,n){return r._query.call(this,t,e,n)},s}(B),r.delete=r.remove,r);var r},E=function(){function e(){this._createdAt=null,this._updatedAt=null,this._acl=null,this._contentType=null,this._publicUrl=null,this._fileName=null,this._fileSize=-1,this._syncState=e.SYNC_STATE_UNDEFINED,this._lastSyncTime=null,this._metaId=null,this._metaETag=null,this._fileETag=null,this._cacheDisabled=!1}return e.prototype.getFileName=function(){return this._fileName},e.prototype.setFileName=function(e){return n("FileMetadata.setFileName(), "+this._fileName+" ---> "+e),this._fileName=e},e.prototype.getAcl=function(){return this._acl},e.prototype.setAcl=function(e){if(n("FileMetadata.setAcl(), cur: "+(null===this._acl?"null":this._acl._toString())),n("FileMetadata.setAcl(), new: "+(e instanceof m?e._toString():"invalid acl")),e instanceof m)return this._acl=e},e.prototype.getContentType=function(){return this._contentType},e.prototype.setContentType=function(e){return n("FileMetadata.setContentType(), "+this._contentType+" -> "+e),this._contentType=e},e.prototype.getCreatedAt=function(){return this._createdAt},e.prototype._setCreatedAt=function(e){return this._createdAt=e},e.prototype.getUpdatedAt=function(){return this._updatedAt},e.prototype._setUpdatedAt=function(e){return this._updatedAt=e},e.prototype.getSize=function(){return this._fileSize},e.prototype._setSize=function(e){return this._fileSize=e},e.prototype.getPublicUrl=function(){return this._publicUrl},e.prototype._setPublicUrl=function(e){return this._publicUrl=e},e.prototype.getFileSyncState=function(){return this._syncState},e.prototype._setFileSyncState=function(e){return this._syncState=e},e.prototype.getLastSyncTime=function(){return this._lastSyncTime},e.prototype._setLastSyncTime=function(e){return this._lastSyncTime=e},e.prototype.getMetaId=function(){return this._metaId},e.prototype._setMetaId=function(e){return this._metaId=e},e.prototype.getMetaETag=function(){return this._metaETag},e.prototype._setMetaETag=function(e){return this._metaETag=e},e.prototype.getFileETag=function(){return this._fileETag},e.prototype._setFileETag=function(e){return this._fileETag=e},e.prototype.isCacheDisabled=function(){return this._cacheDisabled},e.prototype.setCacheDisabled=function(e){return this._cacheDisabled=e},e.prototype._setMetadata=function(e){if(null!=e.filename&&this.setFileName(e.filename),null!=e.contentType&&this.setContentType(e.contentType),null!=e.ACL){var t=new m(e.ACL);this.setAcl(t)}if(null!=e.length&&this._setSize(e.length),null!=e.publicUrl&&this._setPublicUrl(e.publicUrl),null!=e.createdAt&&this._setCreatedAt(e.createdAt),null!=e.updatedAt&&this._setUpdatedAt(e.updatedAt),null!=e.lastSyncTime&&this._setLastSyncTime(e.lastSyncTime),null!=e.metaId&&this._setMetaId(e.metaId),null!=e.metaETag&&this._setMetaETag(e.metaETag),null!=e.fileETag&&this._setFileETag(e.fileETag),null!=e.cacheDisabled&&this.setCacheDisabled(e.cacheDisabled),null!=e.fileSyncState)return this._setFileSyncState(e.fileSyncState)},e}();E.SYNC_STATE_UNDEFINED=-1,E.SYNC_STATE_SYNCED=0,E.SYNC_STATE_DIRTY=1,E.SYNC_STATE_SYNCING=3,E.SYNC_STATE_CONFLICTED=5;var O=function(){function e(e,t,r,n){void 0===n&&(n=x.BUCKET_MODE_ONLINE),this._service=e,this._type=r,this._name=t,this._acl=null,this._contentAcl=null,this._description=null,n!==x.BUCKET_MODE_ONLINE&&n!==x.BUCKET_MODE_REPLICA&&n!==x.BUCKET_MODE_LOCAL?this._mode=x.BUCKET_MODE_ONLINE:this._mode=n}return e._loadBucket=function(t,r,s,u,c){n("BaseBucket.loadBucket(), name="+r+", type="+s+", callbacks="+c+", mode="+u);var f;if(t.isOffline()){f=new p(e.getClassName(s),"loadBucket");var h={bucketName:r};u!==x.BUCKET_MODE_ONLINE&&u!==x.BUCKET_MODE_REPLICA&&u!==x.BUCKET_MODE_LOCAL&&(u=x.BUCKET_MODE_ONLINE),h.bucketMode=u,f.setData(h)}else{var d="/buckets/"+s+"/"+r;f=new l(t,d),f.setMethod("GET"),f.setContentType("application/json")}var y=f.execute().then(function(e){try{n("BaseBucket.loadBucket(), success : "+e);var o=JSON.parse(e),a=o.name;if(null==a){n("BaseBucket.loadBucket(), invalid bucket name, name="+a);var c=i(0,"Invalid response","",r);return Promise.reject(c)}n("BaseBucket.loadBucket(), new Bucket, name="+a);var l=void 0;l="file"===s?new t.FileBucket(a):new t.ObjectBucket(a,u);var p=o.ACL;if(null!=p){n("BaseBucket.loadBucket(), acl="+p);var f=new m;f._set(p),l.setAcl(f)}var h=o.contentACL;if(null!=h){n("BaseBucket.loadBucket(), contentAcl="+h);var d=new m;d._set(h),l.setContentAcl(d)}var y=o.description;return null!=y&&(n("BaseBucket.loadBucket(), description="+y),l.setDescription(y)),l}catch(e){n("BaseBucket.loadBucket(), error : exception"+e);var c=i(0,e,e.toString(),r);return Promise.reject(c)}},function(e){return n("BaseBucket.loadBucket(), error: "+a(e)),e.data=r,Promise.reject(e)});return o(y,c)},e._getBucketList=function(t,r,s,u){n("BaseBucket.getBucketList(), type="+r+", callbacks="+u);var c;if(t.isOffline()){var f="getBucketList";s&&(f="getLocalBucketList"),c=new p(e.getClassName(r),f)}else{var h="/buckets/"+r;c=new l(t,h),c.setMethod("GET"),c.setContentType("application/json")}var d=c.execute().then(function(e){try{n("BaseBucket.getBucketList(), success : "+e);var t=JSON.parse(e),r=t.results;if(null!=r){n("BaseBucket.getBucketList(), buckets="+r);for(var s=[],o=0,a=r;o<a.length;o++){var u=a[o];n("BaseBucket.getBucketList(), success : add bucketName = "+u.name),null!=u.name?s.push(u.name):n("BaseBucket.getBucketList(), [WARNING] No name in response")}return s}n("BaseBucket.getBucketList(), invalid response");var c=i(0,"Invalid response","",name);return Promise.reject(c)}catch(e){n("BaseBucket.getBucketList(), success : exception"+e);var c=i(0,e,e);return Promise.reject(c)}},function(e){return n("BaseBucket.getBucketList(), error: "+a(e)),Promise.reject(e)});return o(d,u)},e.prototype.saveBucket=function(t){var r=this;n("BaseBucket.saveBucket(), callbacks="+t);var s;if(this._service.isOffline())s=new p(e.getClassName(this._type),"saveBucket");else{var i=this.getPath();s=new l(this._service,i),s.setMethod("PUT"),s.setContentType("application/json")}var u={};null!=this._acl&&(u.ACL=this._acl._toJsonObject()),null!=this._contentAcl&&(u.contentACL=this._contentAcl._toJsonObject()),null!=this._description&&(u.description=this._description),this._service.isOffline()&&(u.bucketName=this.getBucketName(),u.bucketMode=this.getBucketMode()),s.setData(u),n("BaseBucket.saveBucket(), body="+JSON.stringify(u));var c=s.execute().then(function(e){n("success : "+e),n("bucketName : "+r.getBucketName());try{n("success : "+e);var t=JSON.parse(e);return null!=t.ACL&&(r._acl||(r._acl=new m),r._acl._set(t.ACL)),null!=t.contentACL&&(r._contentAcl||(r._contentAcl=new m),r._contentAcl._set(t.contentACL)),r}catch(e){return n("success : "+e),Promise.reject(e)}},function(e){return n("error: "+a(e)),e.data=r,Promise.reject(e)});return o(c,t)},e.prototype.deleteBucket=function(t){var r=this;n("BaseBucket.deleteBucket(), callbacks="+t);var s;if(this._service.isOffline()){s=new p(e.getClassName(this._type),"deleteBucket");var i={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};s.setData(i)}else{var u=this.getPath();s=new l(this._service,u),s.setMethod("DELETE"),s.setContentType("application/json")}var c=s.execute().then(function(){return n("BaseBucket.deleteBucket(), success"),r},function(e){return n("BaseBucket.deleteBucket(), error: "+a(e)),e.data=r,Promise.reject(e)});return o(c,t)},e.prototype.setAcl=function(e){if(e instanceof m)return this._acl=e},e.prototype.getAcl=function(){return this._acl},e.prototype.setContentAcl=function(e){if(e instanceof m)return this._contentAcl=e},e.prototype.getContentAcl=function(){return this._contentAcl},e.prototype.setDescription=function(e){return this._description=e},e.prototype.getDescription=function(){return this._description},e.prototype.getBucketName=function(){return this._name},e.prototype.setBucketName=function(e){return this._name=e},e.prototype.getBucketMode=function(){return this._mode},e.prototype.getPath=function(e){var t="/buckets/"+this._type+"/"+this._name;return null!=e&&(t+=e),t},e.prototype.getDataPath=function(e){var t="objects";"file"===this._type&&(t="files");var r="/"+t+"/"+this._name;return null!=e&&(r+=e),r},e.getClassName=function(e){var t="NebulaObjectBucket";return"file"===e&&(t="NebulaFileBucket"),t},e.prototype.getClassName=function(){return e.getClassName(this._type)},e}(),T=function(t){function s(e,r,n){void 0===n&&(n=x.BUCKET_MODE_ONLINE);var s=t.call(this,e,r,"object",n)||this;return s._resolveId=null,s}return e(s,t),s._loadBucket=function(e,t,r,s){return n("ObjectBucket.loadBucket(), name="+t+", callbacks="+r),O._loadBucket(e,t,"object",s,r)},s._getBucketList=function(e,t){return n("ObjectBucket.getBucketList(), callbacks="+t),O._getBucketList(e,"object",!1,t)},s._getLocalBucketList=function(e,t){return n("ObjectBucket.getLocalBucketList(), callbacks="+t),O._getBucketList(e,"object",!0,t)},s.prototype.load=function(e,t){if(n("ObjectBucket.load()"),null==e)throw r("ObjectBucket.load(), Parameter is invalid"),new Error("No objectId");var s;if(this._service.isOffline()){s=new p(this.getClassName(),"load");var u={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e};s.setData(u)}else{var c=this.getDataPath("/"+e);s=new l(this._service,c),s.setMethod("GET"),s.setContentType("application/json")}var f=s.execute().then(function(t){try{var r=JSON.parse(t);return n("ObjectBucket.load(), success : response="+t),r}catch(r){n("ObjectBucket.load(), success : response="+t);var s=i(0,"Invalid response from server",r);return s.data=e,Promise.reject(s)}},function(t){return n("ObjectBucket.load(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(f,t)},s.prototype.remove=function(e,t,s){if(n("ObjectBucket.delete)"),null==e)throw r("ObjectBucket.remove(), Parameter is invalid"),new Error("No objectId");var i;if(this._service.isOffline()){i=new p(this.getClassName(),"delete");var u={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e};s&&(u.etag=s),i.setData(u)}else{var c=this.getDataPath("/"+e);i=new l(this._service,c),i.setMethod("DELETE"),i.setContentType("application/json"),s&&i.setQueryParam("etag",s)}var f=i.execute().then(function(t){return n("ObjectBucket.delete(), success"),e},function(t){return n("ObjectBucket.delete(), error: "+a(t)),t.objectId=e,Promise.reject(t)});return o(f,t)},s.prototype.save=function(e,t){if(n("ObjectBucket.save()"),!e)throw r("ObjectBucket.save(), Parameter is invalid"),new Error("No object");var s;if(this._service.isOffline()){s=new p(this.getClassName(),"save");var u={object:e,bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};s.setData(u)}else{var c={},f=void 0,h=void 0;null!=e._id?(f=this.getDataPath("/"+e._id),h="PUT",null!=e.etag&&(c.etag=e.etag)):(f=this.getDataPath(),h="POST"),n("ObjectBucket.save(), path="+f),s=new l(this._service,f),s.setContentType("application/json"),s.setMethod(h),s.setQueryParams(c),s.setData(e)}var d=s.execute().then(function(t){try{var r=JSON.parse(t);return n("ObjectBucket.save(), success"),r}catch(t){n("ObjectBucket.save(), success : exception="+t);var s=i(0,"Invalid response from server",t);return s.data=e,Promise.reject(s)}},function(t){return n("ObjectBucket.save(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(d,t)},s.prototype.query=function(e,t){return this._query(e,{longQuery:this._service.ObjectBucket.useLongQuery},t)},s.prototype.longQuery=function(e,t){return this._query(e,{longQuery:!0},t)},s.prototype.queryWithCount=function(e,t){return this._query(e,{countQuery:!0,longQuery:this._service.ObjectBucket.useLongQuery},t)},s.prototype.longQueryWithCount=function(e,t){return this._query(e,{countQuery:!0,longQuery:!0},t)},s.prototype._query=function(e,t,r){n("ObjectBucket.query()"),t.countQuery&&(null==e&&(e=new S),e._setCountQuery(t.countQuery));var s,u;if(this._service.isOffline()){s=new p(this.getClassName(),"query");var c={};null!=e&&(null!=e.getClause()&&null!=e.getClause().json()&&(c.clause=e.getClause().json()),c.limit=e.getLimit(),c.skip=e.getSkipCount(),c.sort=e.getSortOrder(),c.deleteMark=e._getDeleteMark(),c.countQuery=e._isCountQuery()),c.bucketName=this.getBucketName(),c.bucketMode=this.getBucketMode(),s.setData(c)}else t.longQuery?(u=this.getDataPath("/_query"),s=new l(this._service,u),s.setMethod("POST"),s.setContentType("application/json"),s.setData(null!=e?e._toParamJson():{})):(u=this.getDataPath(),s=new l(this._service,u),s.setMethod("GET"),null!=e&&s.setQueryParams(e._toParam()));var f=s.execute().then(function(t){try{var r=JSON.parse(t),s=r.results;if(n("ObjectBucket.query(), success : size="+s.length),null!=e&&e._isCountQuery()===!0){var o=-1;return null!=r.count&&(o=r.count),{objects:s,count:o}}return s}catch(e){n("ObjectBucket.query(), success : exception="+e);var a=i(0,e.toString(),e);return Promise.reject(a)}},function(e){return n("ObjectBucket.query(), error: "+a(e)),Promise.reject(e)});return o(f,r)},s.prototype._checkOfflineService=function(){if(this._service!==x)throw r("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!this._service.isOffline())throw r("ObjectBucket.setSyncScope(), supported offline mode only"),new Error("No offline mode enabled")},s.prototype.setSyncScope=function(e,t){this._checkOfflineService();var r=new p(O.getClassName(),"setSyncScope"),s={},i={};null!=e&&(null!=e.getClause()&&null!=e.getClause().json()&&(i.clause=e.getClause().json()),s.scope=i),s.bucketName=this.getBucketName(),s.bucketMode=this.getBucketMode(),n("ObjectBucket.setSyncScope(), body="+JSON.stringify(s)),r.setData(s);var u=r.execute().then(function(e){n("ObjectBucket.setSyncScope(), success : response="+e)},function(e){return n("ObjectBucket.setSyncScope(), error: "+a(e)),Promise.reject(e)});return o(u,t)},s.prototype.getSyncScope=function(e){this._checkOfflineService();var t=new p(O.getClassName(),"getSyncScope"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var s=t.execute().then(function(e){n("ObjectBucket.getSyncScope(), success : response="+e);try{var t=JSON.parse(e);if(null!=t.scope){var r=null;return c(t.scope,{})||(r=S._toObjectQuery(t.scope)),n("ObjectBucket.getSyncScope(), success : callback_data="+t.scope),r}return n("ObjectBucket.getSyncScope(), success : no scope property"),Promise.reject(i(0,"Invalid response - no scope property",""))}catch(e){return n("ObjectBucket.getSyncScope(), success : exception="+e),Promise.reject(i(0,e.toString(),e))}},function(e){return n("ObjectBucket.getSyncScope(), error: "+a(e)),Promise.reject(e)});return o(s,e)},s.prototype.getResolveConflictPolicy=function(e){n("ObjectBucket.getResolveConflictPolicy()"),this._checkOfflineService();var t=new p(O.getClassName(),"getResolveConflictPolicy"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var s=t.execute().then(function(e){n("ObjectBucket.getResolveConflictPolicy(), success : response="+e);try{var t=JSON.parse(e);return null!=t.results?t.results:(n("ObjectBucket.getResolveConflictPolicy(), success : no results"),Promise.reject(i(0,"No results","")))}catch(e){return n("ObjectBucket.getResolveConflictPolicy(), success : exception="+e),Promise.reject(i(0,e.toString(),e))}},function(e){return n("ObjectBucket.getResolveConflictPolicy(), error: "+a(e)),
Promise.reject(e)});return o(s,e)},s.prototype.setResolveConflictPolicy=function(e,t){if(n("ObjectBucket.setResolveConflictPolicy()"),this._checkOfflineService(),null==e)throw r("ObjectBucket.setResolveConflictPolicy(), invalid parameter: no policy"),new Error("No policy");var s=new p(O.getClassName(),"setResolveConflictPolicy"),i={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),policy:e};s.setData(i);var u=s.execute().then(function(e){n("ObjectBucket.setResolveConflictPolicy(), success : response="+e)},function(e){return n("ObjectBucket.setResolveConflictPolicy(), error: "+a(e)),Promise.reject(e)});return o(u,t)},s.prototype.removeCacheBucket=function(e){n("ObjectBucket.removeCacheBucket()"),this._checkOfflineService();var t=new p(O.getClassName(),"removeCacheBucket"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var s=t.execute().then(function(e){n("ObjectBucket.removeCacheBucket(), success : response="+e)},function(e){return n("ObjectBucket.removeCacheBucket(), error: "+a(e)),Promise.reject(e)});return o(s,e)},s.prototype.setSyncEventListener=function(e){return this._checkOfflineService(),h.setListener(this,e)},s._sync=function(e,t){if(n("ObjectBucket.sync()"),e!==x)throw r("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!e.isOffline())throw r("ObjectBucket.sync(), supported offline mode only"),new Error("No offline mode enabled");var s=new p(O.getClassName(),"sync"),i=s.execute().then(function(e){n("ObjectBucket.sync(), success : response="+e)},function(e){return n("ObjectBucket.sync(), error: "+a(e)),Promise.reject(e)});return o(i,t)},s.prototype.syncBucket=function(e){n("ObjectBucket.syncBucket()"),this._checkOfflineService();var t=new p(O.getClassName(),"syncBucket"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var s=t.execute().then(function(e){n("ObjectBucket.syncBucket(), success : response="+e)},function(e){return n("ObjectBucket.syncBucket(), error: "+a(e)),Promise.reject(e)});return o(s,e)},s.prototype.resolveConflict=function(e,t){if(n("ObjectBucket.resolveConflict()"),this._checkOfflineService(),null==e||null==t||null==this._resolveId)throw r("ObjectBucket.syncObject(), invalid parameter, objectId="+e+", resolve="+t+", resolveId="+this._resolveId),new Error("No objectId/resolve/resolveId");var s={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e,resolveId:this._getResolveId(),resolve:t};return h.resolveConflict(s)},s.prototype.setIndexToLocal=function(e,t){if(n("ObjectBucket.setIndexLocal()"),this._checkOfflineService(),!e)throw r("ObjectBucket.setIndexLocal(), parameter is invalid"),new Error("No index");if(!e.index)throw r("ObjectBucket.setIndexLocal(), index is invalid"),new Error("No index property");var s=new p(this.getClassName(),"setIndexToLocal");e.bucketName=this.getBucketName(),e.bucketMode=this.getBucketMode(),s.setData(e);var i=s.execute().then(function(){n("ObjectBucket.setIndexLocal(), success")},function(e){return n("ObjectBucket.setIndexLocal(), error: "+a(e)),Promise.reject(e)});return o(i,t)},s.prototype.getIndexFromLocal=function(e){n("ObjectBucket.getIndexLocal()"),this._checkOfflineService();var t=new p(this.getClassName(),"getIndexFromLocal"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var s=t.execute().then(function(e){n("ObjectBucket.getIndexLocal(), success");try{var t=JSON.parse(e),r=t.results;return r}catch(e){n("ObjectBucket.getIndexLocal(), success : exception="+e);var s=i(0,e.toString(),e);return Promise.reject(s)}},function(e){return n("ObjectBucket.getIndexLocal(), error: "+a(e)),Promise.reject(e)});return o(s,e)},s.prototype.getLastSyncTime=function(e){n("ObjectBucket.getLastSyncTime()"),this._checkOfflineService();var t=new p(O.getClassName(),"getLastSyncTime"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var s=t.execute().then(function(e){n("ObjectBucket.getLastSyncTime(), success : response="+e);try{var t=JSON.parse(e);return null!=t.results?t.results:(n("ObjectBucket.getLastSyncTime(), success : no results"),null)}catch(e){return n("ObjectBucket.getLastSyncTime(), success : exception="+e),Promise.reject(i(0,e.toString(),e))}},function(e){return n("ObjectBucket.getLastSyncTime(), error: "+a(e)),Promise.reject(e)});return o(s,e)},s.prototype._getResolveId=function(){return n("ObjectBucket._getResolveId(), resolveId="+this._resolveId),this._resolveId},s.prototype._setResolveId=function(e){return n("ObjectBucket._setResolveId(), cur="+this._resolveId+", new="+e),this._resolveId=e},s.prototype.batch=function(e,t){var r=this.getDataPath("/_batch"),n=new l(this._service,r);n.setMethod("POST"),n.setContentType("application/json"),n.setData(e.json);var s=n.execute().then(function(e){for(var t=JSON.parse(e),r=0,n=0,s=t.results;n<s.length;n++){var o=s[n];"ok"!==o.result&&r++}return t.failedCount=r,t},function(e){return Promise.reject(e)});return o(s,t)},s}(O),j=function(t){t.ObjectBucket=(r=function(r){function n(e,n){return void 0===n&&(n=x.BUCKET_MODE_ONLINE),r.call(this,t,e,n)||this}return e(n,r),n.loadBucket=function(e,n,s){return r._loadBucket.call(this,t,e,n,s)},n.getBucketList=function(e){return r._getBucketList.call(this,t,e)},n.getLocalBucketList=function(e){return r._getLocalBucketList.call(this,t,e)},n.prototype.saveBucket=function(e){return r.prototype.saveBucket.call(this,e)},n.prototype.deleteBucket=function(e){return r.prototype.deleteBucket.call(this,e)},n.prototype.setAcl=function(e){return r.prototype.setAcl.call(this,e)},n.prototype.getAcl=function(){return r.prototype.getAcl.call(this)},n.prototype.setContentAcl=function(e){return r.prototype.setContentAcl.call(this,e)},n.prototype.getContentAcl=function(){return r.prototype.getContentAcl.call(this)},n.prototype.setDescription=function(e){return r.prototype.setDescription.call(this,e)},n.prototype.getDescription=function(){return r.prototype.getDescription.call(this)},n.prototype.getBucketName=function(){return r.prototype.getBucketName.call(this)},n.prototype._setBucketName=function(e){return r.prototype.setBucketName.call(this,e)},n.prototype.getBucketMode=function(){return r.prototype.getBucketMode.call(this)},n.prototype.load=function(e,t){return r.prototype.load.call(this,e,t)},n.prototype.remove=function(e,t,n){return r.prototype.remove.call(this,e,t,n)},n.prototype.delete=function(e,t,n){return r.prototype.remove.call(this,e,t,n)},n.prototype.save=function(e,t){return r.prototype.save.call(this,e,t)},n.prototype.query=function(e,t){return r.prototype.query.call(this,e,t)},n.prototype.longQuery=function(e,t){return r.prototype.longQuery.call(this,e,t)},n.prototype.queryWithCount=function(e,t){return r.prototype.queryWithCount.call(this,e,t)},n.prototype.longQueryWithCount=function(e,t){return r.prototype.longQueryWithCount.call(this,e,t)},n.prototype.setSyncScope=function(e,t){return r.prototype.setSyncScope.call(this,e,t)},n.prototype.getSyncScope=function(e){return r.prototype.getSyncScope.call(this,e)},n.prototype.getResolveConflictPolicy=function(e){return r.prototype.getResolveConflictPolicy.call(this,e)},n.prototype.setResolveConflictPolicy=function(e,t){return r.prototype.setResolveConflictPolicy.call(this,e,t)},n.prototype.removeCacheBucket=function(e){return r.prototype.removeCacheBucket.call(this,e)},n.prototype.setSyncEventListener=function(e){r.prototype.setSyncEventListener.call(this,e)},n.sync=function(e){return r._sync.call(this,t,e)},n.prototype.syncBucket=function(e){return r.prototype.syncBucket.call(this,e)},n.prototype.resolveConflict=function(e,t){return r.prototype.resolveConflict.call(this,e,t)},n.prototype.setIndexToLocal=function(e,t){return r.prototype.setIndexToLocal.call(this,e,t)},n.prototype.getIndexFromLocal=function(e){return r.prototype.getIndexFromLocal.call(this,e)},n.prototype.getLastSyncTime=function(e){return r.prototype.getLastSyncTime.call(this,e)},n.prototype._getResolveId=function(){return r.prototype._getResolveId.call(this)},n.prototype._setResolveId=function(e){return r.prototype._setResolveId.call(this,e)},n.prototype.batch=function(e,t){return r.prototype.batch.call(this,e,t)},n}(T),r.CONFLICT_POLICY_MANUAL=0,r.CONFLICT_POLICY_CLIENT=1,r.CONFLICT_POLICY_SERVER=2,r.RESOLVE_CONFLICT_UNDEFINED=-1,r.RESOLVE_CONFLICT_CLIENT=1,r.RESOLVE_CONFLICT_SERVER=2,r.SYNC_ERROR_UNDEFINED=-1,r.SYNC_ERROR_PUSH=0,r.SYNC_ERROR_PULL=1,r.SYNC_ERROR_OVERLAP_ID=2,r.SYNC_ERROR_PUSH_RESYNCING=3,r.useLongQuery=!1,r);var r},P=function(t){function r(e,r){var n=t.call(this,e,r,"file")||this;return n._resolveId=null,n}return e(r,t),r._loadBucket=function(e,t,r){return n("FileBucket.loadBucket(), name="+t+", callbacks="+r),O._loadBucket(e,t,"file",x.BUCKET_MODE_ONLINE,r)},r._getBucketList=function(e,t){return O._getBucketList(e,"file",!1,t)},r.prototype._save=function(e,t,r,s,u){var c=this;if(n("FileBucket._save()"),!e)throw n("FileBucket._save(), Parameter is invalid : fileName"),new Error("No fileName");if(!t)throw n("FileBucket._save(), Parameter is invalid : data"),new Error("No data");if(!("undefined"!=typeof Blob&&null!==Blob||"undefined"!=typeof Buffer&&null!==Buffer))throw n("FileBucket._save(), Not supported Blob nor Buffer"),new Error("No Blob/Buffer support");if(!("string"==typeof t||"undefined"==typeof Blob||null===Blob||t instanceof Blob||"undefined"==typeof Buffer||null===Buffer||Buffer.isBuffer(t)))throw n("FileBucket._save(), Data is not String, Blob nor Buffer"),new Error("data is not String, Blob nor Buffer");if(!(s||r&&r.getContentType()))throw n("FileBucket._save(), Parameter is invalid : metadata.contentType"),new Error("No contentType in metadata");var p=this.getDataPath("/"+e);n("FileBucket._save(), path="+p);var f=new l(this._service,p);s?f.setMethod("PUT"):(f.setMethod("POST"),f.setContentType(r.getContentType()),null!=r.getAcl()&&f.addRequestHeader("X-ACL",r.getAcl()._toString())),f.setData(t);var h=f.execute().then(function(t){try{var s=JSON.parse(t);return null===r&&(r=new E),c._setMetadata(r,s),r}catch(t){n("FileBucket._save(), success: exception="+t);var o=i(0,"Invalid response from server",t,e);return Promise.reject(o)}},function(t){return n("FileBucket._save(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(h,u)},r.prototype.saveAs=function(e,t,r,n){return this._save(e,t,r,!1,n)},r.prototype.save=function(e,t,r){return this._save(e,t,null,!0,r)},r.prototype.load=function(e,t){if(n("FileBucket.load()"),"undefined"==typeof e||null===e)throw n("FileBucket.load(), Parameter is invalid : fileName"),new Error("No fileName");if(!("undefined"!=typeof Blob&&null!==Blob||"undefined"!=typeof Buffer&&null!==Buffer))throw n("FileBucket.load(), Not supported Blob nor Buffer"),new Error("No Blob/Buffer support");var r=this.getDataPath("/"+e);n("FileBucket.load(), path="+r);var s=new l(this._service,r);s.setMethod("GET"),"undefined"!=typeof Blob&&null!==Blob?s.setResponseType("blob"):"undefined"!=typeof Buffer&&null!==Buffer&&s.setResponseType("buffer");var i=s.execute().then(function(e){return e},function(t){return n("FileBucket.load(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(i,t)},r.prototype.remove=function(e,t){if(n("FileBucket.delete()"),"undefined"==typeof e||null===e)throw n("FileBucket.delete(), Parameter is invalid : fileName"),new Error("No fileName");var r;if(this._service.isOffline()){r=new p(this.getClassName(),"delete");var s={bucketName:this.getBucketName(),fileName:e};r.setData(s)}else{var i=this.getDataPath("/"+e);n("FileBucket.delete(), path="+i),r=new l(this._service,i),r.setMethod("DELETE")}var u=r.execute().then(function(t){return n("FileBucket.delete(), success: "+e),e},function(t){return n("FileBucket.delete(), error: "+a(t)+" : "+e),t.data=e,Promise.reject(t)});return o(u,t)},r.prototype._createMetadata=function(e){var t=new E;return this._setMetadata(t,e),t},r.prototype._setMetadata=function(e,t){if(null!=t.filename&&e.setFileName(t.filename),null!=t.contentType&&e.setContentType(t.contentType),null!=t.ACL){var r=new m(t.ACL);e.setAcl(r)}return null!=t.length&&e._setSize(t.length),null!=t.publicUrl&&e._setPublicUrl(t.publicUrl),null!=t.createdAt&&e._setCreatedAt(t.createdAt),null!=t.updatedAt&&e._setUpdatedAt(t.updatedAt),null!=t.lastSyncTime&&e._setLastSyncTime(t.lastSyncTime),null!=t.metaId&&e._setMetaId(t.metaId),null!=t.metaETag&&e._setMetaETag(t.metaETag),null!=t.fileETag&&e._setFileETag(t.fileETag),null!=t.cacheDisabled&&e.setCacheDisabled(t.cacheDisabled),e},r.prototype._publish=function(e,t,r){var s=this;if(n("FileBucket._publish(), fileName="+e+", setFlg="+t),"undefined"==typeof e||null===e)throw n("FileBucket._publish(), Parameter is invalid : fileName"),new Error("No fileName");var u;if(this._service.isOffline()){u=new p(this.getClassName(),"publish");var c={bucketName:this.getBucketName(),fileName:e,published:t};u.setData(c)}else{var f=this.getDataPath("/"+e+"/publish");n("FileBucket._publish(), path="+f),u=new l(this._service,f),t?u.setMethod("PUT"):u.setMethod("DELETE")}var h=u.execute().then(function(t){n("FileBucket._publish(), success: "+e);try{var r=JSON.parse(t),o=s._createMetadata(r);return o}catch(t){n("FileBucket._publish(), success: exception="+t);var a=i(0,"Invalid response from server",t);return a.data=e,Promise.reject(a)}},function(t){return n("FileBucket._publish(), error: "+a+" : "+e),t.data=e,Promise.reject(t)});return o(h,r)},r.prototype.publish=function(e,t){return n("FileBucket.publish()"),this._publish(e,!0,t)},r.prototype.unpublish=function(e,t){return n("FileBucket.unpublish()"),this._publish(e,!1,t)},r.prototype._getList=function(e,t,r){var s=this;n("FileBucket._getList(), published="+e);var u;if(this._service.isOffline()){u=new p(this.getClassName(),"getList");var c={bucketName:this.getBucketName(),published:e,deleteMark:t};u.setData(c)}else{var f=this.getDataPath();n("FileBucket._getList(), path="+f),u=new l(this._service,f),u.setMethod("GET"),e&&u.setQueryParam("published","1"),t&&u.setQueryParam("deleteMark","1")}var h=u.execute().then(function(e){n("FileBucket._getList(), success");try{var t=JSON.parse(e),r=t.results,o=[];if(null!=r)for(var a=0,u=r;a<u.length;a++){var c=u[a],l=s._createMetadata(c);o.push(l)}return o}catch(e){n("FileBucket._getList(), success: exception="+e);var p=i(0,"Invalid response from server",e);return Promise.reject(p)}},function(e){return n("FileBucket._getList(), error: "+a(e)),Promise.reject(e)});return o(h,r)},r.prototype.getList=function(e){return n("FileBucket.getList()"),this._getList(!1,!1,e)},r.prototype.getPublishedList=function(e){return n("FileBucket.getPublishedList()"),this._getList(!0,!1,e)},r.prototype.getMetadata=function(e,t){var r=this;if(n("FileBucket.getMetadata(), fileName="+e),"undefined"==typeof e||null===e)throw n("FileBucket.getMetadata(), Parameter is invalid : fileName"),new Error("No fileName");var s;if(this._service.isOffline()){s=new p(this.getClassName(),"getMetadata");var u={bucketName:this.getBucketName(),fileName:e};s.setData(u)}else{var c=this.getDataPath("/"+e+"/meta");n("FileBucket.getMetadata(), path="+c),s=new l(this._service,c),s.setMethod("GET")}var f=s.execute().then(function(t){n("FileBucket.getMetadata(), success");try{var s=JSON.parse(t),o=r._createMetadata(s);return o}catch(r){n("FileBucket.getMetadata(), Invalid response : "+t);var a=i(0,"Invalid response from server",r);return a.data=e,Promise.reject(a)}},function(t){return n("FileBucket.getMetadata(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(f,t)},r.prototype.updateMetadata=function(e,t,r){var s=this;if(n("FileBucket.updateMetadata(), fileName="+e),"undefined"==typeof e||null===e)throw n("FileBucket.updateMetadata(), Parameter is invalid : fileName"),new Error("No fileName");if(!(t instanceof E))throw n("FileBucket.updateMetadata(), Parameter is invalid : metadata"),new Error("metadata is not instance of FileMetadata");var u,c={};if(this._service.isOffline())u=new p(this.getClassName(),"updateMetadata"),c.bucketName=this.getBucketName(),c.targetFileName=e,c.cacheDisabled=t.isCacheDisabled();else{var f=this.getDataPath("/"+e+"/meta");n("FileBucket.updateMetadata(), path="+f),u=new l(this._service,f),u.setMethod("PUT")}null!=t.getFileName()&&(c.filename=t.getFileName()),null!=t.getContentType()&&(c.contentType=t.getContentType()),null!=t.getAcl()&&(c.ACL=t.getAcl()._toJsonObject()),u.setData(c);var h=u.execute().then(function(r){n("FileBucket.updateMetadata(), success");try{var o=JSON.parse(r);return s._setMetadata(t,o),t}catch(t){n("FileBucket.updateMetadata(), success: exception="+t);var a=i(0,"Invalid response from server",t);return a.data=e,Promise.reject(a)}},function(t){return n("FileBucket.updateMetadata(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(h,r)},r._checkOfflineService=function(e){if(e!==x)throw n("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!e.isOffline())throw n("ObjectBucket.setSyncScope(), supported offline mode only"),new Error("No offline mode enabled")},r._selectUploadFile=function(e,t){n("FileBucket.selectUploadFile()"),this._checkOfflineService(e);var r=new p(O.getClassName("file"),"selectUploadFile"),s=r.execute().then(function(e){try{var t=JSON.parse(e);return t}catch(e){n("FileBucket.selectUploadFile(), success: exception="+e);var r=i(0,"Invalid response from server",e);return Promise.reject(r)}},function(e){return n("FileBucket.selectUploadFile(), error: "+a(e)),Promise.reject(e)});return o(s,t)},r._selectDirectory=function(e,t){n("FileBucket.selectDirectory()"),this._checkOfflineService(e);var r=new p(O.getClassName("file"),"selectDirectory"),s=r.execute().then(function(e){try{var t=JSON.parse(e);return t.path}catch(e){n("FileBucket.selectUploadFile(), success: exception="+e);var r=i(0,"Invalid response from server",e);return Promise.reject(r)}},function(e){return n("FileBucket.selectDirectory(), error: "+a(e)),Promise.reject(e)});return o(s,t)},r.prototype._uploadFile=function(e,t,r,s,u){var c=this;if(n("FileBucket._uploadFile()"),!this._service.isOffline())throw n("FileBucket._uploadFile(), only offline mode"),new Error("No offline mode enabled");if(!e||""===e)throw n("FileBucket._uploadFile(), Parameter is invalid : fileName"),new Error("No fileName");if(!t||""===t)throw n("FileBucket._uploadFile(), Parameter is invalid : filePath"),new Error("No filePath");if(!r||!r.getContentType()||""===r.getContentType())throw n("FileBucket._uploadFile(), Parameter is invalid : metadata"),new Error("No metadata.contentType");var l="uploadNewFile";s&&(l="uploadUpdateFile");var f=new p(this.getClassName(),l),h={};h.bucketName=this.getBucketName(),h.fileName=e,h.filePath=t,h.cacheDisabled=r.isCacheDisabled(),h.contentType=r.getContentType(),null!=r.getAcl()&&(h.ACL=r.getAcl()._toJsonObject()),f.setData(h);var d=f.execute().then(function(t){try{var s=JSON.parse(t);return null===r&&(r=new E),c._setMetadata(r,s),r}catch(t){n("FileBucket.uploadNewFile(), success: exception="+t);var o=i(0,"Invalid response from server",t);return o.data=e,Promise.reject(o)}},function(t){return n("FileBucket.uploadNewFile(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(d,u)},r.prototype.uploadNewFile=function(e,t,r,s){return n("FileBucket.uploadNewFile()"),this._uploadFile(e,t,r,!1,s)},r.prototype.uploadUpdateFile=function(e,t,r,s){return n("FileBucket.uploadUpdateFile()"),this._uploadFile(e,t,r,!0,s)},r.prototype.downloadFile=function(e,t,s){if(n("FileBucket.downloadFile()"),r._checkOfflineService(this._service),!e||""===e)throw n("FileBucket.downloadFile(), Parameter is invalid : fileName"),new Error("No fileName");if(!t||""===t)throw n("FileBucket.downloadFile(), Parameter is invalid : filePath"),new Error("No filePath");var u=new p(this.getClassName(),"downloadFile"),c={bucketName:this.getBucketName(),fileName:e,filePath:t};u.setData(c);var l=u.execute().then(function(t){try{JSON.parse(t);return n("FileBucket.downloadFile(), response="+t),e}catch(t){n("FileBucket.downloadFile(), success: exception="+t);var r=i(0,"Invalid response from server",t);return r.data=e,Promise.reject(r)}},function(t){return n("FileBucket.downloadFile(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(l,s)},r.prototype.requestCancel=function(e,t){if(n("FileBucket.requestCancel()"),r._checkOfflineService(this._service),"undefined"==typeof e||null===e||""===e)throw n("FileBucket.requestCancel(), Parameter is invalid : fileName"),new Error("No fileName");var s=new p(this.getClassName(),"requestCancel"),u={bucketName:this.getBucketName(),fileName:e};s.setData(u);var c=s.execute().then(function(t){try{return n("FileBucket.requestCancel(), response="+t),e}catch(t){n("FileBucket.requestCancel(), success: exception="+t);var r=i(0,"Invalid response from server",t);return r.data=e,Promise.reject(r)}},function(t){return n("FileBucket.requestCancel(), error: "+a(t)),t.data=e,Promise.reject(t)});return o(c,t)},r}(O),A=function(t){t.FileBucket=function(r){function n(e){return r.call(this,t,e)||this}return e(n,r),n.loadBucket=function(e,n){return r._loadBucket.call(this,t,e,n)},n.getBucketList=function(e){return r._getBucketList.call(this,t,e)},n.prototype.saveBucket=function(e){return r.prototype.saveBucket.call(this,e)},n.prototype.deleteBucket=function(e){return r.prototype.deleteBucket.call(this,e)},n.prototype.setAcl=function(e){return r.prototype.setAcl.call(this,e)},n.prototype.getAcl=function(){return r.prototype.getAcl.call(this)},n.prototype.setContentAcl=function(e){return r.prototype.setContentAcl.call(this,e)},n.prototype.getContentAcl=function(){return r.prototype.getContentAcl.call(this)},n.prototype.setDescription=function(e){return r.prototype.setDescription.call(this,e)},n.prototype.getDescription=function(){return r.prototype.getDescription.call(this)},n.prototype.getBucketName=function(){return r.prototype.getBucketName.call(this)},n.prototype._setBucketName=function(e){return r.prototype.setBucketName.call(this,e)},n.prototype.saveAs=function(e,t,n,s){return r.prototype.saveAs.call(this,e,t,n,s)},n.prototype.save=function(e,t,n){return r.prototype.save.call(this,e,t,n)},n.prototype.load=function(e,t){return r.prototype.load.call(this,e,t)},n.prototype.remove=function(e,t){return r.prototype.remove.call(this,e,t)},n.prototype.delete=function(e,t){return r.prototype.remove.call(this,e,t)},n.prototype._createMetadata=function(e){return r.prototype._createMetadata.call(this,e)},n.prototype._setMetadata=function(e,t){return r.prototype._setMetadata.call(this,e,t)},n.prototype.publish=function(e,t){return r.prototype.publish.call(this,e,t)},n.prototype.unpublish=function(e,t){return r.prototype.unpublish.call(this,e,t)},n.prototype.getList=function(e){return r.prototype.getList.call(this,e)},n.prototype.getPublishedList=function(e){return r.prototype.getPublishedList.call(this,e)},n.prototype.getMetadata=function(e,t){return r.prototype.getMetadata.call(this,e,t)},n.prototype.updateMetadata=function(e,t,n){return r.prototype.updateMetadata.call(this,e,t,n)},n.selectUploadFile=function(e){return r._selectUploadFile.call(this,t,e)},n.selectDirectory=function(e){return r._selectDirectory.call(this,t,e)},n.prototype.uploadNewFile=function(e,t,n,s){return r.prototype.uploadNewFile.call(this,e,t,n,s)},n.prototype.uploadUpdateFile=function(e,t,n,s){return r.prototype.uploadUpdateFile.call(this,e,t,n,s)},n.prototype.downloadFile=function(e,t,n){return r.prototype.downloadFile.call(this,e,t,n)},n.prototype.requestCancel=function(e,t){return r.prototype.requestCancel.call(this,e,t)},n}(P)},I=function(){function e(e,t,r,n){this._service=e,this.apiname=t,this.method=r,this.subpath=n,this.headers={},this.path="/api/"+t,n&&(0!==n.indexOf("/")&&(this.path+="/"),this.path+=n)}return e.prototype.setContentType=function(e){this.contentType=e},e.prototype.clearHeaders=function(){this.headers={}},e.prototype.addHeader=function(e,t){this.headers[e]=t},e.prototype.setBinaryResponse=function(){if("undefined"!=typeof Blob&&null!==Blob)this.responseType="blob";else{if("undefined"==typeof Buffer||null===Buffer)throw new Error("No blob / buffer");this.responseType="buffer"}},e.prototype.execute=function(e,t){var r=new l(this._service,this.path);r.setMethod(this.method),e&&("GET"==this.method||"DELETE"==this.method?r.setQueryParams(e):r.setData(e)),null!=this.responseType&&r.setResponseType(this.responseType),null!=this.contentType&&r.setContentType(this.contentType);for(var s in this.headers)r.addRequestHeader(s,this.headers[s]);var i=r.execute().then(function(e){return n("CustomApi#success"),e}).catch(function(e){return n("CustomApi#error "+a(e)),Promise.reject(e)});return o(i,t)},e}(),L=function(t){t.CustomApi=function(r){function n(e,n,s){return r.call(this,t,e,n,s)||this}return e(n,r),n.prototype.setContentType=function(e){return r.prototype.setContentType.call(this,e),this},n.prototype.addHeader=function(e,t){return r.prototype.addHeader.call(this,e,t),this},n.prototype.clearHeaders=function(){return r.prototype.clearHeaders.call(this),this},n.prototype.execute=function(e,t){return r.prototype.execute.call(this,e,t)},n.prototype.setBinaryResponse=function(){return r.prototype.setBinaryResponse.call(this),this},n}(I)},R=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"badge",{get:function(){return this._fields.badge},set:function(e){if(!this._isInteger(e))throw new Error("ApnsFields.badge, Not integer: "+e);this._fields.badge=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._fields.sound},set:function(e){if("string"!=typeof e)throw new Error("ApnsFields.sound, Not string: "+e);this._fields.sound=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentAvailable",{get:function(){return this._fields["content-available"]},set:function(e){if(!this._isInteger(e))throw new Error("ApnsFields.contentAvailable, Not integer: "+e);this._fields["content-available"]=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"category",{get:function(){return this._fields.category},set:function(e){if("string"!=typeof e)throw new Error("ApnsFields.category, Not string: "+e);this._fields.category=e},enumerable:!0,configurable:!0}),e.prototype._isInteger=function(e){return"number"==typeof e&&parseInt(e,10)===e},e}(),M=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"title",{get:function(){return this._fields.title},set:function(e){if("string"!=typeof e)throw new Error("GcmFields.title, Invalid value: "+e);this._fields.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uri",{get:function(){return this._fields.uri},set:function(e){if("string"!=typeof e)throw new Error("GcmFields.uri, Invalid value: "+e);this._fields.uri=e},enumerable:!0,configurable:!0}),e}(),U=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"eventId",{get:function(){return this._fields.sseEventId},set:function(e){if("string"!=typeof e)throw new Error("SseFields.eventId, Not string: "+e);this._fields.sseEventId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventType",{get:function(){return this._fields.sseEventType},set:function(e){if("string"!=typeof e)throw new Error("SseFields.eventType, Not string: "+e);this._fields.sseEventType=e},enumerable:!0,configurable:!0}),e}(),F=function(){function e(e){this._service=e}return e.prototype.send=function(e){n("PushSender.send()");var t="/push/notifications",r=new l(this._service,t);r.setMethod("POST"),r.setContentType("application/json"),r.setData(this._toJson());var s=r.execute().then(function(e){n("PushSender.send#success : response = "+e);try{return JSON.parse(e)}catch(e){n("PushSender.send#success : exception="+e);var t=i(0,"Invalid response from server",e);return Promise.reject(t)}},function(e){return n("PushSender.send#error = "+a(e)),Promise.reject(e)});return o(s,e)},e.prototype._toJson=function(){var e={};return null!=this._clause&&(e.query=this._clause.json()),null!=this._message&&(e.message=this._message),null!=this._allowedReceivers&&(e.allowedReceivers=this._allowedReceivers),null!=this._apnsFields&&this._copyKeys(this._apnsFields._fields,e),null!=this._gcmFields&&this._copyKeys(this._gcmFields._fields,e),null!=this._sseFields&&this._copyKeys(this._sseFields._fields,e),e},e.prototype._copyKeys=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){var s=n[r];t[s]=e[s]}},Object.defineProperty(e.prototype,"clause",{get:function(){return this._clause},set:function(e){if(!(e instanceof k))throw new Error("PushSender.clause, Invalid type");this._clause=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){if("string"!=typeof e)throw new Error("PushSender.message, Not string: "+e);this._message=e,n("push.message = "+this._message)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowedReceivers",{get:function(){return this._allowedReceivers},set:function(e){if(!Array.isArray(e))throw new Error("PushSender.allowedReceivers, Not Array");this._allowedReceivers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apnsFields",{get:function(){return this._apnsFields},set:function(e){if(!(e instanceof R))throw new Error("PushSender.apnsFields, Invalid instance type");this._apnsFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcmFields",{get:function(){return this._gcmFields},set:function(e){if(!(e instanceof M))throw new Error("PushSender.gcmFields, Invalid instance type");this._gcmFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sseFields",{get:function(){return this._sseFields},set:function(e){if(!(e instanceof U))throw new Error("PushSender.sseFields, Invalid instance type");this._sseFields=e},enumerable:!0,configurable:!0}),e}();F.ApnsFields=R,F.GcmFields=M,F.SseFields=U;var q=function(t){t.PushSender=function(r){function n(){return r.call(this,t)||this}return e(n,r),n}(F)},D=function(){function e(){this.requests=[],this.json={requests:this.requests}}return e.prototype.addInsertRequest=function(e){if(e.etag)throw new Error("ETag exists");this.requests.push({op:"insert",data:e})},e.prototype.addUpdateRequest=function(e){if(!e._id)throw new Error("No id");var t={op:"update",_id:e._id,data:{$full_update:e}};e.etag&&(t.etag=e.etag),this.requests.push(t)},e.prototype.addDeleteRequest=function(e){if(!e._id)throw new Error("No id");var t={op:"delete",_id:e._id};e.etag&&(t.etag=e.etag),this.requests.push(t)},e}(),x=new _;x.BUCKET_MODE_ONLINE=0,x.BUCKET_MODE_REPLICA=1,x.BUCKET_MODE_LOCAL=2,x._localStorage=localStorage,x.setHttpProxy=function(e){var t=require("tunnel").httpOverHttp({proxy:e});require("xhr2").nodejsSet({httpAgent:t})},x.setHttpsProxy=function(e){var t=require("tunnel").httpsOverHttp({proxy:e});t.defaultPort=443,require("xhr2").nodejsSet({httpsAgent:t})},x.HttpRequest=l,x.NebulaService=_,x.AclPermission=v,x.AclGroup=g,x.Acl=m,x.RegexOption=b,x.Clause=k,x.ObjectQuery=S,x.FileMetadata=E,x.BatchRequest=D,x._SdeRequest=p,x._SdeNetworkEventListener=f,x._SdeSyncEventListener=h,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:t.Nebula=x}.call(this);
//# sourceMappingURL=baas.min.js.map
