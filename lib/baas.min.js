/*!
 * NEC Mobile Backend Platform JavaScript SDK version 6.5.0
 *
 * Copyright (C) 2014-2017, NEC CORPORATION
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, 
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice, 
 *   this list of conditions and the following disclaimer in the documentation 
 *   and/or other materials provided with the distribution.
 * * Neither the name of the <organization> nor the names of its contributors 
 *   may be used to endorse or promote products derived from this software 
 *   without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";var XMLHttpRequest,localStorage;(function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),t=this;"undefined"!=typeof window&&window;var r=function(e){"undefined"!=typeof console&&console.log("[BAAS ERROR] : "+e)},n=function(e){"debug"===D.getDebugMode()&&"undefined"!=typeof console&&console.log("[BAAS] : "+e)},s=function(e,t){return t?void e.then(function(e){t.success&&t.success(e)}).catch(function(e){t.error&&t.error(e)}):e},o=function(e,t,r,n){var s=new Error(t+"("+e+")");return s.status=e,s.statusText=t,s.responseText=r,n&&(s.data=n),s},i=function(e){return e&&e.message?e.message:e},u=function(e){var t=typeof e;return e&&"object"===t||"function"===t},c=function(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var s=0,o=r;s<o.length;s++){var i=o[s];if(u(e[i])&&u(t[i])){if(!c(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1}return!0},a=function(){function e(t,r,s){this._onReadyStateChange=this._onReadyStateChange.bind(this),n("HttpRequest#start:path = "+r),this._service=t,this._xhr=null,this._url=this._service.getBaseUri(),s&&s.noprefix||(this._url+="/"+this._service.getRestApiVersion()+"/"+this._service.getTenantID()),this._url=encodeURI(this._url)+r,this._headers={},this._contentType=null,this._responseType=null,this._queryParams=null,this._data=null,this._receiveResponseHeaders=!1,this._timeout=e.getDefaultTimeout();var o=this._service.getCurrentUser();this._sessionToken=null===o?null:o.sessionToken}return e.setHttpAgent=function(t){e._httpAgent=t},e.setHttpsAgent=function(t){e._httpsAgent=t},Object.defineProperty(e.prototype,"responseHeaders",{get:function(){return this._responseHeaders},enumerable:!0,configurable:!0}),e.setDefaultTimeout=function(e){this._defaultTimeout=e},e.getDefaultTimeout=function(){return this._defaultTimeout},e.prototype._hasXhr=function(){return void 0!==XMLHttpRequest},e.prototype._createXhr=function(){if(!this._hasXhr())throw new Error("No XMLHttpRequest");return new XMLHttpRequest},e.prototype.setReceiveResponseHeaders=function(e){return this._receiveResponseHeaders=e,this},e.prototype.execute=function(){var e=this;return new Promise(function(t,r){e._resolve=t,e._reject=r,e._headers["X-Application-Id"]=e._service.getAppID(),e._headers["X-Application-Key"]=e._service.getAppKey(),null!==e._contentType&&(e._headers["Content-Type"]=e._contentType),null!==e._sessionToken&&(e._headers["X-Session-Token"]=e._sessionToken);var n=e._url;if(e._queryParams){for(var s=[],o=0,i=Object.keys(e._queryParams);o<i.length;o++){var u=i[o];e._queryParams.hasOwnProperty(u)&&s.push(encodeURIComponent(u)+"="+encodeURIComponent(e._queryParams[u]))}s.length>0&&(n+="?"+s.join("&"))}var c;c=null==e._data?null:"string"==typeof e._data||"undefined"!=typeof Blob&&null!==Blob&&e._data instanceof Blob||"undefined"!=typeof Buffer&&null!==Buffer&&Buffer.isBuffer(e._data)?e._data:JSON.stringify(e._data),e._hasXhr()?e._doXhr(n,c):e._doNodeRequest(n,c)})},e.prototype._doXhr=function(e,r){var n=this;this._xhr=this._createXhr(),this._xhr.open(this._method,e,!0),this._xhr.onreadystatechange=this._onReadyStateChange;for(var s=0,o=Object.keys(this._headers);s<o.length;s++){var i=o[s],u=this._headers[i];this._xhr.setRequestHeader(i,u)}this._xhr.timeout=this._timeout,this._xhr.ontimeout=function(e){n._onXhrTimeout(e)};try{var c=t.navigator.userAgent.toLowerCase();(c.match(/msie/)||c.match(/trident/))&&(this._xhr.setRequestHeader("Pragma","no-cache"),this._xhr.setRequestHeader("Cache-Control","no-cache"),this._xhr.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT"))}catch(e){}null!=this._responseType&&(this._xhr.responseType=this._responseType),this._xhr.send(r)},e.prototype._onReadyStateChange=function(){var e=this._xhr;if(4===e.readyState){if(e.status>=200&&e.status<300){var t=null!=e.response?e.response:e.responseText;return this._receiveResponseHeaders?this._resolve({body:t,headers:e.getAllResponseHeaders(),status:e.status}):this._resolve(t)}var n=o(e.status,e.statusText,"");return"blob"!==e.responseType&&(n.responseText=e.responseText),0===e.status&&(n.statusText="Not Found",n.responseText="Not found anything that matches the request URI."),r("HTTP Request Error: "+n.message+" "+n.responseText),this._reject(n)}},e.prototype._onXhrTimeout=function(e){var t=o(0,"Timeout error",e.toString());r("HTTP Response Error: Timeout Error: "+e.toString()),this._reject(t)},e.prototype._doNodeRequest=function(t,s){var i,u=this,c=require("url"),a=require("https"),l=require("http");try{i=c.parse(t)}catch(e){return r("Bad URL: "+t),void this._reject(o(0,"Bad URL: "+t,""))}var p="https:"===i.protocol,h={method:this._method,hostname:i.hostname,port:i.port,path:i.path,headers:this._headers,agent:p?e._httpsAgent:e._httpAgent,timeout:this._timeout,pfx:null,passphrase:null,key:null,cert:null,ca:null,rejectUnauthorized:!0};if(p){var f=["pfx","passphrase","key","cert","ca"],d=this._service._config.clientCertOptions;if(null!=d)for(var y in d){if(!(f.indexOf(y)>=0))return r("invalid parameter "+y+" detected. value: "+JSON.stringify(d[y])),void this._reject(o(0,"invalid parameter: "+y," value: "+JSON.stringify(d[y])));h[y]=d[y]}this._service._config.allowSelfSignedCert?(h.rejectUnauthorized=!1,n("HTTPS Request Warning : accept self-signed certificate. make sure the risk of this setting.")):h.rejectUnauthorized=!0}var _=(p?a:l).request(h,function(e){var t=e.statusCode,n=[];u._responseHeaders=e.headers,e.on("data",function(e){n.push(e)}),e.on("end",function(){var s=Buffer.concat(n),i=u._parseNodeResponse(s);if(200<=t&&t<300)u._receiveResponseHeaders?u._resolve({body:i,headers:e.headers,status:t}):u._resolve(i);else{var c="buffer"!==u._responseType&&null!=i?i.toString():"",a=o(t,e.statusMessage,c,i);r("HTTP Response Error: status="+t+" - "+e.statusMessage),u._reject(a)}}),e.on("error",function(e){var t=o(0,"Client Error",e.toString());r("HTTP Response Error: Client Error: "+e.toString()),u._reject(t)})});_.on("error",function(e){var t=o(0,"HTTP request error",e.toString());r("HTTP Request Error: "+e.toString()),u._reject(t)}),null!=s&&("string"==typeof s||s instanceof String||s instanceof Buffer?_.write(s):_.write(JSON.stringify(s))),_.end()},e.prototype._parseNodeResponse=function(e){try{switch(this._responseType){default:case"text":return e.toString("utf-8");case"json":var t=e.toString("utf-8");try{return JSON.parse(t)}catch(e){return t}case"buffer":return e}}catch(e){return r("bad response: e="+e.toString()),null}},e.prototype.setMethod=function(e){return this._method=e,this},e.prototype.setContentType=function(e){return this._contentType=e,this},e.prototype.setQueryParams=function(e){return this._queryParams=e,this},e.prototype.setQueryParam=function(e,t){return this._queryParams||(this._queryParams={}),this._queryParams[e]=t,this},e.prototype.setData=function(e){return this._data=e,this},e.prototype.setSessionToken=function(e){return this._sessionToken=e,this},e.prototype.setResponseType=function(e){return this._responseType=e,this},e.prototype.addRequestHeader=function(e,t){return void 0!==this._headers[e]&&n("HTTP Request Warning : This header already exists."),this._headers[e]=t,this},e._defaultTimeout=0,e}(),l=function(){function e(e,t){n("_SdeRequest(), className="+e+", methodName="+t),this._className=e,this._methodName=t,this._data=null}return e.prototype.setData=function(e){return this._data=e},e.prototype.execute=function(){var t={},r=new Promise(function(e,r){return t.success=e,t.error=r}),s=e._createRequestId();e._callbacks[s]=t,n("_SdeRequest.execute(), reqId="+s),null==this._data&&(this._data={});var o={data:this._data},i={action:this._className+"."+this._methodName,request_id:s,params:JSON.stringify(o),callback:"Nebula._SdeRequest.sdeCallback"};return n("_SdeRequest.execute(), sdeParams="+JSON.stringify(i)),sde.smt.common.exIfExecute("NebulaSdePlugin","execute",i),r},e._createRequestId=function(){for(var e=0;e<1e3;e++){var t="id_"+this._requestId;if(++this._requestId>=1e3&&(this._requestId=0),!this._callbacks[t])return n("_SdeRequest._createRequestId(), requestId="+t),t}throw n("FATAL Error: Nebula._SdeRequest._createRequestId(), callback slot full!"),"Could not create request ID, callback slot full!"},e.sdeCallback=function(t){try{n("_SdeRequest.sdeCallback()"),n("  params="+JSON.stringify(t)),n("  requestId="+t.requestId),n("  status="+t.status),n("  statusText="+t.statusText),n("  responseText="+t.responseText),n("  response="+t.response);var s=t.requestId;if(null!=s&&null!=e._callbacks[s]){var i=e._callbacks[s];n("  requestId="+s),n("  _callbacks[requestId]="+i);var u=t.status;if(u||(n("_SdeRequest.sdeCallback(), warning:: not found status property"),u=0),u>=200&&u<300)n("_SdeRequest.sdeCallback(), call success callback"),i.success(JSON.stringify(t.response));else{var c=o(t.status,t.statusText,t.responseText);n("Nebula._SdeRequest.sdeCallback(), call error callback: "+c.message+" "+c.responseText),i.error(c)}delete e._callbacks[s],n("_SdeRequest.sdeCallback(), _callbacks : "+JSON.stringify(e._callbacks))}else r("_SdeRequest.sdeCallback(), not found requestId="+s)}catch(e){r("_SdeRequest.sdeCallback(), e="+e)}},e._callbacks={},e._requestId=0,e}(),p=function(){function e(){}return e.setCallback=function(e){this._callback=e,n("_SdeNetworkEventListener.setCallback(), callback="+e);var t={};t.set=!!e;var r={params:JSON.stringify(t),callback:""};return n("_SdeNetworkEventListener.setCallback(), sdeParams="+JSON.stringify(r)),sde.smt.common.exIfExecute("NebulaNetworkEventManager","setNetworkEventListener",r)},e.onNetworkStateChanged=function(e){try{n("_SdeNetworkEventListener.onNetworkStateChanged(), params="+JSON.stringify(e)),null!=this._callback&&null!=this._callback.onNetworkStateChanged?null!=e.isOnline?this._callback.onNetworkStateChanged(e.isOnline):r("_SdeNetworkEventListener.onNetworkStateChanged(), invalid parameters"):n("_SdeNetworkEventListener.onNetworkStateChanged(), no callback")}catch(e){r("_SdeNetworkEventListener.onNetworkStateChanged(), exception="+e)}},e}(),h=function(){function e(){}return e.setListener=function(e,t){if(null!=e){n("_SdeSyncEventListener.setCallback(), before : _listeners="+JSON.stringify(this._listeners));var s=e.getBucketName(),o=e.getBucketMode();null==t?(this._listeners[s]=t,this._bucketMode[s]=o):(null!=this._listeners[s]&&delete this._listeners[s],null!=this._bucketMode[s]&&delete this._bucketMode[s]),n("_SdeSyncEventListener.setCallback(), after  : _listeners="+JSON.stringify(this._listeners));var i={};i.bucketName=s,i.bucketMode=o,i.set=!!t;var u={params:JSON.stringify(i),callback:""};return n("_SyncEventListener.setCallback(), sdeParams="+JSON.stringify(u)),sde.smt.common.exIfExecute("NebulaSyncEventManager","setSyncEventListener",u)}r("_SdeSyncEventListener.setCallback(), no bucket")},e.resolveConflict=function(e){n("_SyncEventListener.resolveConflict(), data="+e);var t={params:JSON.stringify(e),callback:""};return n("_SyncEventListener.resolveConflict(), sdeParams="+JSON.stringify(t)),sde.smt.common.exIfExecute("NebulaSyncEventManager","resolveConflict",t)},e.onSyncStart=function(t){try{if(n("_SdeSyncEventListener.onSyncStart(), params="+JSON.stringify(t)),null!=t.bucketName){var r=t.bucketName,s=e._listeners[r];s&&s.onSyncStart?s.onSyncStart(r):n("_SdeSyncEventListener.onSyncStart(), no callback or onSyncStart")}else n("_SdeSyncEventListener.onSyncStart(), no bucketName")}catch(e){n("_SdeSyncEventListener.onSyncStart(), exception="+e)}},e.onSyncCompleted=function(t){try{if(n("_SdeSyncEventListener.onSyncCompleted(), params="+JSON.stringify(t)),n("_SdeSyncEventListener.onSyncCompleted(), bucketName="+t.bucketName),n("_SdeSyncEventListener.onSyncCompleted(), objectIds="+t.objectIds),null!=t.bucketName&&null!=t.objectIds){var r=t.bucketName,s=e._listeners[r];s&&s.onSyncCompleted?s.onSyncCompleted(r,t.objectIds):n("_SdeSyncEventListener.onSyncCompleted(), no callback or onSyncCompleted")}else n("_SdeSyncEventListener.onSyncCompleted(), no bucketName or objectIds")}catch(e){n("_SdeSyncEventListener.onSyncCompleted(), exception="+e)}},e.onSyncConflicted=function(e){try{if(n("_SdeSyncEventListener.onSyncConflicted(), params="+JSON.stringify(e)),n("_SdeSyncEventListener.onSyncConflicted(), bucketName="+e.bucketName),n("_SdeSyncEventListener.onSyncConflicted(), resolveId="+e.resolveId),n("_SdeSyncEventListener.onSyncConflicted(), client="+e.client),n("_SdeSyncEventListener.onSyncConflicted(), server="+e.server),null!=e.bucketName&&null!=e.resolveId&&null!=e.client&&null!=e.server){var t=e.bucketName,r=this._bucketMode[t];null==r&&(r=D.BUCKET_MODE_REPLICA);var s=this._listeners[t];if(s&&s.onSyncConflicted){var o=new D.ObjectBucket(t,r);o._setResolveId(e.resolveId),s.onSyncConflicted(o,e.client,e.server)}else n("_SdeSyncEventListener.onSyncConflicted(), no callback or onSyncCompleted")}else n("_SdeSyncEventListener.onSyncConflicted(), invalid parameters")}catch(e){n("_SdeSyncEventListener.onSyncConflicted(), exception="+e)}},e.onResolveConflict=function(t){try{if(n("_SdeSyncEventListener.onResolveConflict(), params="+JSON.stringify(t)),n("_SdeSyncEventListener.onResolveConflict(), resolve="+t.resolve),n("_SdeSyncEventListener.onResolveConflict(), object="+t.object),null!=t.bucketName&&null!=t.resolve&&null!=t.object){var r=t.bucketName,s=e._listeners[r];s&&s.onResolveConflict?s.onResolveConflict(t.object,t.resolve):n("Nebula._SdeSyncEventListener.onResolveConflict(), no callback or onResolveConflict")}else n("_SdeSyncEventListener.onSyncConflicted(), invalid parameters")}catch(e){n("_SdeSyncEventListener.onResolveConflict(), exception="+e)}},e.onSyncError=function(t){try{if(n("_SdeSyncEventListener.onSyncError(), params="+JSON.stringify(t)),n("_SdeSyncEventListener.onSyncError(), errorCode="+t.errorCode),n("_SdeSyncEventListener.onSyncError(), object="+t.object),null!=t.bucketName&&null!=t.errorCode&&null!=t.object){var r=t.bucketName,s=e._listeners[r];null!=s&&null!=s.onSyncError?s.onSyncError(t.errorCode,t.object):n("_SdeSyncEventListener.onSyncError(), no callback or onSyncError")}else n("_SdeSyncEventListener.onSyncError(), invalid parameters")}catch(e){n("_SdeSyncEventListener.onSyncError(), exception="+e)}},e._listeners={},e._bucketMode={},e}(),f=function(){function e(){}return Object.defineProperty(e.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iss",{get:function(){return this._iss},set:function(e){this._iss=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sub",{get:function(){return this._sub},set:function(e){this._sub=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"op",{get:function(){return this._op},set:function(e){this._op=e},enumerable:!0,configurable:!0}),e.prototype._setAccountLink=function(e){return null!=e._id&&(this.__id=e._id),null!=e.iss&&(this._iss=e.iss),null!=e.sub&&(this._sub=e.sub),null!=e.op&&(this._op=e.op),this},e}(),d={READ:"r",WRITE:"w",CREATE:"c",UPDATE:"u",DELETE:"d",ADMIN:"admin",OWNER:"owner"},y={AUTHENTICATED:"g:authenticated",ANONYMOUS:"g:anonymous"},_=function(){function e(t){n("Acl(), json="+t),this._acl={r:[],w:[],c:[],u:[],d:[],admin:[]},t&&(t[e.OWNER]&&(this._acl[e.OWNER]=t[e.OWNER]),t[e.READ]&&(this._acl[e.READ]=t[e.READ]),t[e.WRITE]&&(this._acl[e.WRITE]=t[e.WRITE]),t[e.CREATE]&&(this._acl[e.CREATE]=t[e.CREATE]),t[e.UPDATE]&&(this._acl[e.UPDATE]=t[e.UPDATE]),t[e.DELETE]&&(this._acl[e.DELETE]=t[e.DELETE]),t[e.ADMIN]&&(this._acl[e.ADMIN]=t[e.ADMIN]))}return e.prototype.addEntry=function(e,t){var r=this._acl[e];if(!r)return!1;if(!t)return!1;var s=null;s=t instanceof k?t.get("_id"):t instanceof S?"g:"+t.get("groupname"):t;for(var o=!1,i=0,u=r;i<u.length;i++)if(u[i]===s){o=!0;break}return!o&&(r.push(s),n("Acl.addEntry(), added entry="+s),!0)},e.prototype.removeEntry=function(e,t){var r=this._acl[e];if(!r)return!1;if(!t)return!1;var s=null;s=t instanceof k?t.get("_id"):t instanceof S?"g:"+t.get("groupname"):t;for(var o=0;o<r.length;o++)if(r[o]===s){r.splice(o,1),n("Acl.removeEntry(), removed entry="+s);break}},e.prototype._setOwner=function(t){this._acl[e.OWNER]=t},e.prototype.getOwner=function(){return this._acl[e.OWNER]?this._acl[e.OWNER]:null},e.prototype.getEntries=function(e){var t=this._acl[e];return t||null},e.prototype._set=function(e){this._acl=e},e.prototype._hasEntry=function(e,t){var r=this._acl[e];if(r)for(var n=0,s=r;n<s.length;n++)if(s[n]===t)return!0;return!1},e.prototype._toString=function(e){return JSON.stringify(this._toJsonObject(e))},e.prototype._toJsonObject=function(e){if("ACL"===e||"contentACL"===e){var t={};return t[e]=this._acl,t}return this._acl},e.READ="r",e.WRITE="w",e.CREATE="c",e.UPDATE="u",e.DELETE="d",e.ADMIN="admin",e.OWNER="owner",e.AUTHENTICATED="g:authenticated",e.ANONYMOUS="g:anonymous",e}(),g={CASE_INSENSITIVITY:"i"},v=function(){function e(e){this._clause=null!=e?e:{}}return e.prototype._setParams=function(e,t,r,n){if(null===t)this._clause[e]=r;else{var s={};u(this._clause[e])&&(s=this._clause[e]),s[t]=r,n&&(s.$options=n),this._clause[e]=s}return this},e.prototype.json=function(){return this._clause},e.equals=function(t,r){return(new e).equals(t,r)},e.prototype.equals=function(e,t){var r=null;return null!=t&&u(t)&&(r="$eq"),this._setParams(e,r,t)},e.notEquals=function(t,r){return(new e).notEquals(t,r)},e.prototype.notEquals=function(e,t){return this._setParams(e,"$ne",t)},e.lessThan=function(t,r){return(new e).lessThan(t,r)},e.prototype.lessThan=function(e,t){return this._setParams(e,"$lt",t)},e.lessThanOrEqual=function(t,r){return(new e).lessThanOrEqual(t,r)},e.prototype.lessThanOrEqual=function(e,t){return this._setParams(e,"$lte",t)},e.greaterThan=function(t,r){return(new e).greaterThan(t,r)},e.prototype.greaterThan=function(e,t){return this._setParams(e,"$gt",t)},e.greaterThanOrEqual=function(t,r){return(new e).greaterThanOrEqual(t,r)},e.prototype.greaterThanOrEqual=function(e,t){return this._setParams(e,"$gte",t)},e.in=function(t,r){return(new e).in(t,r)},e.prototype.in=function(e,t){return this._setParams(e,"$in",t)},e.all=function(t,r){return(new e).all(t,r)},e.prototype.all=function(e,t){return this._setParams(e,"$all",t)},e.exist=function(t,r){return(new e).exist(t,r)},e.prototype.exist=function(e,t){if("boolean"==typeof t)return this._setParams(e,"$exists",t);throw"exist: value is not boolean"},e.regex=function(t,r,n){return(new e).regex(t,r,n)},e.prototype.regex=function(e,t,r){return this._setParams(e,"$regex",t,r)},e.prototype.not=function(e){var t;return null===this._clause||null==this._clause[e]?null:(u(this._clause[e])?(t={$not:this._clause[e]},this._clause[e]=t):(t={$not:{$eq:this._clause[e]}},this._clause[e]=t),this)},e.and=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e._convertClauseArray(t);return(new e)._setParams("$and",null,n)},e.or=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e._convertClauseArray(t);return(new e)._setParams("$or",null,n)},e._convertClauseArray=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var s=n[r].json();null!=s&&t.push(s)}return t},e}(),m=function(){function e(){this._clause=null,this._limit=-1,this._skip=0,this._sort=[],this._deleteMark=!1,this._countQuery=!1,this._projection=null}return e.prototype.getClause=function(){return this._clause},e.prototype.getLimit=function(){return this._limit},e.prototype.getSkipCount=function(){return this._skip},e.prototype.getSort=function(){return this._sort},e.prototype.getSortOrder=function(){for(var e=[],t=0;t<this._sort.length;t++){var r=this._sort[t],n={};r.match(/^-/)?n[r.substr(1)]=!1:n[r]=!0,e.push(n)}return e},e.prototype._getDeleteMark=function(){return this._deleteMark},e.prototype.getProjection=function(){return this._projection},e.prototype._setDeleteMark=function(e){if("boolean"!=typeof e)throw new Error("deleteMark must be boolean");n("ObjectQuery._setDeleteMark(), mark="+e+", cur="+this._deleteMark),this._deleteMark=e},e.prototype._toParam=function(){var e=this._toParamJson();return e.where&&(e.where=JSON.stringify(e.where)),e.projection&&(e.projection=JSON.stringify(e.projection)),e},e.prototype._toParamJson=function(){var e={};return this._clause&&(e.where=this._clause.json()),this._sort.length>0&&(e.order=this._sort.join(",")),e.skip=this._skip,e.limit=this._limit,this._countQuery&&(e.count=1),this._deleteMark&&(e.deleteMark=1),this._projection&&(e.projection=this._projection),e},e._toObjectQuery=function(t){var r=new e;n("ObjectQuery._toObjectQuery(), queryJson="+JSON.stringify(t)),null!=t.limit&&r.setLimit(t.limit),null!=t.skip&&r.setSkipCount(t.skip);var s=t.sort;if(null!=s)for(var o=0,i=Object.keys(s);o<i.length;o++){var u=i[o];r.setSortOrder(u,s[u])}var c=t.clause;return null!=c&&0!==Object.keys(c).length&&r.setClause(new v(c)),null!=t.deleteMark&&r._setDeleteMark(t.deleteMark),null!=t.countQuery&&r._setCountQuery(t.countQuery),r},e.prototype._equals=function(e){if(this._limit!==e.getLimit())return!1;if(this._skip!==e.getSkipCount())return!1;if(this._deleteMark!==e._getDeleteMark())return!1;if(this._countQuery!==e._isCountQuery())return!1;if(this._projection){if(!e.getProjection())return!1;if(!c(this._projection,e.getProjection()))return!1}else if(e.getProjection())return!1;if(this._clause){if(!e.getClause())return!1;if(!c(this._clause.json(),e.getClause().json()))return!1}else if(e.getClause())return!1;return c(this._sort,e.getSortOrder())},e.prototype.setClause=function(e){if(!(null===e||e instanceof v))throw new Error("clause must be instanceof Nebula.Clause or null");return this._clause=e,this},e.prototype.setLimit=function(e){if(!(e>=-1))throw new Error("Invalid limit range");return this._limit=e,this},e.prototype.setSkipCount=function(e){if(!(e>=0))throw new Error("Invalid skip range");return this._skip=e,this},e.prototype.setSort=function(e){return this._sort=e,this},e.prototype.setSortOrder=function(e,t){if(!e)throw new Error("No key");if("boolean"!=typeof t)throw new Error("isAsc must be boolean");return t?this._sort.push(e):this._sort.push("-"+e),this},e.prototype.clearSortOrder=function(e){if(void 0===e&&(e=null),e)for(var t=0;t<this._sort.length;t++){var r=this._sort[t];if(r===e||r==="-"+e){this._sort.splice(t,1);break}}else this._sort=[];return this},e.prototype._setCountQuery=function(e){if("boolean"!=typeof e)throw new Error("countQuery must be boolean");return this._countQuery=e,this},e.prototype._isCountQuery=function(){return this._countQuery},e.prototype.setProjection=function(e){if(e&&u(e))this._projection=e;else{if(null!==e)throw new Error("projection must be object or null");this._projection=null}return this},e}(),k=function(){function e(e){this._service=e,this.__id=null,this._username=null,this._email=null,this._password=null,this._options=null,this._groups=null,this._createdAt=null,this._updatedAt=null,this._sessionToken=null,this._expire=null,this._clientCertUser=null,this._federated=!1,this._primaryLinkedUserId=null}return Object.defineProperty(e.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"email",{get:function(){return this._email},set:function(e){this._email=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"password",{get:function(){return this._password},set:function(e){this._password=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatedAt",{get:function(){return this._updatedAt},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionToken",{get:function(){return this._sessionToken},set:function(e){this._sessionToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expire",{get:function(){return this._expire},set:function(e){this._expire=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clientCertUser",{get:function(){return this._clientCertUser},set:function(e){this._clientCertUser=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"federated",{get:function(){return this._federated},set:function(e){this._federated=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryLinkedUserId",{get:function(){return this._primaryLinkedUserId},set:function(e){this._primaryLinkedUserId=e},enumerable:!0,configurable:!0}),e.prototype._setUserInfo=function(e){n("User._setUserInfo#start");var t;try{t=JSON.parse(e)}catch(e){r("User._setUserInfo#json error."),t=null}null!==t&&(void 0!==t._id&&(this._id=t._id),void 0!==t.username&&(this.username=t.username),void 0!==t.email&&(this.email=t.email),void 0!==t.password&&(this.password=t.password),void 0!==t.options&&(this.options=t.options),void 0!==t.groups&&(this.groups=t.groups),void 0!==t.createdAt&&(this.createdAt=t.createdAt),void 0!==t.updatedAt&&(this.updatedAt=t.updatedAt),void 0!==t.sessionToken&&(this.sessionToken=t.sessionToken),void 0!==t.expire&&(this.expire=t.expire),void 0!==t.clientCertUser&&(this.clientCertUser=t.clientCertUser),void 0!==t.federated&&(this.federated=t.federated),void 0!==t.primaryLinkedUserId&&(this.primaryLinkedUserId=t.primaryLinkedUserId))},e.prototype.set=function(e,t){switch(e){case"_id":this._id=t;break;case"username":this.username=t;break;case"email":this.email=t;break;case"password":this.password=t;break;case"options":this.options=t;break;case"createdAt":this.createdAt=t;break;case"updatedAt":this._updatedAt=t;break;case"sessionToken":this.sessionToken=t;break;case"expire":this.expire=t;break;case"clientCertUser":this.clientCertUser=t;break;case"federated":this.federated=t;break;case"primaryLinkedUserId":this.primaryLinkedUserId=t;break;default:throw r("Invalid property: "+e),new Error("Invalid property: "+e)}},e.prototype.get=function(e){switch(e){case"_id":return this._id;case"username":return this.username;case"email":return this.email;case"password":return this.password;case"options":return this.options;case"groups":return this.groups;case"createdAt":return this.createdAt;case"updatedAt":return this.updatedAt;case"sessionToken":return this.sessionToken;case"expire":return this.expire;case"clientCertUser":return this.clientCertUser;case"federated":return this.federated;case"primaryLinkedUserId":return this.primaryLinkedUserId;default:throw r("Invalid property"),new Error("Invalid property name")}},e.prototype.register=function(e){var t=this;n("User.register#start");var r;if(this._service.isOffline())r=new l("NebulaUser","register");else{n("User.register#REST API Request path = /users"),(r=new a(this._service,"/users")).setMethod("POST"),r.setContentType("application/json")}var o;!0===this.clientCertUser?o={clientCertUser:!0,username:this.username}:(o={email:this.email,password:this.password},null!=this.username&&(o.username=this.username)),null!==this.options&&(o.options=this.options),r.setData(o);var u=r.execute().then(function(e){return n("User.register#success callback start"),n("User.register#response = "+e),t._setUserInfo(e),t}).catch(function(e){return n("User.register#error callback start"),n("User.register#error = "+i(e)),Promise.reject(e)});return n("User.register#end"),s(u,e)},e._login=function(e,t,r){if(n("User.login#start"),null==t||null==t.email&&null==t.username&&null==t.token)throw new Error("User.login: No username nor email nor token");if(null==t.password&&null==t.token)throw new Error("User.login: No password nor token");var o;if(e.isOffline())o=new l("NebulaUser","login");else{n("User.login#REST API Request path = /login"),(o=new a(e,"/login")).setSessionToken(null),o.setMethod("POST"),o.setContentType("application/json")}o.setData(t);var u=new e.User;u.email=t.email,u.username=t.username;var c=o.execute().then(function(t){return n("User.login#success callback start"),n("User.login#response = "+t),u._setUserInfo(t),e.setCurrentUser(u),u}).catch(function(e){return n("User.login#error callback start"),n("User.login#error = "+i(e)),Promise.reject(e)});return n("User.login#end"),s(c,r)},e._logout=function(e,t){n("User.logout#start");var r;if(e.isOffline())r=new l("NebulaUser","logout");else{n("User.logout#REST API Request path = /login"),(r=new a(e,"/login")).setMethod("DELETE"),r.setContentType("application/json")}var o=r.execute().then(function(t){n("User.logout#success callback start"),n("User.logout#response = "+t),e.removeCurrentUser()}).catch(function(t){return n("User.logout#error callback start"),n("User.logout#error = "+i(t)),e.removeCurrentUser(),Promise.reject(t)});return n("User.logout#end"),s(o,t)},e._current=function(e,t){var r=null,n=e.getCurrentUser();return null!==n&&(r=new e.User)._setUserInfo(JSON.stringify(n)),t&&t.success&&t.success(r),r},e._saveCurrent=function(e,t){if(e.isOffline())throw new Error("Not supported in offline mode");if(null===t)e.removeCurrentUser();else{var r=e.getCurrentUser()||{};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);var s=new e.User;s._setUserInfo(JSON.stringify(r)),e.setCurrentUser(s)}},e._queryCurrent=function(e,t){n("User.queryCurrent#start");var r;if(e.isOffline()){if(null===e.getCurrentUser())return s(Promise.resolve(null),t);r=new l("NebulaUser","current")}else{var o="/users/current";n("User.queryCurrent#REST API Request path = "+o),(r=new a(e,o)).setMethod("GET"),r.setContentType("application/json")}var u=r.execute().then(function(t){n("User.queryCurrent#success callback start"),n("User.queryCurrent#response = "+t);var r=new e.User;return r._setUserInfo(t),r}).catch(function(e){return n("User.queryCurrent#error callback start"),n("User.queryCurrent#error = "+i(e)),Promise.reject(e)});return n("User.queryCurrent#end"),s(u,t)},e._query=function(e,t,r){n("User.query#start");var o;if(e.isOffline())o=new l("NebulaUser","query"),null!==t&&o.setData(t);else{var u="/users",c={};t&&(t._id?u="/users/"+encodeURIComponent(t._id):t.email?c.email=t.email:t.username&&(c.username=t.username),null!=t.skip&&(c.skip=t.skip),null!=t.limit&&(c.limit=t.limit)),n("User.query#REST API Request path = "+u),(o=new a(e,u)).setMethod("GET"),o.setQueryParams(c),o.setContentType("application/json")}var p=o.execute().then(function(r){n("User.query#success callback start"),n("User.query#response = "+r);var s=JSON.parse(r),o=[],i=[],u=0;for(void 0===s.results?o.push(s):o=s.results;u<o.length;){var c=new e.User;c._setUserInfo(JSON.stringify(o[u])),i.push(c),u++}return null!=t&&t.countQuery?{users:i,count:s.count}:i}).catch(function(e){return n("User.query#error callback start"),n("User.query#error = "+i(e)),Promise.reject(e)});return n("User.query#end"),s(p,r)},e._update=function(t,r,n){if(!(r instanceof e))throw new Error("User.update: not User instance");if(r._service!==t)throw new Error("Service does not match");return r._update(n)},e.prototype._update=function(e){var t,r,u,c=this;if(n("User.update#start"),null===this.get("_id"))return n("User.update: no user id"),u=o(400,"Bad Request (local)","no user id."),s(Promise.reject(u),e);var p={};this._service.isOffline()?(r=new l("NebulaUser","update"),p._id=this.get("_id")):(t="/users/"+this.get("_id"),n("User.update#REST API Request path = "+t),(r=new a(this._service,t)).setMethod("PUT"),r.setContentType("application/json"),delete p._id),null!==this.get("email")&&(p.email=this.get("email")),null!==this.get("username")&&(p.username=this.get("username")),null!==this.get("password")&&(p.password=this.get("password")),null!==this.get("options")&&(p.options=this.get("options")),r.setData(p);var h=r.execute().then(function(e){return n("User.update#success callback start"),n("User.update#response = "+e),c._setUserInfo(e),c}).catch(function(e){return n("User.update#error callback start"),n("User.update#error = "+i(e)),Promise.reject(e)});return n("User.update#end"),s(h,e)},e._remove=function(t,r,n){if(!(r instanceof e))throw new Error("User.remove: not User instance");if(r._service!==t)throw new Error("User.remove: service does not match");return r._remove(n)},e.prototype._remove=function(e){var t=this;if(n("User.remove#start"),null===this.get("_id")){n("User.remove: no user id.");var r=o(400,"Bad argument (local)","no user id.");return s(Promise.reject(r),e)}var u;if(this._service.isOffline())(u=new l("NebulaUser","delete")).setData({_id:this.get("_id")});else{var c="/users/"+this.get("_id");n("User.remove#REST API Request path = "+c),(u=new a(this._service,c)).setMethod("DELETE")}var p=u.execute().then(function(e){n("User.remove#success callback start"),n("User.remove#response = "+e);var r=t._service.getCurrentUser();null!==r&&t.get("_id")===r._id&&(n("User.remove#delete user is current user"),t._service.removeCurrentUser())}).catch(function(e){return n("User.remove#error callback start"),n("User.remove#error = "+i(e)),Promise.reject(e)});return n("User.remove#end"),s(p,e)},e._resetPassword=function(e,t,r){if(n("User.resetPassword#start"),null==t||null==t.email&&null==t.username)throw new Error("User.resetPassword: bad arguments");var o;if(e.isOffline())o=new l("NebulaUser","resetPassword");else{var u="/request_password_reset";n("User.resetPassword#REST API Request path = "+u),(o=new a(e,u)).setSessionToken(null),o.setMethod("POST"),o.setContentType("application/json")}var c;void 0!==t.email&&void 0!==t.username?c={email:t.email,username:t.username}:void 0!==t.email&&void 0===t.username?c={email:t.email}:void 0===t.email&&void 0!==t.username&&(c={username:t.username}),o.setData(c);var p=o.execute().then(function(e){n("User.resetPassword#success callback start"),n("User.resetPassword#response = "+e)}).catch(function(e){return n("User.resetPassword#error callback start"),n("User.resetPassword#error = "+i(e)),Promise.reject(e)});return n("User.delete#end"),s(p,r)},e._getAccountLinks=function(t,r,n){if(!(r instanceof e))throw new Error("User.getAccountLinks: not User instance");if(r._service!==t)throw new Error("User.getAccountLinks: Service does not match");return r._getAccountLinks(n)},e.prototype._getAccountLinks=function(e){if(n("User.getAccountLinks#start"),this._service.isOffline())throw new Error("User.getAccountLinks: offline mode is not supported");if(null===this._id)throw new Error("User.getAccountLinks: no user id");var t="/users/"+this._id+"/links";n("User.getAccountLinks#REST API Request path = "+t);var r=new a(this._service,t);r.setMethod("GET");var o=r.execute().then(function(e){n("User.getAccountLinks#response = "+e);var t=JSON.parse(e).results,r=[];if(null!=t)for(var s=0,o=t;s<o.length;s++){var i=o[s],u=new f;u._setAccountLink(i),r.push(u)}return r}).catch(function(e){return n("User.getAccountLinks#error = "+i(e)),Promise.reject(e)});return n("User.getAccountLinks#end"),s(o,e)},e._deleteAccountLink=function(t,r,n,s){if(!(r instanceof e))throw new Error("User.deleteAccountLink: not User instance");if(r._service!==t)throw new Error("User.deleteAccountLink: Service does not match");if(null==n)throw new Error("User.deleteAccountLink: no linkedUserId");return r._deleteAccountLink(n,s)},e.prototype._deleteAccountLink=function(e,t){if(n("User.deleteAccountLink#start"),this._service.isOffline())throw new Error("User.deleteAccountLink: offline mode is not supported");if(null===this._id)throw new Error("User.deleteAccountLink: no user id");if(null!==this.primaryLinkedUserId&&this.primaryLinkedUserId===e)throw new Error("User.deleteAccountLink: linkedUserId is primaryLinkedUserId");var r="/users/"+this._id+"/links/"+e;n("User.deleteAccountLink#REST API Request path = "+r);var o=new a(this._service,r);o.setMethod("DELETE");var u=o.execute().then(function(e){n("User.deleteAccountLink#response = "+e)}).catch(function(e){return n("User.deleteAccountLink#error = "+i(e)),Promise.reject(e)});return n("User.deleteAccountLink#end"),s(u,t)},e}(),b=function(t){t.User=(r=function(r){function s(){var e=r.call(this,t)||this;return n("User.constructor"),e}return e(s,r),s.prototype.set=function(e,t){return r.prototype.set.call(this,e,t),this},s.prototype.get=function(e){return r.prototype.get.call(this,e)},s.prototype.register=function(e){return r.prototype.register.call(this,e)},s.login=function(e,n){return r._login.call(this,t,e,n)},s.logout=function(e){return r._logout.call(this,t,e)},s.current=function(e){return r._current.call(this,t,e)},s.saveCurrent=function(e){r._saveCurrent.call(this,t,e)},s.queryCurrent=function(e){return r._queryCurrent.call(this,t,e)},s.query=function(e,n){return r._query.call(this,t,e,n)},s.update=function(e,n){return r._update.call(this,t,e,n)},s.remove=function(e,n){return r._remove.call(this,t,e,n)},s.resetPassword=function(e,n){return r._resetPassword.call(this,t,e,n)},s.getAccountLinks=function(e,n){return r._getAccountLinks.call(this,t,e,n)},s.deleteAccountLink=function(e,n,s){return r._deleteAccountLink.call(this,t,e,n,s)},s}(k),r.delete=r.remove,r);var r},S=function(){function e(e,t){this._service=e,this._id=null,this.groupname=null,this.users=[],this.groups=[],this.acl=null,this.createdAt=null,this.updatedAt=null,this.etag=null,"string"==typeof t&&""!==t&&(this.groupname=t)}return Object.defineProperty(e.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupname",{get:function(){return this._groupname},set:function(e){this._groupname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"users",{get:function(){return this._users},set:function(e){this._users=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acl",{get:function(){return this._acl},set:function(e){if(null!=e&&!(e instanceof _))throw new Error("acl is not Acl instance!");this._acl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatedAt",{get:function(){return this._updatedAt},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"etag",{get:function(){return this._etag},set:function(e){this._etag=e},enumerable:!0,configurable:!0}),e.prototype._setGroupInfo=function(e){var t;try{t=JSON.parse(e)}catch(e){return void r("Group._setGroupInfo#json error.")}if(void 0!==t._id&&(this._id=t._id),void 0!==t.name&&(this.groupname=t.name),void 0!==t.users&&(this.users=t.users),void 0!==t.groups&&(this.groups=t.groups),void 0!==t.ACL&&(this.acl=new _,this.acl._set(t.ACL),void 0!==t.ACL[_.OWNER]&&this.acl._setOwner(t.ACL[_.OWNER])),void 0!==t.createdAt&&(this.createdAt=t.createdAt),void 0!==t.updatedAt&&(this.updatedAt=t.updatedAt),void 0!==t.etag)return this.etag=t.etag},e.prototype.set=function(e,t){switch(e){case"_id":this._id=t;break;case"groupname":this.groupname=t;break;case"users":this.users=t;break;case"groups":this.groups=t;break;case"acl":this.acl=t;break;case"createdAt":this.createdAt=t;break;case"updatedAt":this.updatedAt=t;break;case"etag":this.etag=t;break;default:throw r("Invalid property: "+e),new Error("Invalid property: "+e)}},e.prototype.get=function(e){switch(e){case"_id":return this._id;case"groupname":return this.groupname;case"users":return this.users;case"groups":return this.groups;case"acl":return this.acl;case"createdAt":return this.createdAt;case"updatedAt":return this.updatedAt;case"etag":return this.etag;default:throw r("Invalid property: "+e),new Error("Invalid property: "+e)}},e.prototype.addEntry=function(e){n("Group.addEntry#start");var t=[],r=null;if(e instanceof this._service.User)r=e.get("_id"),t=this.users;else{if(!(e instanceof this._service.Group))throw new Error("Group.addEntry: Invalid entry");r=e.get("groupname"),t=this.groups}for(var s=!1,o=0,i=t;o<i.length;o++)i[o]===r&&(s=!0);return s||t.push(r),n("Group.addEntry#end"),!0},e.prototype.removeEntry=function(e){n("Group.removeEntry#start");var t=[],r=null;if(e instanceof this._service.User)r=e.get("_id"),t=this.users;else{if(!(e instanceof this._service.Group))throw new Error("Group.removeEntry: Invalid entry");r=e.get("groupname"),t=this.groups}for(var s=0;s<t.length;s++)if(t[s]===r){t.splice(s,1);break}return n("Group.removeEntry#end"),!0},e.prototype.save=function(e){var t=this;if(n("Group.save#start"),null==this.groupname)throw new Error("Group.save: no group name");var r,o={};if(this._service.isOffline())r=new l("NebulaGroup","save"),o.groupname=this.groupname,null!=this.etag&&(o.etag=this.etag);else{var u="/groups/"+encodeURIComponent(this.groupname);n("Group.save#REST API Request path = "+u),r=new a(this._service,u),null!=this.etag&&r.setQueryParam("etag",this.etag),r.setMethod("PUT"),r.setContentType("application/json")}o.users=this.users,o.groups=this.groups,null!==this.acl&&(o.ACL=this.acl._toJsonObject()),r.setData(o);var c=r.execute().then(function(e){return n("Group.save#success callback start"),n("Group.save#response = "+e),t._setGroupInfo(e),t}).catch(function(e){return n("Group.save#error callback start"),n("Group.save#error = "+i(e)),Promise.reject(e)});return n("Group.save#end"),s(c,e)},e.prototype.addMembers=function(e,t,r){return this._addRemoveMembers("add",e,t,r)},e.prototype.removeMembers=function(e,t,r){return this._addRemoveMembers("remove",e,t,r)},e.prototype._addRemoveMembers=function(e,t,r,o){var u=this;if(n("Group."+e+"Members#start"),null==this.groupname)throw new Error("No group name");if(this._service.isOffline())throw new Error("offline mode is not supported.");var c="/groups/"+encodeURIComponent(this.groupname)+"/"+e+"Members",l=new a(this._service,c);l.setMethod("PUT"),l.setContentType("application/json");var p={users:null!=t?t:[],groups:null!=r?r:[]};l.setData(p);var h=l.execute().then(function(t){return n("Group."+e+"Members#response = "+t),u._setGroupInfo(t),u}).catch(function(t){return n("Group."+e+"Members#error = "+i(t)),Promise.reject(t)});return s(h,o)},e._remove=function(t,r,n){if(!(r instanceof e))throw new Error("Group.remove: not Group instance!");if(r._service!==t)throw new Error("Service does not match");return r._remove(n)},e.prototype._remove=function(e){n("Group.remove#start");var t,r;if(this._service.isOffline())t=new l("NebulaGroup","delete"),r={groupname:this.get("groupname")},null!=(u=this.get("etag"))&&(r.etag=u),t.setData(r);else{var o="/groups/"+encodeURIComponent(this.get("groupname"));n("Group.remove#REST API Request path = "+o),t=new a(this._service,o);var u=this.get("etag");null!=u&&t.setQueryParam("etag",u),t.setMethod("DELETE")}var c=t.execute().then(function(e){n("Group.remove#success callback start"),n("Group.remove#response = "+e)}).catch(function(e){return n("Group.remove#error callback start"),n("Group.remove#error = "+i(e)),Promise.reject(e)});return n("Group.remove#end"),s(c,e)},e._query=function(e,t,r){n("Group.query#start");var o=null;if(null!=t){if(null==t.groupname)throw new Error("Group.query: no groupname in conditions");o=t.groupname}var u;if(e.isOffline())u=new l("NebulaGroup","query"),null!==o&&u.setData({groupname:o});else{var c=void 0;c=null!==o?"/groups/"+encodeURIComponent(o):"/groups",n("Group.query#REST API Request path = "+c),(u=new a(e,c)).setMethod("GET"),u.setContentType("application/json")}var p=u.execute().then(function(t){n("Group.query#response = "+t);var r=JSON.parse(t),s=[],o=[];void 0===r.results?s.push(r):s=r.results;for(var i=0,u=s;i<u.length;i++){var c=u[i],a=new e.Group(c.name);a._setGroupInfo(JSON.stringify(c)),o.push(a)}return o}).catch(function(e){return n("Group.query#error = "+i(e)),Promise.reject(e)});return n("Group.query#end"),s(p,r)},e}(),w=function(t){t.Group=(r=function(r){function s(e){var s=r.call(this,t,e)||this;return n("Group.constructor"),s}return e(s,r),s.prototype.set=function(e,t){return r.prototype.set.call(this,e,t),this},s.prototype.get=function(e){return r.prototype.get.call(this,e)},s.prototype.addEntry=function(e){return r.prototype.addEntry.call(this,e)},s.prototype.removeEntry=function(e){return r.prototype.removeEntry.call(this,e)},s.prototype.save=function(e){return r.prototype.save.call(this,e)},s.remove=function(e,n){return r._remove.call(this,t,e,n)},s.prototype.addMembers=function(e,t,n){return r.prototype.addMembers.call(this,e,t,n)},s.prototype.removeMembers=function(e,t,n){return r.prototype.removeMembers.call(this,e,t,n)},s.query=function(e,n){return r._query.call(this,t,e,n)},s}(S),r.delete=r.remove,r);var r},N=function(){function e(){this._createdAt=null,this._updatedAt=null,this._acl=null,this._contentType=null,this._publicUrl=null,this._fileName=null,this._fileSize=-1,this._syncState=e.SYNC_STATE_UNDEFINED,this._lastSyncTime=null,this._metaId=null,this._metaETag=null,this._fileETag=null,this._options=null,this._cacheDisabled=!1}return e.prototype.getFileName=function(){return this._fileName},e.prototype.setFileName=function(e){return n("FileMetadata.setFileName(), "+this._fileName+" ---\x3e "+e),this._fileName=e,this},e.prototype.getAcl=function(){return this._acl},e.prototype.setAcl=function(e){if(null!=e&&!(e instanceof _))throw new Error("FileMetadata.setAcl: Not Acl instance!");return this._acl=e,this},e.prototype.getContentType=function(){return this._contentType},e.prototype.setContentType=function(e){return n("FileMetadata.setContentType(), "+this._contentType+" -> "+e),this._contentType=e,this},e.prototype.getCreatedAt=function(){return this._createdAt},e.prototype._setCreatedAt=function(e){return this._createdAt=e,this},e.prototype.getUpdatedAt=function(){return this._updatedAt},e.prototype._setUpdatedAt=function(e){return this._updatedAt=e,this},e.prototype.getSize=function(){return this._fileSize},e.prototype._setSize=function(e){return this._fileSize=e,this},e.prototype.getPublicUrl=function(){return this._publicUrl},e.prototype._setPublicUrl=function(e){return this._publicUrl=e,this},e.prototype.getFileSyncState=function(){return this._syncState},e.prototype._setFileSyncState=function(e){return this._syncState=e,this},e.prototype.getLastSyncTime=function(){return this._lastSyncTime},e.prototype._setLastSyncTime=function(e){return this._lastSyncTime=e,this},e.prototype.getMetaId=function(){return this._metaId},e.prototype._setMetaId=function(e){return this._metaId=e,this},e.prototype.getMetaETag=function(){return this._metaETag},e.prototype._setMetaETag=function(e){return this._metaETag=e,this},e.prototype.getFileETag=function(){return this._fileETag},e.prototype._setFileETag=function(e){return this._fileETag=e,this},e.prototype.getOptions=function(){return this._options},e.prototype.setOptions=function(e){return this._options=e,this},e.prototype.isCacheDisabled=function(){return this._cacheDisabled},e.prototype.setCacheDisabled=function(e){return this._cacheDisabled=e,this},e.prototype._setMetadata=function(e){if(null!=e.filename&&this.setFileName(e.filename),null!=e.contentType&&this.setContentType(e.contentType),null!=e.ACL){var t=new _(e.ACL);this.setAcl(t)}return null!=e.length&&this._setSize(e.length),null!=e.publicUrl&&this._setPublicUrl(e.publicUrl),null!=e.createdAt&&this._setCreatedAt(e.createdAt),null!=e.updatedAt&&this._setUpdatedAt(e.updatedAt),null!=e.lastSyncTime&&this._setLastSyncTime(e.lastSyncTime),null!=e.metaId&&this._setMetaId(e.metaId),null!=e.metaETag&&this._setMetaETag(e.metaETag),null!=e.fileETag&&this._setFileETag(e.fileETag),null!=e.options&&this.setOptions(e.options),null!=e.cacheDisabled&&this.setCacheDisabled(e.cacheDisabled),null!=e.fileSyncState&&this._setFileSyncState(e.fileSyncState),this},e.SYNC_STATE_UNDEFINED=-1,e.SYNC_STATE_SYNCED=0,e.SYNC_STATE_DIRTY=1,e.SYNC_STATE_SYNCING=3,e.SYNC_STATE_CONFLICTED=5,e}(),E=function(){function e(e,t,r,n){void 0===n&&(n=D.BUCKET_MODE_ONLINE),this._service=e,this._type=r,this._name=t,this._acl=null,this._contentAcl=null,this._description=null,n!==D.BUCKET_MODE_ONLINE&&n!==D.BUCKET_MODE_REPLICA&&n!==D.BUCKET_MODE_LOCAL?this._mode=D.BUCKET_MODE_ONLINE:this._mode=n}return e._baseLoadBucket=function(t,r,u,c,p){n("BaseBucket.loadBucket(), name="+u+", type="+t+", callbacks="+p+", mode="+c);var h;if(r.isOffline()){h=new l(e.getClassName(t),"loadBucket");var f={bucketName:u};c!==D.BUCKET_MODE_ONLINE&&c!==D.BUCKET_MODE_REPLICA&&c!==D.BUCKET_MODE_LOCAL&&(c=D.BUCKET_MODE_ONLINE),f.bucketMode=c,h.setData(f)}else{var d="/buckets/"+t+"/"+encodeURIComponent(u);(h=new a(r,d)).setMethod("GET"),h.setContentType("application/json")}var y=h.execute().then(function(e){try{n("BaseBucket.loadBucket(), success : "+e);var s=JSON.parse(e),i=s.name;if(null==i){n("BaseBucket.loadBucket(), invalid bucket name, name="+i);y=o(0,"Invalid response","",u);return Promise.reject(y)}n("BaseBucket.loadBucket(), new Bucket, name="+i);var a=void 0;a="file"===t?new r.FileBucket(i):new r.ObjectBucket(i,c);var l=s.ACL;if(null!=l){n("BaseBucket.loadBucket(), acl="+l);var p=new _;p._set(l),a.setAcl(p)}var h=s.contentACL;if(null!=h){n("BaseBucket.loadBucket(), contentAcl="+h);var f=new _;f._set(h),a.setContentAcl(f)}var d=s.description;return null!=d&&(n("BaseBucket.loadBucket(), description="+d),a.setDescription(d)),a}catch(e){n("BaseBucket.loadBucket(), error : exception"+e);var y=o(0,e,e.toString(),u);return Promise.reject(y)}},function(e){return n("BaseBucket.loadBucket(), error: "+i(e)),e.data=u,Promise.reject(e)});return s(y,p)},e._baseGetBucketList=function(t,r,u,c){n("BaseBucket.getBucketList(), type="+t+", callbacks="+c);var p;if(r.isOffline()){var h="getBucketList";u&&(h="getLocalBucketList"),p=new l(e.getClassName(t),h)}else(p=new a(r,"/buckets/"+t)).setMethod("GET"),p.setContentType("application/json");var f=p.execute().then(function(e){try{n("BaseBucket.getBucketList(), success : "+e);var t=JSON.parse(e).results;if(null!=t){n("BaseBucket.getBucketList(), buckets="+t);for(var r=[],s=0,i=t;s<i.length;s++){var u=i[s];n("BaseBucket.getBucketList(), success : add bucketName = "+u.name),null!=u.name?r.push(u.name):n("BaseBucket.getBucketList(), [WARNING] No name in response")}return r}n("BaseBucket.getBucketList(), invalid response");c=o(0,"Invalid response","",name);return Promise.reject(c)}catch(e){n("BaseBucket.getBucketList(), success : exception"+e);var c=o(0,e,e);return Promise.reject(c)}},function(e){return n("BaseBucket.getBucketList(), error: "+i(e)),Promise.reject(e)});return s(f,c)},e.prototype.saveBucket=function(t){var r=this;n("BaseBucket.saveBucket(), callbacks="+t);var o;if(this._service.isOffline())o=new l(e.getClassName(this._type),"saveBucket");else{var u=this.getPath();(o=new a(this._service,u)).setMethod("PUT"),o.setContentType("application/json")}var c={};null!=this._acl&&(c.ACL=this._acl._toJsonObject()),null!=this._contentAcl&&(c.contentACL=this._contentAcl._toJsonObject()),null!=this._description&&(c.description=this._description),this._service.isOffline()&&(c.bucketName=this.getBucketName(),c.bucketMode=this.getBucketMode()),o.setData(c),n("BaseBucket.saveBucket(), body="+JSON.stringify(c));var p=o.execute().then(function(e){n("success : "+e),n("bucketName : "+r.getBucketName());try{n("success : "+e);var t=JSON.parse(e);return null!=t.ACL&&(r._acl||(r._acl=new _),r._acl._set(t.ACL)),null!=t.contentACL&&(r._contentAcl||(r._contentAcl=new _),r._contentAcl._set(t.contentACL)),r}catch(e){return n("success : "+e),Promise.reject(e)}},function(e){return n("error: "+i(e)),e.data=r,Promise.reject(e)});return s(p,t)},e.prototype.deleteBucket=function(t){var r=this;n("BaseBucket.deleteBucket(), callbacks="+t);var o;if(this._service.isOffline()){o=new l(e.getClassName(this._type),"deleteBucket");var u={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};o.setData(u)}else{var c=this.getPath();(o=new a(this._service,c)).setMethod("DELETE"),o.setContentType("application/json")}var p=o.execute().then(function(){return n("BaseBucket.deleteBucket(), success"),r},function(e){return n("BaseBucket.deleteBucket(), error: "+i(e)),e.data=r,Promise.reject(e)});return s(p,t)},e.prototype.setAcl=function(e){if(null!=e&&!(e instanceof _))throw new Error("setAcl: not Acl instance!");this._acl=e},e.prototype.getAcl=function(){return this._acl},e.prototype.setContentAcl=function(e){if(null!=e&&!(e instanceof _))throw new Error("setContentAcl: not Acl instance!");this._contentAcl=e},e.prototype.getContentAcl=function(){return this._contentAcl},e.prototype.setDescription=function(e){this._description=e},e.prototype.getDescription=function(){return this._description},e.prototype.getBucketName=function(){return this._name},e.prototype.setBucketName=function(e){this._name=e},e.prototype.getBucketMode=function(){return this._mode},e.prototype.getPath=function(e){var t="/buckets/"+this._type+"/"+encodeURIComponent(this._name);return null!=e&&(t+=e),t},e.prototype.getDataPath=function(e){var t="objects";"file"===this._type&&(t="files");var r="/"+t+"/"+encodeURIComponent(this._name);return null!=e&&(r+=e),r},e.getClassName=function(e){var t="NebulaObjectBucket";return"file"===e&&(t="NebulaFileBucket"),t},e.prototype.getClassName=function(){return e.getClassName(this._type)},e}(),C=function(t){function u(e,r,n){void 0===n&&(n=D.BUCKET_MODE_ONLINE);var s=t.call(this,e,r,"object",n)||this;return s._resolveId=null,s}return e(u,t),u._loadBucket=function(e,t,r,s){return n("ObjectBucket.loadBucket(), name="+t+", callbacks="+r),E._baseLoadBucket("object",e,t,s,r)},u._getBucketList=function(e,t){return n("ObjectBucket.getBucketList(), callbacks="+t),E._baseGetBucketList("object",e,!1,t)},u._getLocalBucketList=function(e,t){return n("ObjectBucket.getLocalBucketList(), callbacks="+t),E._baseGetBucketList("object",e,!0,t)},u.prototype.load=function(e,t){if(n("ObjectBucket.load()"),null==e)throw r("ObjectBucket.load(), Parameter is invalid"),new Error("No objectId");var u;if(this._service.isOffline()){u=new l(this.getClassName(),"load");var c={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e};u.setData(c)}else{var p=this.getDataPath("/"+e);(u=new a(this._service,p)).setMethod("GET"),u.setContentType("application/json")}var h=u.execute().then(function(t){try{var r=JSON.parse(t);return n("ObjectBucket.load(), success : response="+t),r}catch(r){n("ObjectBucket.load(), success : response="+t);var s=o(0,"Invalid response from server",r);return s.data=e,Promise.reject(s)}},function(t){return n("ObjectBucket.load(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(h,t)},u.prototype.remove=function(e,t,o){if(n("ObjectBucket.delete)"),null==e)throw r("ObjectBucket.remove(), Parameter is invalid"),new Error("No objectId");var u;if(this._service.isOffline()){u=new l(this.getClassName(),"delete");var c={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e};o&&(c.etag=o),u.setData(c)}else{var p=this.getDataPath("/"+e);(u=new a(this._service,p)).setMethod("DELETE"),u.setContentType("application/json"),o&&u.setQueryParam("etag",o)}var h=u.execute().then(function(t){return n("ObjectBucket.delete(), success"),e},function(t){return n("ObjectBucket.delete(), error: "+i(t)),t.objectId=e,Promise.reject(t)});return s(h,t)},u.prototype.save=function(e,t){if(n("ObjectBucket.save()"),!e)throw r("ObjectBucket.save(), Parameter is invalid"),new Error("No object");var u;if(this._service.isOffline()){u=new l(this.getClassName(),"save");var c={object:e,bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};u.setData(c)}else{var p={},h=void 0,f=void 0;null!=e._id?(h=this.getDataPath("/"+e._id),f="PUT",null!=e.etag&&(p.etag=e.etag)):(h=this.getDataPath(),f="POST"),n("ObjectBucket.save(), path="+h),(u=new a(this._service,h)).setContentType("application/json"),u.setMethod(f),u.setQueryParams(p),u.setData(e)}var d=u.execute().then(function(t){try{var r=JSON.parse(t);return n("ObjectBucket.save(), success"),r}catch(t){n("ObjectBucket.save(), success : exception="+t);var s=o(0,"Invalid response from server",t);return s.data=e,Promise.reject(s)}},function(t){return n("ObjectBucket.save(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(d,t)},u.prototype.query=function(e,t){return this._query(e,{longQuery:this._service.ObjectBucket.useLongQuery},t)},u.prototype.longQuery=function(e,t){return this._query(e,{longQuery:!0},t)},u.prototype.queryWithCount=function(e,t){return this._query(e,{countQuery:!0,longQuery:this._service.ObjectBucket.useLongQuery},t)},u.prototype.longQueryWithCount=function(e,t){return this._query(e,{countQuery:!0,longQuery:!0},t)},u.prototype._query=function(e,t,r){n("ObjectBucket.query()"),t.countQuery&&(null==e&&(e=new m),e._setCountQuery(t.countQuery));var u,c;if(this._service.isOffline()){u=new l(this.getClassName(),"query");var p={};null!=e&&(null!=e.getClause()&&null!=e.getClause().json()&&(p.clause=e.getClause().json()),p.limit=e.getLimit(),p.skip=e.getSkipCount(),p.sort=e.getSort(),p.deleteMark=e._getDeleteMark(),p.countQuery=e._isCountQuery()),p.bucketName=this.getBucketName(),p.bucketMode=this.getBucketMode(),u.setData(p)}else t.longQuery?(c=this.getDataPath("/_query"),(u=new a(this._service,c)).setMethod("POST"),u.setContentType("application/json"),u.setData(null!=e?e._toParamJson():{})):(c=this.getDataPath(),(u=new a(this._service,c)).setMethod("GET"),null!=e&&u.setQueryParams(e._toParam()));var h=u.execute().then(function(t){try{var r=JSON.parse(t),s=r.results;if(n("ObjectBucket.query(), success : size="+s.length),null!=e&&!0===e._isCountQuery()){var i=-1;return null!=r.count&&(i=r.count),{objects:s,count:i}}return s}catch(e){n("ObjectBucket.query(), success : exception="+e);var u=o(0,e.toString(),e);return Promise.reject(u)}},function(e){return n("ObjectBucket.query(), error: "+i(e)),Promise.reject(e)});return s(h,r)},u.prototype._checkOfflineService=function(){if(this._service!==D)throw r("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!this._service.isOffline())throw r("ObjectBucket.setSyncScope(), supported offline mode only"),new Error("No offline mode enabled")},u.prototype.setSyncScope=function(e,t){this._checkOfflineService();var r=new l(E.getClassName(),"setSyncScope"),o={},u={};null!=e&&(null!=e.getClause()&&null!=e.getClause().json()&&(u.clause=e.getClause().json()),o.scope=u),o.bucketName=this.getBucketName(),o.bucketMode=this.getBucketMode(),n("ObjectBucket.setSyncScope(), body="+JSON.stringify(o)),r.setData(o);var c=r.execute().then(function(e){n("ObjectBucket.setSyncScope(), success : response="+e)},function(e){return n("ObjectBucket.setSyncScope(), error: "+i(e)),Promise.reject(e)});return s(c,t)},u.prototype.getSyncScope=function(e){this._checkOfflineService();var t=new l(E.getClassName(),"getSyncScope"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var u=t.execute().then(function(e){n("ObjectBucket.getSyncScope(), success : response="+e);try{var t=JSON.parse(e);if(null!=t.scope){var r=null;return c(t.scope,{})||(r=m._toObjectQuery(t.scope)),n("ObjectBucket.getSyncScope(), success : callback_data="+t.scope),r}return n("ObjectBucket.getSyncScope(), success : no scope property"),Promise.reject(o(0,"Invalid response - no scope property",""))}catch(e){return n("ObjectBucket.getSyncScope(), success : exception="+e),Promise.reject(o(0,e.toString(),e))}},function(e){return n("ObjectBucket.getSyncScope(), error: "+i(e)),Promise.reject(e)});return s(u,e)},u.prototype.getResolveConflictPolicy=function(e){n("ObjectBucket.getResolveConflictPolicy()"),this._checkOfflineService();var t=new l(E.getClassName(),"getResolveConflictPolicy"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var u=t.execute().then(function(e){n("ObjectBucket.getResolveConflictPolicy(), success : response="+e);try{var t=JSON.parse(e);return null!=t.results?t.results:(n("ObjectBucket.getResolveConflictPolicy(), success : no results"),Promise.reject(o(0,"No results","")))}catch(e){return n("ObjectBucket.getResolveConflictPolicy(), success : exception="+e),Promise.reject(o(0,e.toString(),e))}},function(e){return n("ObjectBucket.getResolveConflictPolicy(), error: "+i(e)),Promise.reject(e)});return s(u,e)},u.prototype.setResolveConflictPolicy=function(e,t){if(n("ObjectBucket.setResolveConflictPolicy()"),this._checkOfflineService(),null==e)throw r("ObjectBucket.setResolveConflictPolicy(), invalid parameter: no policy"),new Error("No policy");var o=new l(E.getClassName(),"setResolveConflictPolicy"),u={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),policy:e};o.setData(u);var c=o.execute().then(function(e){n("ObjectBucket.setResolveConflictPolicy(), success : response="+e)},function(e){return n("ObjectBucket.setResolveConflictPolicy(), error: "+i(e)),Promise.reject(e)});return s(c,t)},u.prototype.removeCacheBucket=function(e){n("ObjectBucket.removeCacheBucket()"),this._checkOfflineService();var t=new l(E.getClassName(),"removeCacheBucket"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){n("ObjectBucket.removeCacheBucket(), success : response="+e)},function(e){return n("ObjectBucket.removeCacheBucket(), error: "+i(e)),Promise.reject(e)});return s(o,e)},u.prototype.setSyncEventListener=function(e){return this._checkOfflineService(),h.setListener(this,e)},u._sync=function(e,t){if(n("ObjectBucket.sync()"),e!==D)throw r("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!e.isOffline())throw r("ObjectBucket.sync(), supported offline mode only"),new Error("No offline mode enabled");var o=new l(E.getClassName(),"sync").execute().then(function(e){n("ObjectBucket.sync(), success : response="+e)},function(e){return n("ObjectBucket.sync(), error: "+i(e)),Promise.reject(e)});return s(o,t)},u.prototype.syncBucket=function(e){n("ObjectBucket.syncBucket()"),this._checkOfflineService();var t=new l(E.getClassName(),"syncBucket"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){n("ObjectBucket.syncBucket(), success : response="+e)},function(e){return n("ObjectBucket.syncBucket(), error: "+i(e)),Promise.reject(e)});return s(o,e)},u.prototype.resolveConflict=function(e,t){if(n("ObjectBucket.resolveConflict()"),this._checkOfflineService(),null==e||null==t||null==this._resolveId)throw r("ObjectBucket.syncObject(), invalid parameter, objectId="+e+", resolve="+t+", resolveId="+this._resolveId),new Error("No objectId/resolve/resolveId");var s={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e,resolveId:this._getResolveId(),resolve:t};return h.resolveConflict(s)},u.prototype.setIndexToLocal=function(e,t){if(n("ObjectBucket.setIndexLocal()"),this._checkOfflineService(),!e)throw r("ObjectBucket.setIndexLocal(), parameter is invalid"),new Error("No index");if(!e.index)throw r("ObjectBucket.setIndexLocal(), index is invalid"),new Error("No index property");var o=new l(this.getClassName(),"setIndexToLocal");e.bucketName=this.getBucketName(),e.bucketMode=this.getBucketMode(),o.setData(e);var u=o.execute().then(function(){n("ObjectBucket.setIndexLocal(), success")},function(e){return n("ObjectBucket.setIndexLocal(), error: "+i(e)),Promise.reject(e)});return s(u,t)},u.prototype.getIndexFromLocal=function(e){n("ObjectBucket.getIndexLocal()"),this._checkOfflineService();var t=new l(this.getClassName(),"getIndexFromLocal"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var u=t.execute().then(function(e){n("ObjectBucket.getIndexLocal(), success");try{return JSON.parse(e).results}catch(e){n("ObjectBucket.getIndexLocal(), success : exception="+e);var t=o(0,e.toString(),e);return Promise.reject(t)}},function(e){return n("ObjectBucket.getIndexLocal(), error: "+i(e)),Promise.reject(e)});return s(u,e)},u.prototype.getLastSyncTime=function(e){n("ObjectBucket.getLastSyncTime()"),this._checkOfflineService();var t=new l(E.getClassName(),"getLastSyncTime"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var u=t.execute().then(function(e){n("ObjectBucket.getLastSyncTime(), success : response="+e);try{var t=JSON.parse(e);return null!=t.results?t.results:(n("ObjectBucket.getLastSyncTime(), success : no results"),null)}catch(e){return n("ObjectBucket.getLastSyncTime(), success : exception="+e),Promise.reject(o(0,e.toString(),e))}},function(e){return n("ObjectBucket.getLastSyncTime(), error: "+i(e)),Promise.reject(e)});return s(u,e)},u.prototype._getResolveId=function(){return n("ObjectBucket._getResolveId(), resolveId="+this._resolveId),this._resolveId},u.prototype._setResolveId=function(e){return n("ObjectBucket._setResolveId(), cur="+this._resolveId+", new="+e),this._resolveId=e},u.prototype.batch=function(e,t){var r=this.getDataPath("/_batch"),n=new a(this._service,r);n.setMethod("POST"),n.setContentType("application/json"),n.setData(e.json);var o=n.execute().then(function(e){for(var t=JSON.parse(e),r=0,n=0,s=t.results;n<s.length;n++)"ok"!==s[n].result&&r++;return t.failedCount=r,t},function(e){return Promise.reject(e)});return s(o,t)},u}(E),B=function(t){t.ObjectBucket=(r=function(r){function n(e,n){return void 0===n&&(n=D.BUCKET_MODE_ONLINE),r.call(this,t,e,n)||this}return e(n,r),n.loadBucket=function(e,n,s){return r._loadBucket.call(this,t,e,n,s)},n.getBucketList=function(e){return r._getBucketList.call(this,t,e)},n.getLocalBucketList=function(e){return r._getLocalBucketList.call(this,t,e)},n.prototype.saveBucket=function(e){return r.prototype.saveBucket.call(this,e)},n.prototype.deleteBucket=function(e){return r.prototype.deleteBucket.call(this,e)},n.prototype.setAcl=function(e){return r.prototype.setAcl.call(this,e),this},n.prototype.getAcl=function(){return r.prototype.getAcl.call(this)},n.prototype.setContentAcl=function(e){return r.prototype.setContentAcl.call(this,e),this},n.prototype.getContentAcl=function(){return r.prototype.getContentAcl.call(this)},n.prototype.setDescription=function(e){return r.prototype.setDescription.call(this,e)},n.prototype.getDescription=function(){return r.prototype.getDescription.call(this)},n.prototype.getBucketName=function(){return r.prototype.getBucketName.call(this)},n.prototype._setBucketName=function(e){return r.prototype.setBucketName.call(this,e)},n.prototype.getBucketMode=function(){return r.prototype.getBucketMode.call(this)},n.prototype.load=function(e,t){return r.prototype.load.call(this,e,t)},n.prototype.remove=function(e,t,n){return r.prototype.remove.call(this,e,t,n)},n.prototype.delete=function(e,t,n){return r.prototype.remove.call(this,e,t,n)},n.prototype.save=function(e,t){return r.prototype.save.call(this,e,t)},n.prototype.query=function(e,t){return r.prototype.query.call(this,e,t)},n.prototype.longQuery=function(e,t){return r.prototype.longQuery.call(this,e,t)},n.prototype.queryWithCount=function(e,t){return r.prototype.queryWithCount.call(this,e,t)},n.prototype.longQueryWithCount=function(e,t){return r.prototype.longQueryWithCount.call(this,e,t)},n.prototype.setSyncScope=function(e,t){return r.prototype.setSyncScope.call(this,e,t)},n.prototype.getSyncScope=function(e){return r.prototype.getSyncScope.call(this,e)},n.prototype.getResolveConflictPolicy=function(e){return r.prototype.getResolveConflictPolicy.call(this,e)},n.prototype.setResolveConflictPolicy=function(e,t){return r.prototype.setResolveConflictPolicy.call(this,e,t)},n.prototype.removeCacheBucket=function(e){return r.prototype.removeCacheBucket.call(this,e)},n.prototype.setSyncEventListener=function(e){r.prototype.setSyncEventListener.call(this,e)},n.sync=function(e){return r._sync.call(this,t,e)},n.prototype.syncBucket=function(e){return r.prototype.syncBucket.call(this,e)},n.prototype.resolveConflict=function(e,t){return r.prototype.resolveConflict.call(this,e,t)},n.prototype.setIndexToLocal=function(e,t){return r.prototype.setIndexToLocal.call(this,e,t)},n.prototype.getIndexFromLocal=function(e){return r.prototype.getIndexFromLocal.call(this,e)},n.prototype.getLastSyncTime=function(e){return r.prototype.getLastSyncTime.call(this,e)},n.prototype._getResolveId=function(){return r.prototype._getResolveId.call(this)},n.prototype._setResolveId=function(e){return r.prototype._setResolveId.call(this,e)},n.prototype.batch=function(e,t){return r.prototype.batch.call(this,e,t)},n}(C),r.CONFLICT_POLICY_MANUAL=0,r.CONFLICT_POLICY_CLIENT=1,r.CONFLICT_POLICY_SERVER=2,r.RESOLVE_CONFLICT_UNDEFINED=-1,r.RESOLVE_CONFLICT_CLIENT=1,r.RESOLVE_CONFLICT_SERVER=2,r.SYNC_ERROR_UNDEFINED=-1,r.SYNC_ERROR_PUSH=0,r.SYNC_ERROR_PULL=1,r.SYNC_ERROR_OVERLAP_ID=2,r.SYNC_ERROR_PUSH_RESYNCING=3,r.useLongQuery=!1,r);var r},O=function(t){function r(e,r){var n=t.call(this,e,r,"file")||this;return n._resolveId=null,n}return e(r,t),r._loadBucket=function(e,t,r){return n("FileBucket.loadBucket(), name="+t+", callbacks="+r),E._baseLoadBucket("file",e,t,D.BUCKET_MODE_ONLINE,r)},r._getBucketList=function(e,t){return E._baseGetBucketList("file",e,!1,t)},r.prototype._save=function(e,t,r,u,c){if(n("FileBucket._save()"),!e)throw n("FileBucket._save(), Parameter is invalid : fileName"),new Error("No fileName");if(!t)throw n("FileBucket._save(), Parameter is invalid : data"),new Error("No data");if(!("undefined"!=typeof Blob&&null!==Blob||"undefined"!=typeof Buffer&&null!==Buffer))throw n("FileBucket._save(), Not supported Blob nor Buffer"),new Error("No Blob/Buffer support");if(!("string"==typeof t||"undefined"==typeof Blob||null===Blob||t instanceof Blob||"undefined"==typeof Buffer||null===Buffer||Buffer.isBuffer(t)))throw n("FileBucket._save(), Data is not String, Blob nor Buffer"),new Error("data is not String, Blob nor Buffer");if(!(u||r&&r.getContentType()))throw n("FileBucket._save(), Parameter is invalid : metadata.contentType"),new Error("No contentType in metadata");var l=this.getDataPath("/"+encodeURIComponent(e));n("FileBucket._save(), path="+l);var p=new a(this._service,l);u?p.setMethod("PUT"):(p.setMethod("POST"),p.setContentType(r.getContentType()),null!=r.getAcl()&&p.addRequestHeader("X-ACL",r.getAcl()._toString()),null!=r.getOptions()&&p.addRequestHeader("X-Meta-Options",JSON.stringify(r.getOptions()))),p.setData(t);var h=p.execute().then(function(t){try{var s=JSON.parse(t);return null===r&&(r=new N),r._setMetadata(s),r}catch(t){n("FileBucket._save(), success: exception="+t);var i=o(0,"Invalid response from server",t,e);return Promise.reject(i)}},function(t){return n("FileBucket._save(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(h,c)},r.prototype.saveAs=function(e,t,r,n){return this._save(e,t,r,!1,n)},r.prototype.save=function(e,t,r){return this._save(e,t,null,!0,r)},r.prototype.load=function(e,t){if(n("FileBucket.load()"),void 0===e||null===e)throw n("FileBucket.load(), Parameter is invalid : fileName"),new Error("No fileName");if(!("undefined"!=typeof Blob&&null!==Blob||"undefined"!=typeof Buffer&&null!==Buffer))throw n("FileBucket.load(), Not supported Blob nor Buffer"),new Error("No Blob/Buffer support");var r=this.getDataPath("/"+encodeURIComponent(e));n("FileBucket.load(), path="+r);var o=new a(this._service,r);o.setMethod("GET"),"undefined"!=typeof Blob&&null!==Blob?o.setResponseType("blob"):"undefined"!=typeof Buffer&&null!==Buffer&&o.setResponseType("buffer");var u=o.execute().then(function(e){return e},function(t){return n("FileBucket.load(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(u,t)},r.prototype.remove=function(e,t){if(n("FileBucket.delete()"),void 0===e||null===e)throw n("FileBucket.delete(), Parameter is invalid : fileName"),new Error("No fileName");var r;if(this._service.isOffline()){r=new l(this.getClassName(),"delete");var o={bucketName:this.getBucketName(),fileName:e};r.setData(o)}else{var u=this.getDataPath("/"+encodeURIComponent(e));n("FileBucket.delete(), path="+u),(r=new a(this._service,u)).setMethod("DELETE")}var c=r.execute().then(function(t){return n("FileBucket.delete(), success: "+e),e},function(t){return n("FileBucket.delete(), error: "+i(t)+" : "+e),t.data=e,Promise.reject(t)});return s(c,t)},r.prototype._createMetadata=function(e){var t=new N;return t._setMetadata(e),t},r.prototype._publish=function(e,t,r){var u=this;if(n("FileBucket._publish(), fileName="+e+", setFlg="+t),void 0===e||null===e)throw n("FileBucket._publish(), Parameter is invalid : fileName"),new Error("No fileName");var c;if(this._service.isOffline()){c=new l(this.getClassName(),"publish");var p={bucketName:this.getBucketName(),fileName:e,published:t};c.setData(p)}else{var h=this.getDataPath("/"+encodeURIComponent(e)+"/publish");n("FileBucket._publish(), path="+h),c=new a(this._service,h),t?c.setMethod("PUT"):c.setMethod("DELETE")}var f=c.execute().then(function(t){n("FileBucket._publish(), success: "+e);try{var r=JSON.parse(t);return u._createMetadata(r)}catch(t){n("FileBucket._publish(), success: exception="+t);var s=o(0,"Invalid response from server",t);return s.data=e,Promise.reject(s)}},function(t){return n("FileBucket._publish(), error: "+i+" : "+e),t.data=e,Promise.reject(t)});return s(f,r)},r.prototype.publish=function(e,t){return n("FileBucket.publish()"),this._publish(e,!0,t)},r.prototype.unpublish=function(e,t){return n("FileBucket.unpublish()"),this._publish(e,!1,t)},r.prototype._getList=function(e,t,r){var u=this;n("FileBucket._getList(), published="+e);var c;if(this._service.isOffline()){c=new l(this.getClassName(),"getList");var p={bucketName:this.getBucketName(),published:e,deleteMark:t};c.setData(p)}else{var h=this.getDataPath();n("FileBucket._getList(), path="+h),(c=new a(this._service,h)).setMethod("GET"),e&&c.setQueryParam("published","1"),t&&c.setQueryParam("deleteMark","1")}var f=c.execute().then(function(e){n("FileBucket._getList(), success");try{var t=JSON.parse(e).results,r=[];if(null!=t)for(var s=0,i=t;s<i.length;s++){var c=i[s],a=u._createMetadata(c);r.push(a)}return r}catch(e){n("FileBucket._getList(), success: exception="+e);var l=o(0,"Invalid response from server",e);return Promise.reject(l)}},function(e){return n("FileBucket._getList(), error: "+i(e)),Promise.reject(e)});return s(f,r)},r.prototype.getList=function(e){return n("FileBucket.getList()"),this._getList(!1,!1,e)},r.prototype.getPublishedList=function(e){return n("FileBucket.getPublishedList()"),this._getList(!0,!1,e)},r.prototype.getMetadata=function(e,t){var r=this;if(n("FileBucket.getMetadata(), fileName="+e),void 0===e||null===e)throw n("FileBucket.getMetadata(), Parameter is invalid : fileName"),new Error("No fileName");var u;if(this._service.isOffline()){u=new l(this.getClassName(),"getMetadata");var c={bucketName:this.getBucketName(),fileName:e};u.setData(c)}else{var p=this.getDataPath("/"+encodeURIComponent(e)+"/meta");n("FileBucket.getMetadata(), path="+p),(u=new a(this._service,p)).setMethod("GET")}var h=u.execute().then(function(t){n("FileBucket.getMetadata(), success");try{var s=JSON.parse(t);return r._createMetadata(s)}catch(r){n("FileBucket.getMetadata(), Invalid response : "+t);var i=o(0,"Invalid response from server",r);return i.data=e,Promise.reject(i)}},function(t){return n("FileBucket.getMetadata(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(h,t)},r.prototype.updateMetadata=function(e,t,r){if(n("FileBucket.updateMetadata(), fileName="+e),null==e||""===e)throw n("FileBucket.updateMetadata(), Parameter is invalid : fileName"),new Error("No fileName");if(!(t instanceof N))throw n("FileBucket.updateMetadata(), Parameter is invalid : metadata"),new Error("metadata is not instance of FileMetadata");var u,c={};if(this._service.isOffline())u=new l(this.getClassName(),"updateMetadata"),c.bucketName=this.getBucketName(),c.targetFileName=e,c.cacheDisabled=t.isCacheDisabled();else{var p=this.getDataPath("/"+encodeURIComponent(e)+"/meta");n("FileBucket.updateMetadata(), path="+p),(u=new a(this._service,p)).setMethod("PUT")}null!=t.getFileName()&&(c.filename=t.getFileName()),null!=t.getContentType()&&(c.contentType=t.getContentType()),null!=t.getAcl()&&(c.ACL=t.getAcl()._toJsonObject()),null!=t.getOptions()&&(c.options=JSON.stringify(t.getOptions())),u.setData(c);var h=u.execute().then(function(r){n("FileBucket.updateMetadata(), success");try{var s=JSON.parse(r);return t._setMetadata(s),t}catch(t){n("FileBucket.updateMetadata(), success: exception="+t);var i=o(0,"Invalid response from server",t);return i.data=e,Promise.reject(i)}},function(t){return n("FileBucket.updateMetadata(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(h,r)},r._checkOfflineService=function(e){if(e!==D)throw n("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!e.isOffline())throw n("ObjectBucket.setSyncScope(), supported offline mode only"),new Error("No offline mode enabled")},r._selectUploadFile=function(e,t){n("FileBucket.selectUploadFile()"),this._checkOfflineService(e);var r=new l(E.getClassName("file"),"selectUploadFile").execute().then(function(e){try{return JSON.parse(e)}catch(e){n("FileBucket.selectUploadFile(), success: exception="+e);var t=o(0,"Invalid response from server",e);return Promise.reject(t)}},function(e){return n("FileBucket.selectUploadFile(), error: "+i(e)),Promise.reject(e)});return s(r,t)},r._selectDirectory=function(e,t){n("FileBucket.selectDirectory()"),this._checkOfflineService(e);var r=new l(E.getClassName("file"),"selectDirectory").execute().then(function(e){try{return JSON.parse(e).path}catch(e){n("FileBucket.selectUploadFile(), success: exception="+e);var t=o(0,"Invalid response from server",e);return Promise.reject(t)}},function(e){return n("FileBucket.selectDirectory(), error: "+i(e)),Promise.reject(e)});return s(r,t)},r.prototype._uploadFile=function(e,t,r,u,c){if(n("FileBucket._uploadFile()"),!this._service.isOffline())throw n("FileBucket._uploadFile(), only offline mode"),new Error("No offline mode enabled");if(!e||""===e)throw n("FileBucket._uploadFile(), Parameter is invalid : fileName"),new Error("No fileName");if(!t||""===t)throw n("FileBucket._uploadFile(), Parameter is invalid : filePath"),new Error("No filePath");if(!r||!r.getContentType()||""===r.getContentType())throw n("FileBucket._uploadFile(), Parameter is invalid : metadata"),new Error("No metadata.contentType");var a="uploadNewFile";u&&(a="uploadUpdateFile");var p=new l(this.getClassName(),a),h={};h.bucketName=this.getBucketName(),h.fileName=e,h.filePath=t,h.cacheDisabled=r.isCacheDisabled(),h.contentType=r.getContentType(),null!=r.getAcl()&&(h.ACL=r.getAcl()._toJsonObject()),null!=r.getOptions()&&(h.options=JSON.stringify(r.getOptions())),p.setData(h);var f=p.execute().then(function(t){try{var s=JSON.parse(t);return null===r&&(r=new N),r._setMetadata(s),r}catch(t){n("FileBucket.uploadNewFile(), success: exception="+t);var i=o(0,"Invalid response from server",t);return i.data=e,Promise.reject(i)}},function(t){return n("FileBucket.uploadNewFile(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(f,c)},r.prototype.uploadNewFile=function(e,t,r,s){return n("FileBucket.uploadNewFile()"),this._uploadFile(e,t,r,!1,s)},r.prototype.uploadUpdateFile=function(e,t,r,s){return n("FileBucket.uploadUpdateFile()"),this._uploadFile(e,t,r,!0,s)},r.prototype.downloadFile=function(e,t,u){if(n("FileBucket.downloadFile()"),r._checkOfflineService(this._service),!e||""===e)throw n("FileBucket.downloadFile(), Parameter is invalid : fileName"),new Error("No fileName");if(!t||""===t)throw n("FileBucket.downloadFile(), Parameter is invalid : filePath"),new Error("No filePath");var c=new l(this.getClassName(),"downloadFile"),a={bucketName:this.getBucketName(),fileName:e,filePath:t};c.setData(a);var p=c.execute().then(function(t){try{JSON.parse(t);return n("FileBucket.downloadFile(), response="+t),e}catch(t){n("FileBucket.downloadFile(), success: exception="+t);var r=o(0,"Invalid response from server",t);return r.data=e,Promise.reject(r)}},function(t){return n("FileBucket.downloadFile(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(p,u)},r.prototype.requestCancel=function(e,t){if(n("FileBucket.requestCancel()"),r._checkOfflineService(this._service),void 0===e||null===e||""===e)throw n("FileBucket.requestCancel(), Parameter is invalid : fileName"),new Error("No fileName");var u=new l(this.getClassName(),"requestCancel"),c={bucketName:this.getBucketName(),fileName:e};u.setData(c);var a=u.execute().then(function(t){try{return n("FileBucket.requestCancel(), response="+t),e}catch(t){n("FileBucket.requestCancel(), success: exception="+t);var r=o(0,"Invalid response from server",t);return r.data=e,Promise.reject(r)}},function(t){return n("FileBucket.requestCancel(), error: "+i(t)),t.data=e,Promise.reject(t)});return s(a,t)},r}(E),T=function(t){t.FileBucket=function(r){function n(e){return r.call(this,t,e)||this}return e(n,r),n.loadBucket=function(e,n){return r._loadBucket.call(this,t,e,n)},n.getBucketList=function(e){return r._getBucketList.call(this,t,e)},n.prototype.saveBucket=function(e){return r.prototype.saveBucket.call(this,e)},n.prototype.deleteBucket=function(e){return r.prototype.deleteBucket.call(this,e)},n.prototype.setAcl=function(e){return r.prototype.setAcl.call(this,e),this},n.prototype.getAcl=function(){return r.prototype.getAcl.call(this)},n.prototype.setContentAcl=function(e){return r.prototype.setContentAcl.call(this,e),this},n.prototype.getContentAcl=function(){return r.prototype.getContentAcl.call(this)},n.prototype.setDescription=function(e){return r.prototype.setDescription.call(this,e),this},n.prototype.getDescription=function(){return r.prototype.getDescription.call(this)},n.prototype.getBucketName=function(){return r.prototype.getBucketName.call(this)},n.prototype._setBucketName=function(e){return r.prototype.setBucketName.call(this,e),this},n.prototype.saveAs=function(e,t,n,s){return r.prototype.saveAs.call(this,e,t,n,s)},n.prototype.save=function(e,t,n){return r.prototype.save.call(this,e,t,n)},n.prototype.load=function(e,t){return r.prototype.load.call(this,e,t)},n.prototype.remove=function(e,t){return r.prototype.remove.call(this,e,t)},n.prototype.delete=function(e,t){return r.prototype.remove.call(this,e,t)},n.prototype._createMetadata=function(e){return r.prototype._createMetadata.call(this,e)},n.prototype.publish=function(e,t){return r.prototype.publish.call(this,e,t)},n.prototype.unpublish=function(e,t){return r.prototype.unpublish.call(this,e,t)},n.prototype.getList=function(e){return r.prototype.getList.call(this,e)},n.prototype.getPublishedList=function(e){return r.prototype.getPublishedList.call(this,e)},n.prototype.getMetadata=function(e,t){return r.prototype.getMetadata.call(this,e,t)},n.prototype.updateMetadata=function(e,t,n){return r.prototype.updateMetadata.call(this,e,t,n)},n.selectUploadFile=function(e){return r._selectUploadFile.call(this,t,e)},n.selectDirectory=function(e){return r._selectDirectory.call(this,t,e)},n.prototype.uploadNewFile=function(e,t,n,s){return r.prototype.uploadNewFile.call(this,e,t,n,s)},n.prototype.uploadUpdateFile=function(e,t,n,s){return r.prototype.uploadUpdateFile.call(this,e,t,n,s)},n.prototype.downloadFile=function(e,t,n){return r.prototype.downloadFile.call(this,e,t,n)},n.prototype.requestCancel=function(e,t){return r.prototype.requestCancel.call(this,e,t)},n}(O)},P=function(){function e(e,t,r,n){this._service=e,this.apiname=t,this.method=r,this.subpath=n,this.headers={},this.receiveResponseHeaders=!1,this.path="/api/"+t,n&&(0!==n.indexOf("/")&&(this.path+="/"),this.path+=n)}return e.prototype.setContentType=function(e){this.contentType=e},e.prototype.clearHeaders=function(){this.headers={}},e.prototype.addHeader=function(e,t){this.headers[e]=t},e.prototype.setBinaryResponse=function(){if("undefined"!=typeof Blob&&null!==Blob)this.responseType="blob";else{if("undefined"==typeof Buffer||null===Buffer)throw new Error("No blob / buffer");this.responseType="buffer"}},e.prototype.setReceiveResponseHeaders=function(e){this.receiveResponseHeaders=e},e.prototype.execute=function(e,t){var r=new a(this._service,this.path);r.setMethod(this.method),e&&("GET"==this.method||"DELETE"==this.method?r.setQueryParams(e):r.setData(e)),null!=this.responseType&&r.setResponseType(this.responseType),null!=this.contentType&&r.setContentType(this.contentType);for(var o in this.headers)r.addRequestHeader(o,this.headers[o]);r.setReceiveResponseHeaders(this.receiveResponseHeaders);var u=r.execute().then(function(e){return n("CustomApi#success"),e}).catch(function(e){return n("CustomApi#error "+i(e)),Promise.reject(e)});return s(u,t)},e}(),j=function(t){t.CustomApi=function(r){function n(e,n,s){return r.call(this,t,e,n,s)||this}return e(n,r),n.prototype.setContentType=function(e){return r.prototype.setContentType.call(this,e),this},n.prototype.addHeader=function(e,t){return r.prototype.addHeader.call(this,e,t),this},n.prototype.clearHeaders=function(){return r.prototype.clearHeaders.call(this),this},n.prototype.setReceiveResponseHeaders=function(e){return r.prototype.setReceiveResponseHeaders.call(this,e),this},n.prototype.execute=function(e,t){return r.prototype.execute.call(this,e,t)},n.prototype.setBinaryResponse=function(){return r.prototype.setBinaryResponse.call(this),this},n}(P)},L=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"badge",{get:function(){return this._fields.badge},set:function(e){if(!this._isInteger(e))throw new Error("ApnsFields.badge, Not integer: "+e);this._fields.badge=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._fields.sound},set:function(e){if("string"!=typeof e)throw new Error("ApnsFields.sound, Not string: "+e);this._fields.sound=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentAvailable",{get:function(){return this._fields["content-available"]},set:function(e){if(!this._isInteger(e))throw new Error("ApnsFields.contentAvailable, Not integer: "+e);this._fields["content-available"]=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"category",{get:function(){return this._fields.category},set:function(e){if("string"!=typeof e)throw new Error("ApnsFields.category, Not string: "+e);this._fields.category=e},enumerable:!0,configurable:!0}),e.prototype._isInteger=function(e){return"number"==typeof e&&parseInt(e.toString(),10)===e},e}(),A=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"title",{get:function(){return this._fields.title},set:function(e){if("string"!=typeof e)throw new Error("GcmFields.title, Invalid value: "+e);this._fields.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uri",{get:function(){return this._fields.uri},set:function(e){if("string"!=typeof e)throw new Error("GcmFields.uri, Invalid value: "+e);this._fields.uri=e},enumerable:!0,configurable:!0}),e}(),I=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"eventId",{get:function(){return this._fields.sseEventId},set:function(e){if("string"!=typeof e)throw new Error("SseFields.eventId, Not string: "+e);this._fields.sseEventId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventType",{get:function(){return this._fields.sseEventType},set:function(e){if("string"!=typeof e)throw new Error("SseFields.eventType, Not string: "+e);this._fields.sseEventType=e},enumerable:!0,configurable:!0}),e}(),U=function(){function e(e){this._service=e}return e.prototype.send=function(e){n("PushSender.send()");var t=new a(this._service,"/push/notifications");t.setMethod("POST"),t.setContentType("application/json"),t.setData(this._toJson());var r=t.execute().then(function(e){n("PushSender.send#success : response = "+e);try{return JSON.parse(e)}catch(e){n("PushSender.send#success : exception="+e);var t=o(0,"Invalid response from server",e);return Promise.reject(t)}},function(e){return n("PushSender.send#error = "+i(e)),Promise.reject(e)});return s(r,e)},e.prototype._toJson=function(){var e={};return null!=this._clause&&(e.query=this._clause.json()),null!=this._message&&(e.message=this._message),null!=this._allowedReceivers&&(e.allowedReceivers=this._allowedReceivers),null!=this._apnsFields&&this._copyKeys(this._apnsFields._fields,e),null!=this._gcmFields&&this._copyKeys(this._gcmFields._fields,e),null!=this._sseFields&&this._copyKeys(this._sseFields._fields,e),e},e.prototype._copyKeys=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){var s=n[r];t[s]=e[s]}},Object.defineProperty(e.prototype,"clause",{get:function(){return this._clause},set:function(e){if(!(e instanceof v))throw new Error("PushSender.clause, Invalid type");this._clause=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){if("string"!=typeof e)throw new Error("PushSender.message, Not string: "+e);this._message=e,n("push.message = "+this._message)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowedReceivers",{get:function(){return this._allowedReceivers},set:function(e){if(!Array.isArray(e))throw new Error("PushSender.allowedReceivers, Not Array");this._allowedReceivers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apnsFields",{get:function(){return this._apnsFields},set:function(e){if(!(e instanceof L))throw new Error("PushSender.apnsFields, Invalid instance type");this._apnsFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcmFields",{get:function(){return this._gcmFields},set:function(e){if(!(e instanceof A))throw new Error("PushSender.gcmFields, Invalid instance type");this._gcmFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sseFields",{get:function(){return this._sseFields},set:function(e){if(!(e instanceof I))throw new Error("PushSender.sseFields, Invalid instance type");this._sseFields=e},enumerable:!0,configurable:!0}),e.ApnsFields=L,e.GcmFields=A,e.SseFields=I,e}(),R=function(t){t.PushSender=function(r){function n(){return r.call(this,t)||this}return e(n,r),n}(U)},M=function(){function e(){this.requests=[],this.json={requests:this.requests}}return e.prototype.addInsertRequest=function(e){if(e.etag)throw new Error("ETag exists");this.requests.push({op:"insert",data:e})},e.prototype.addUpdateRequest=function(e){if(!e._id)throw new Error("No id");var t={op:"update",_id:e._id,data:{$full_update:e}};e.etag&&(t.etag=e.etag),this.requests.push(t)},e.prototype.addDeleteRequest=function(e){if(!e._id)throw new Error("No id");var t={op:"delete",_id:e._id};e.etag&&(t.etag=e.etag),this.requests.push(t)},e}(),x=function(){function e(){this.data={}}return e.prototype.getItem=function(e){return this.data[e]},e.prototype.setItem=function(e,t){this.data[e]=t},e.prototype.removeItem=function(e){delete this.data[e]},e}(),F=function(){return function(e){this.offline=!1,this.allowSelfSignedCert=!1,this.debugMode="release",null!==e&&(this.tenant=e.tenant,this.appId=e.appId,this.appKey=e.appKey,this.baseUri=e.baseUri,"/"===this.baseUri.slice(-1)&&(this.baseUri=this.baseUri.slice(0,-1)),void 0!==e.offline&&!0===e.offline&&(this.offline=e.offline),void 0!==e.allowSelfSignedCert&&!0===e.allowSelfSignedCert&&(this.allowSelfSignedCert=e.allowSelfSignedCert),void 0!==e.serviceId&&(this.serviceId=e.serviceId),void 0!==e.debugMode&&(this.debugMode=e.debugMode))}}(),D=new(function(){function e(){this.BUCKET_MODE_ONLINE=0,this.BUCKET_MODE_REPLICA=1,this.BUCKET_MODE_LOCAL=2,b(this),w(this),B(this),T(this),j(this),R(this),this.NebulaService=e,this.HttpRequest=a,this.AclPermission=d,this.AclGroup=y,this.Acl=_,this.RegexOption=g,this.Clause=v,this.ObjectQuery=m,this.FileMetadata=N,this.BatchRequest=M,this.AccountLink=f,this._SdeRequest=l,this._SdeNetworkEventListener=p,this._SdeSyncEventListener=h}return e.prototype.getRestApiVersion=function(){return 1},e.prototype.getTenantID=function(){return void 0===this._config?null:this._config.tenant},e.prototype.getBaseUri=function(){return void 0===this._config?null:this._config.baseUri},e.prototype.getAppID=function(){return void 0===this._config?null:this._config.appId},e.prototype.getAppKey=function(){return void 0===this._config?null:this._config.appKey},e.prototype.setAppKey=function(e){if(!this._config)throw new Error("Not initialized");return this._config.appKey=e,this},e.prototype.getServiceID=function(){return void 0===this._config?null:this._config.serviceId},e.prototype.getDebugMode=function(){return void 0===this._config?null:this._config.debugMode},e.prototype.isOffline=function(){return this._config.offline},e.prototype.isAllowSelfSignedCert=function(){return this._config.allowSelfSignedCert},e.prototype.setClientCertificate=function(e){return this._config.clientCertOptions=e,this},e.prototype.isClientCertSet=function(){return null!=this._config.clientCertOptions},e.prototype.getCurrentUser=function(){var e=this._localStorage.getItem(this._userItemKey());if(!e)return null;try{var t=JSON.parse(e);return"expire"in t&&!(t.expire<(new Date).getTime()/1e3)||(t=null),t}catch(e){return n("Nebula.getCurrentUser#"+e.message),null}},e.prototype.setCurrentUser=function(e){var t={_id:e.get("_id"),username:e.get("username"),email:e.get("email"),sessionToken:e.get("sessionToken"),expire:e.get("expire"),options:e.get("options"),groups:e.get("groups")};return this._localStorage.setItem(this._userItemKey(),JSON.stringify(t)),this},e.prototype.setSessionToken=function(e){var t=(new Date).getTime()/1e3+31536e5,r=this.getCurrentUser();return null===r?r={_id:"",username:"",email:"",sessionToken:e,expire:t,options:{},groups:[]}:(r.sessionToken=e,r.expire=t),this._localStorage.setItem(this._userItemKey(),JSON.stringify(r)),this},e.prototype.removeCurrentUser=function(){return this._localStorage.removeItem(this._userItemKey()),this},e.prototype._userItemKey=function(){var e=this.getServiceID();return void 0!==e?this.getTenantID()+"_"+this.getAppID()+"_"+e:this.getTenantID()+"_"+this.getAppID()},e.prototype.initialize=function(e){var t=this;if(this._config=new F(e),this._localStorage=null!=localStorage?localStorage:new x,this._config.offline){if(this!==D)throw new Error("No offline mode supported for multi-tenant instance.");try{var r=new l("Nebula","initialize"),s={tenant:this.getTenantID(),appId:this.getAppID(),appKey:this.getAppKey(),baseUri:this.getBaseUri(),offline:this.isOffline(),allowSelfSignedCert:this.isAllowSelfSignedCert(),debugMode:this.getDebugMode()};r.setData(s),r.execute().then(function(e){return n("Nebula.initialize#Success"),n("Nebula.initialize#response = "+e)}).catch(function(e){return n("Nebula.initialize#Error = "+i(e)),t._config.offline=!1})}catch(e){n("Nebula.initialize#"+e.message),this._config.offline=!1}}return this},e.prototype.setLoginCacheValidTime=function(e,t){if(n("Nebula.setLoginCacheValidTime#start"),e<=0)throw new Error("Nebula.setLoginCacheValidTime: bad expire");if(!this.isOffline())throw new Error("Not offline mode!");var r=new l("Nebula","setLoginCacheValidTime"),o={expire:e};r.setData(o);var u=r.execute().then(function(){n("Nebula.setLoginCacheValidTime#Success")}).catch(function(e){return n("Nebula.setLoginCacheValidTime#error = "+i(e)),Promise.reject(e)});return n("Nebula.setLoginCacheValidTime#end"),s(u,t)},e.prototype.getLoginCacheValidTime=function(e){if(n("Nebula.getLoginCacheValidTime#start"),!this.isOffline())throw new Error("Not offline mode!");var t=new l("Nebula","getLoginCacheValidTime").execute().then(function(e){n("Nebula.getLoginCacheValidTime#Success");var t;try{t=JSON.parse(e)}catch(e){r("Nebula.getLoginCacheValidTime#"+e.message),t=null}if(null!==t)return t.expire;var s=o(400,"Bad Response","Response json error.");return Promise.reject(s)}).catch(function(e){return n("Nebula.getLoginCacheValidTime#error callback start"),n("Nebula.getLoginCacheValidTime#error = "+i(e)),Promise.reject(e)});return n("Nebula.getLoginCacheValidTime#end"),s(t,e)},e.prototype.setNetworkEventListener=function(e){n("Nebula.setNetworkEventListener#start");var t=!1;1===arguments.length&&(null!=e&&void 0!==e.onNetworkStateChanged&&(t=!0),null===e&&(t=!0));{if(t)return this.isOffline()?p.setCallback(e):n("Nebula.setNetworkEventListener#Disabled Offline"),n("Nebula.setNetworkEventListener#end"),this;r("Nebula.setNetworkEventListener#invalid parameter.")}},e.prototype.setHttpProxy=function(e){var t=null;null!=e&&(this.verifyProxy(e),t=require("tunnel").httpOverHttp({proxy:e})),a.setHttpAgent(t)},e.prototype.setHttpsProxy=function(e){var t=null;null!=e&&(this.verifyProxy(e),(t=require("tunnel").httpsOverHttp({proxy:e})).defaultPort=443),a.setHttpsAgent(t)},e.prototype.verifyProxy=function(e){if("object"!=typeof e)throw new Error("Bad proxy: not object");if(null==e.host||"string"!=typeof e.host)throw new Error("Bad proxy: host");if(null==e.port||"number"!=typeof e.port)throw new Error("Bad proxy: port")},e}());"object"==typeof exports&&"undefined"!=typeof module?module.exports=D:t.Nebula=D}).call(this);
//# sourceMappingURL=baas.min.js.map
