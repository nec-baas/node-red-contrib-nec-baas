/*!
 * NEC Mobile Backend Platform JavaScript SDK version 7.0.1
 *
 * Copyright (C) 2014-2018, NEC CORPORATION.
 * All rights reserved.
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";var XMLHttpRequest,localStorage;!function(xv,yv){var zv={exports:{}},Av=zv.exports;(function(module,exports){var __extends=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});var a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.root=this,exports.nbError=function(e){"undefined"!=typeof console&&console.log("[BAAS ERROR] : "+e)},exports.nbLogger=function(e){"debug"===exports.Nebula.getDebugMode()&&"undefined"!=typeof console&&console.log("[BAAS] : "+e)},exports._doBadRequestCallback=function(e,t){exports.nbLogger(t+"#invalid parameter.");var r=exports._createError(400,"Invalid Arguments","Invalid Arguments");return e&&e.error?void e.error(r):Promise.reject(r)},exports._promisify=function(e,t){return t?void e.then(function(e){t.success&&t.success(e)}).catch(function(e){t.error&&t.error(e)}):e},exports._createError=function(e,t,r,o){var n=new Error(t+"("+e+")");return n.status=e,n.statusText=t,n.responseText=r,o&&(n.data=o),n},exports._errorText=function(e){return e&&e.message?e.message:e},exports._isObject=function(e){var t=typeof e;return e&&"object"===t||"function"===t},exports._compareObject=function(e,t){var r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(var n=0,s=r;n<s.length;n++){var i=s[n];if(exports._isObject(e[i])&&exports._isObject(t[i])){if(!exports._compareObject(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1}return!0},exports.nbAssert=function(e,t){if(!e){if("debug"===exports.Nebula.getDebugMode())throw new Error("Assertion failed. "+t);exports.nbError("Assertion failed. "+t)}},exports.isNodeJs=function(){return"undefined"!=typeof require&&"undefined"!=typeof process},exports._node_require=function(module){try{return exports.isNodeJs()?eval("require")(module):null}catch(e){return null}},exports.URL=exports._node_require("url"),exports.https=exports._node_require("https"),exports.http=exports._node_require("http"),exports.tls=exports._node_require("tls");var _http2=null;try{_http2=exports._node_require("http2")}catch(e){}exports.http2=_http2,exports._hasXhr=function(){return void 0!==XMLHttpRequest};var HttpRequestExecutor=function(){function e(e){this._req=e,this._resolve=e._resolve,this._reject=e._reject}return e.create=function(e){return exports._hasXhr()?this._xhrFactory(e):this._nodeFactory(e)},e.setXhrFactory=function(e){this._xhrFactory=e},e.setNodeFactory=function(e){this._nodeFactory=e},e}();exports.HttpRequestExecutor=HttpRequestExecutor;var HttpRequest=function(){function n(e,t,r){this._useHttp2=!1,exports.nbLogger("HttpRequest#start:path = "+t),this._service=e,this._url=this._service.getBaseUri(),r&&r.noprefix||(this._url+="/"+this._service.getRestApiVersion()+"/"+this._service.getTenantID()),this._url=encodeURI(this._url)+t,this._headers={},this._contentType=null,this._responseType=null,this._queryParams=null,this._data=null,this._receiveResponseHeaders=!1,this._timeout=n.getDefaultTimeout();var o=this._service.getCurrentUser();this._sessionToken=null===o?null:o.sessionToken}return n.getProxy=function(){return n._proxy},n.setProxy=function(e){n._proxy=e},n.setHttpAgent=function(e){n._httpAgent=e},n.setHttpsAgent=function(e,t){n._httpsAgent=e,n._httpsAgentOptions=t},Object.defineProperty(n.prototype,"service",{get:function(){return this._service},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"responseHeaders",{get:function(){return this._responseHeaders},set:function(e){this._responseHeaders=e},enumerable:!0,configurable:!0}),n.setDefaultTimeout=function(e){this._defaultTimeout=e},n.getDefaultTimeout=function(){return this._defaultTimeout},Object.defineProperty(n.prototype,"useHttp2",{get:function(){return this._useHttp2},set:function(e){if(e&&null==exports.http2)throw new Error("No http2 support.");this._useHttp2=e},enumerable:!0,configurable:!0}),n.prototype.setReceiveResponseHeaders=function(e){return this._receiveResponseHeaders=e,this},n.prototype.execute=function(){var c=this;return new Promise(function(e,t){c._resolve=e,c._reject=t,c._headers["X-Application-Id"]=c._service.getAppID(),c._headers["X-Application-Key"]=c._service.getAppKey(),null!==c._contentType&&(c._headers["Content-Type"]=c._contentType),null!==c._sessionToken&&(c._headers["X-Session-Token"]=c._sessionToken);var r,o=c._url;if(c._queryParams){for(var n=[],s=0,i=Object.keys(c._queryParams);s<i.length;s++){var u=i[s];c._queryParams.hasOwnProperty(u)&&n.push(encodeURIComponent(u)+"="+encodeURIComponent(c._queryParams[u]))}0<n.length&&(o+="?"+n.join("&"))}r=null==c._data?null:"string"==typeof c._data||"undefined"!=typeof Blob&&null!==Blob&&c._data instanceof Blob||"undefined"!=typeof Buffer&&null!==Buffer&&Buffer.isBuffer(c._data)?c._data:JSON.stringify(c._data);var a=HttpRequestExecutor.create(c);a.execute(c._method,o,c._headers,r,c._timeout,c._responseType,c._receiveResponseHeaders)})},n.prototype.setMethod=function(e){return this._method=e,this},n.prototype.setContentType=function(e){return this._contentType=e,this},n.prototype.setQueryParams=function(e){return this._queryParams=e,this},n.prototype.addQueryParams=function(e){if(e)for(var t=0,r=Object.keys(e);t<r.length;t++){var o=r[t];this.setQueryParam(o,e[o])}return this},n.prototype.setQueryParam=function(e,t){return this._queryParams||(this._queryParams={}),this._queryParams[e]=t,this},n.prototype.setData=function(e){return this._data=e,this},n.prototype.setSessionToken=function(e){return this._sessionToken=e,this},n.prototype.setResponseType=function(e){return this._responseType=e,this},n.prototype.addRequestHeader=function(e,t){return void 0!==this._headers[e]&&exports.nbLogger("HTTP Request Warning : This header already exists."),this._headers[e]=t,this},n._defaultTimeout=0,n}();exports.HttpRequest=HttpRequest,exports.initHttpXhr=function(){HttpRequestExecutor.setXhrFactory(function(e){return new HttpXhr(e)})};var HttpXhr=function(r){function e(e){var t=r.call(this,e)||this;return t._onReadyStateChange=t._onReadyStateChange.bind(t),t}return __extends(e,r),e.prototype.execute=function(e,t,r,o,n,s,i){var u=this;this._receiveResponseHeaders=i,this._xhr=this._createXhr(),this._xhr.open(e,t,!0),this._xhr.onreadystatechange=this._onReadyStateChange;for(var a=0,c=Object.keys(r);a<c.length;a++){var l=c[a],p=r[l];this._xhr.setRequestHeader(l,p)}this._xhr.timeout=n,this._xhr.ontimeout=function(e){u._onXhrTimeout(e)};try{var g=exports.root.navigator.userAgent.toLowerCase();(g.match(/msie/)||g.match(/trident/))&&(this._xhr.setRequestHeader("Pragma","no-cache"),this._xhr.setRequestHeader("Cache-Control","no-cache"),this._xhr.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT"))}catch(e){}null!=s&&(this._xhr.responseType=s),this._xhr.send(o)},e.prototype._createXhr=function(){if(!exports._hasXhr())throw new Error("No XMLHttpRequest");return new XMLHttpRequest},e.prototype._onReadyStateChange=function(){var e=this._xhr;if(4===e.readyState){if(200<=e.status&&e.status<300){var t=null!=e.response?e.response:e.responseText;return this._receiveResponseHeaders?this._resolve({body:t,headers:e.getAllResponseHeaders(),status:e.status}):this._resolve(t)}var r=exports._createError(e.status,e.statusText,"");return"blob"!==e.responseType&&(r.responseText=e.responseText),0===e.status&&(r.statusText="Not Found",r.responseText="Not found anything that matches the request URI."),exports.nbError("HTTP Request Error: "+r.message+" "+r.responseText),this._reject(r)}},e.prototype._onXhrTimeout=function(e){var t=exports._createError(0,"Timeout error",e.toString());exports.nbError("HTTP Response Error: Timeout Error: "+e.toString()),this._reject(t)},e}(HttpRequestExecutor);exports.HttpXhr=HttpXhr,HttpRequestExecutor.setXhrFactory(function(e){return new HttpXhr(e)}),exports.initHttpNode=function(){HttpRequestExecutor.setNodeFactory(function(e){return new HttpNode(e)})};var HttpNode=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.execute=function(e,t,r,o,n,s,i){var u,a=this;this._responseType=s,this._receiveResponseHeaders=i;try{u=exports.URL.parse(t)}catch(e){return exports.nbError("Bad URL: "+t),void this._reject(exports._createError(0,"Bad URL: "+t,""))}var c="https:"===u.protocol,l={method:e,hostname:u.hostname,port:u.port,path:u.path,headers:r,agent:c?HttpRequest._httpsAgent:HttpRequest._httpAgent,timeout:n,pfx:null,passphrase:null,key:null,cert:null,ca:null,rejectUnauthorized:!0};if(c){var p=["pfx","passphrase","key","cert","ca"],g=this._req.service._config.clientCertOptions;if(null!=g)for(var f in g){if(!(0<=p.indexOf(f)))return exports.nbError("invalid parameter "+f+" detected. value: "+JSON.stringify(g[f])),void this._reject(exports._createError(0,"invalid parameter: "+f," value: "+JSON.stringify(g[f])));l[f]=g[f]}this._req.service._config.allowSelfSignedCert?(l.rejectUnauthorized=!1,exports.nbLogger("HTTPS Request Warning : accept self-signed certificate. make sure the risk of this setting.")):l.rejectUnauthorized=!0}if(c&&null!=l.agent&&null!=HttpRequest._httpsAgentOptions)try{exports.tls.createSecureContext(HttpRequest._httpsAgentOptions)}catch(e){exports.nbError("HttpsAgentOptions invalid. check proxy options "+e.toString());var h=exports._createError(0,"Client Error",e.toString());return void this._reject(h)}var d=function(e){var t=e.statusCode;a._req.responseHeaders=e.headers,a._setResponseHandlers(t,e)},_=c?exports.https.request(l,d):exports.http.request(l,d);0<n&&_.setTimeout(n,function(){return _.abort()}),_.on("error",function(e){var t=exports._createError(0,"HTTP request error",e.toString());exports.nbError("HTTP Request Error: "+e.toString()),a._reject(t)}),null!=o&&("string"==typeof o||o instanceof String||o instanceof Buffer?_.write(o):_.write(JSON.stringify(o))),_.end()},e.prototype._setResponseHandlers=function(n,s){var i=this,u=[];s.on("data",function(e){u.push(e)}),s.on("end",function(){var e=Buffer.concat(u),t=i._parseNodeResponse(e);if(200<=n&&n<300)i._receiveResponseHeaders?i._resolve({body:t,headers:s.headers,status:n}):i._resolve(t);else{var r="buffer"!==i._responseType&&null!=t?t.toString():"",o=exports._createError(n,s.statusMessage,r,t);exports.nbError("HTTP Response Error: status="+n+" - "+s.statusMessage),i._reject(o)}}),s.on("error",function(e){var t=exports._createError(0,"Client Error",e.toString());exports.nbError("HTTP Response Error: Client Error: "+e.toString()),i._reject(t)})},e.prototype._parseNodeResponse=function(e){try{switch(this._responseType){default:case"text":return e.toString("utf-8");case"json":var t=e.toString("utf-8");try{return JSON.parse(t)}catch(e){return t}case"buffer":return e}}catch(e){return exports.nbError("bad response: e="+e.toString()),null}},e}(HttpRequestExecutor);exports.HttpNode=HttpNode,HttpRequestExecutor.setNodeFactory(function(e){return new HttpNode(e)});var _SdeRequest=function(){function s(e,t){exports.nbLogger("_SdeRequest(), className="+e+", methodName="+t),this._className=e,this._methodName=t,this._data=null}return s.prototype.setData=function(e){return this._data=e},s.prototype.execute=function(){var r={},e=new Promise(function(e,t){return r.success=e,r.error=t}),t=s._createRequestId();s._callbacks[t]=r,exports.nbLogger("_SdeRequest.execute(), reqId="+t),null==this._data&&(this._data={});var o={data:this._data},n={action:this._className+"."+this._methodName,request_id:t,params:JSON.stringify(o),callback:"Nebula._SdeRequest.sdeCallback"};return exports.nbLogger("_SdeRequest.execute(), sdeParams="+JSON.stringify(n)),exports.sde.smt.common.exIfExecute("NebulaSdePlugin","execute",n),e},s._createRequestId=function(){for(var e=0;e<1e3;e++){var t="id_"+this._requestId;if(this._requestId++,1e3<=this._requestId&&(this._requestId=0),!this._callbacks[t])return exports.nbLogger("_SdeRequest._createRequestId(), requestId="+t),t}throw exports.nbLogger("FATAL Error: Nebula._SdeRequest._createRequestId(), callback slot full!"),new Error("Could not create request ID, callback slot full!")},s.sdeCallback=function(e){try{exports.nbLogger("_SdeRequest.sdeCallback()"),exports.nbLogger("  params="+JSON.stringify(e)),exports.nbLogger("  requestId="+e.requestId),exports.nbLogger("  status="+e.status),exports.nbLogger("  statusText="+e.statusText),exports.nbLogger("  responseText="+e.responseText),exports.nbLogger("  response="+e.response);var t=e.requestId;if(null!=t&&null!=s._callbacks[t]){var r=s._callbacks[t];exports.nbLogger("  requestId="+t),exports.nbLogger("  _callbacks[requestId]="+r);var o=e.status;if(o||(exports.nbLogger("_SdeRequest.sdeCallback(), warning:: not found status property"),o=0),200<=o&&o<300)exports.nbLogger("_SdeRequest.sdeCallback(), call success callback"),r.success(JSON.stringify(e.response));else{var n=exports._createError(e.status,e.statusText,e.responseText);exports.nbLogger("Nebula._SdeRequest.sdeCallback(), call error callback: "+n.message+" "+n.responseText),r.error(n)}delete s._callbacks[t],exports.nbLogger("_SdeRequest.sdeCallback(), _callbacks : "+JSON.stringify(s._callbacks))}else exports.nbError("_SdeRequest.sdeCallback(), not found requestId="+t)}catch(e){exports.nbError("_SdeRequest.sdeCallback(), e="+e)}},s._callbacks={},s._requestId=0,s}();exports._SdeRequest=_SdeRequest;var _SdeNetworkEventListener=function(){function e(){}return e.setCallback=function(e){this._callback=e,exports.nbLogger("_SdeNetworkEventListener.setCallback(), callback="+e);var t={};t.set=!!e;var r={params:JSON.stringify(t),callback:""};return exports.nbLogger("_SdeNetworkEventListener.setCallback(), sdeParams="+JSON.stringify(r)),exports.sde.smt.common.exIfExecute("NebulaNetworkEventManager","setNetworkEventListener",r)},e.onNetworkStateChanged=function(e){try{exports.nbLogger("_SdeNetworkEventListener.onNetworkStateChanged(), params="+JSON.stringify(e)),null!=this._callback&&null!=this._callback.onNetworkStateChanged?null!=e.isOnline?this._callback.onNetworkStateChanged(e.isOnline):exports.nbError("_SdeNetworkEventListener.onNetworkStateChanged(), invalid parameters"):exports.nbLogger("_SdeNetworkEventListener.onNetworkStateChanged(), no callback")}catch(e){exports.nbError("_SdeNetworkEventListener.onNetworkStateChanged(), exception="+e)}},e}();exports._SdeNetworkEventListener=_SdeNetworkEventListener;var _SdeSyncEventListener=function(){function o(){}return o.setListener=function(e,t){if(null!=e){exports.nbLogger("_SdeSyncEventListener.setCallback(), before : _listeners="+JSON.stringify(this._listeners));var r=e.getBucketName(),o=e.getBucketMode();null==t?(this._listeners[r]=t,this._bucketMode[r]=o):(null!=this._listeners[r]&&delete this._listeners[r],null!=this._bucketMode[r]&&delete this._bucketMode[r]),exports.nbLogger("_SdeSyncEventListener.setCallback(), after  : _listeners="+JSON.stringify(this._listeners));var n={};n.bucketName=r,n.bucketMode=o,n.set=!!t;var s={params:JSON.stringify(n),callback:""};return exports.nbLogger("_SyncEventListener.setCallback(), sdeParams="+JSON.stringify(s)),exports.sde.smt.common.exIfExecute("NebulaSyncEventManager","setSyncEventListener",s)}exports.nbError("_SdeSyncEventListener.setCallback(), no bucket")},o.resolveConflict=function(e){exports.nbLogger("_SyncEventListener.resolveConflict(), data="+e);var t={params:JSON.stringify(e),callback:""};return exports.nbLogger("_SyncEventListener.resolveConflict(), sdeParams="+JSON.stringify(t)),exports.sde.smt.common.exIfExecute("NebulaSyncEventManager","resolveConflict",t)},o.onSyncStart=function(e){try{if(exports.nbLogger("_SdeSyncEventListener.onSyncStart(), params="+JSON.stringify(e)),null!=e.bucketName){var t=e.bucketName,r=o._listeners[t];r&&r.onSyncStart?r.onSyncStart(t):exports.nbLogger("_SdeSyncEventListener.onSyncStart(), no callback or onSyncStart")}else exports.nbLogger("_SdeSyncEventListener.onSyncStart(), no bucketName")}catch(e){exports.nbLogger("_SdeSyncEventListener.onSyncStart(), exception="+e)}},o.onSyncCompleted=function(e){try{if(exports.nbLogger("_SdeSyncEventListener.onSyncCompleted(), params="+JSON.stringify(e)),exports.nbLogger("_SdeSyncEventListener.onSyncCompleted(), bucketName="+e.bucketName),exports.nbLogger("_SdeSyncEventListener.onSyncCompleted(), objectIds="+e.objectIds),null!=e.bucketName&&null!=e.objectIds){var t=e.bucketName,r=o._listeners[t];r&&r.onSyncCompleted?r.onSyncCompleted(t,e.objectIds):exports.nbLogger("_SdeSyncEventListener.onSyncCompleted(), no callback or onSyncCompleted")}else exports.nbLogger("_SdeSyncEventListener.onSyncCompleted(), no bucketName or objectIds")}catch(e){exports.nbLogger("_SdeSyncEventListener.onSyncCompleted(), exception="+e)}},o.onSyncConflicted=function(e){try{if(exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), params="+JSON.stringify(e)),exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), bucketName="+e.bucketName),exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), resolveId="+e.resolveId),exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), client="+e.client),exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), server="+e.server),null!=e.bucketName&&null!=e.resolveId&&null!=e.client&&null!=e.server){var t=e.bucketName,r=this._bucketMode[t];null==r&&(r=exports.Nebula.BUCKET_MODE_REPLICA);var o=this._listeners[t];if(o&&o.onSyncConflicted){var n=new exports.Nebula.ObjectBucket(t,r);n._setResolveId(e.resolveId),o.onSyncConflicted(n,e.client,e.server)}else exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), no callback or onSyncCompleted")}else exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), invalid parameters")}catch(e){exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), exception="+e)}},o.onResolveConflict=function(e){try{if(exports.nbLogger("_SdeSyncEventListener.onResolveConflict(), params="+JSON.stringify(e)),exports.nbLogger("_SdeSyncEventListener.onResolveConflict(), resolve="+e.resolve),exports.nbLogger("_SdeSyncEventListener.onResolveConflict(), object="+e.object),null!=e.bucketName&&null!=e.resolve&&null!=e.object){var t=e.bucketName,r=o._listeners[t];r&&r.onResolveConflict?r.onResolveConflict(e.object,e.resolve):exports.nbLogger("Nebula._SdeSyncEventListener.onResolveConflict(), no callback or onResolveConflict")}else exports.nbLogger("_SdeSyncEventListener.onSyncConflicted(), invalid parameters")}catch(e){exports.nbLogger("_SdeSyncEventListener.onResolveConflict(), exception="+e)}},o.onSyncError=function(e){try{if(exports.nbLogger("_SdeSyncEventListener.onSyncError(), params="+JSON.stringify(e)),exports.nbLogger("_SdeSyncEventListener.onSyncError(), errorCode="+e.errorCode),exports.nbLogger("_SdeSyncEventListener.onSyncError(), object="+e.object),null!=e.bucketName&&null!=e.errorCode&&null!=e.object){var t=e.bucketName,r=o._listeners[t];null!=r&&null!=r.onSyncError?r.onSyncError(e.errorCode,e.object):exports.nbLogger("_SdeSyncEventListener.onSyncError(), no callback or onSyncError")}else exports.nbLogger("_SdeSyncEventListener.onSyncError(), invalid parameters")}catch(e){exports.nbLogger("_SdeSyncEventListener.onSyncError(), exception="+e)}},o._listeners={},o._bucketMode={},o}();exports._SdeSyncEventListener=_SdeSyncEventListener;var AccountLink=function(){function e(){}return Object.defineProperty(e.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iss",{get:function(){return this._iss},set:function(e){this._iss=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sub",{get:function(){return this._sub},set:function(e){this._sub=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"op",{get:function(){return this._op},set:function(e){this._op=e},enumerable:!0,configurable:!0}),e.prototype._setAccountLink=function(e){return null!=e._id&&(this.__id=e._id),null!=e.iss&&(this._iss=e.iss),null!=e.sub&&(this._sub=e.sub),null!=e.op&&(this._op=e.op),this},e}();exports.AccountLink=AccountLink,exports.AclPermission={READ:"r",WRITE:"w",CREATE:"c",UPDATE:"u",DELETE:"d",ADMIN:"admin",OWNER:"owner"},exports.AclGroup={AUTHENTICATED:"g:authenticated",ANONYMOUS:"g:anonymous"};var Acl=function(){function n(e){if(exports.nbLogger("Acl(), json="+e),this._acl={r:[],w:[],c:[],u:[],d:[],admin:[]},e)for(var t=0,r=[n.OWNER,n.READ,n.WRITE,n.CREATE,n.UPDATE,n.DELETE,n.ADMIN];t<r.length;t++){var o=r[t];e[o]&&(this._acl[o]=e[o])}}return n.prototype.addEntry=function(e,t){var r=this._acl[e];if(!r)return!1;if(!t)return!1;var o=null;o=t instanceof User?t._id:t instanceof Group?"g:"+t.groupname:t;for(var n=!1,s=0,i=r;s<i.length;s++){var u=i[s];if(u===o){n=!0;break}}return!n&&(r.push(o),exports.nbLogger("Acl.addEntry(), added entry="+o),!0)},n.prototype.removeEntry=function(e,t){var r=this._acl[e];if(!r)return!1;if(!t)return!1;var o=null;o=t instanceof User?t._id:t instanceof Group?"g:"+t.groupname:t;for(var n=0;n<r.length;n++){var s=r[n];if(s===o){r.splice(n,1),exports.nbLogger("Acl.removeEntry(), removed entry="+o);break}}},n.prototype._setOwner=function(e){this._acl[n.OWNER]=e},n.prototype.getOwner=function(){return this._acl.owner?this._acl.owner:null},n.prototype.getEntries=function(e){var t=this._acl[e];return t||null},n.prototype._set=function(e){this._acl=e},n.prototype._hasEntry=function(e,t){var r=this._acl[e];if(r)for(var o=0,n=r;o<n.length;o++){var s=n[o];if(s===t)return!0}return!1},n.prototype._toString=function(e){return JSON.stringify(this._toJsonObject(e))},n.prototype._toJsonObject=function(e){if("ACL"===e||"contentACL"===e){var t={};return t[e]=this._acl,t}return this._acl},n.READ="r",n.WRITE="w",n.CREATE="c",n.UPDATE="u",n.DELETE="d",n.ADMIN="admin",n.OWNER="owner",n.AUTHENTICATED="g:authenticated",n.ANONYMOUS="g:anonymous",n}();exports.Acl=Acl,exports.RegexOption={CASE_INSENSITIVITY:"i"};var Clause=function(){function o(e){this._clause=null!=e?e:{}}return o.prototype._setParams=function(e,t,r,o){if(null===t)this._clause[e]=r;else{var n={};exports._isObject(this._clause[e])&&(n=this._clause[e]),n[t]=r,o&&(n.$options=o),this._clause[e]=n}return this},o.prototype.json=function(){return this._clause},o.equals=function(e,t){return(new o).equals(e,t)},o.prototype.equals=function(e,t){var r=null;return null!=t&&exports._isObject(t)&&(r="$eq"),this._setParams(e,r,t)},o.notEquals=function(e,t){return(new o).notEquals(e,t)},o.prototype.notEquals=function(e,t){return this._setParams(e,"$ne",t)},o.lessThan=function(e,t){return(new o).lessThan(e,t)},o.prototype.lessThan=function(e,t){return this._setParams(e,"$lt",t)},o.lessThanOrEqual=function(e,t){return(new o).lessThanOrEqual(e,t)},o.prototype.lessThanOrEqual=function(e,t){return this._setParams(e,"$lte",t)},o.greaterThan=function(e,t){return(new o).greaterThan(e,t)},o.prototype.greaterThan=function(e,t){return this._setParams(e,"$gt",t)},o.greaterThanOrEqual=function(e,t){return(new o).greaterThanOrEqual(e,t)},o.prototype.greaterThanOrEqual=function(e,t){return this._setParams(e,"$gte",t)},o.in=function(e,t){return(new o).in(e,t)},o.prototype.in=function(e,t){return this._setParams(e,"$in",t)},o.all=function(e,t){return(new o).all(e,t)},o.prototype.all=function(e,t){return this._setParams(e,"$all",t)},o.exist=function(e,t){return(new o).exist(e,t)},o.prototype.exist=function(e,t){if("boolean"==typeof t)return this._setParams(e,"$exists",t);throw new Error("exist: value is not boolean")},o.regex=function(e,t,r){return(new o).regex(e,t,r)},o.prototype.regex=function(e,t,r){return this._setParams(e,"$regex",t,r)},o.prototype.not=function(e){var t;return null===this._clause||null==this._clause[e]?null:(t=exports._isObject(this._clause[e])?{$not:this._clause[e]}:{$not:{$eq:this._clause[e]}},this._clause[e]=t,this)},o.and=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o._convertClauseArray(e);return(new o)._setParams("$and",null,r)},o.or=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o._convertClauseArray(e);return(new o)._setParams("$or",null,r)},o._convertClauseArray=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var n=o[r],s=n.json();null!=s&&t.push(s)}return t},o}();exports.Clause=Clause;var ObjectQuery=function(){function u(){this._clause=null,this._limit=-1,this._skip=0,this._sort=[],this._deleteMark=!1,this._countQuery=!1,this._projection=null}return u.prototype.getClause=function(){return this._clause},u.prototype.getLimit=function(){return this._limit},u.prototype.getSkipCount=function(){return this._skip},u.prototype.getSort=function(){return this._sort},u.prototype.getSortOrder=function(){for(var e=[],t=0;t<this._sort.length;t++){var r=this._sort[t],o={};r.match(/^-/)?o[r.substr(1)]=!1:o[r]=!0,e.push(o)}return e},u.prototype._getDeleteMark=function(){return this._deleteMark},u.prototype.getProjection=function(){return this._projection},u.prototype._setDeleteMark=function(e){if("boolean"!=typeof e)throw new Error("deleteMark must be boolean");exports.nbLogger("ObjectQuery._setDeleteMark(), mark="+e+", cur="+this._deleteMark),this._deleteMark=e},u.prototype._toParam=function(){var e=this._toParamJson();return e.where&&(e.where=JSON.stringify(e.where)),e.projection&&(e.projection=JSON.stringify(e.projection)),e},u.prototype._toParamJson=function(){var e={};return this._clause&&(e.where=this._clause.json()),0<this._sort.length&&(e.order=this._sort.join(",")),e.skip=this._skip,e.limit=this._limit,this._countQuery&&(e.count=1),this._deleteMark&&(e.deleteMark=1),this._projection&&(e.projection=this._projection),e},u._toObjectQuery=function(e){var t=new u;exports.nbLogger("ObjectQuery._toObjectQuery(), queryJson="+JSON.stringify(e)),null!=e.limit&&t.setLimit(e.limit),null!=e.skip&&t.setSkipCount(e.skip);var r=e.sort;if(null!=r)for(var o=0,n=Object.keys(r);o<n.length;o++){var s=n[o];t.setSortOrder(s,r[s])}var i=e.clause;return null!=i&&0!==Object.keys(i).length&&t.setClause(new Clause(i)),null!=e.deleteMark&&t._setDeleteMark(e.deleteMark),null!=e.countQuery&&t._setCountQuery(e.countQuery),t},u.prototype._equals=function(e){if(this._limit!==e.getLimit())return!1;if(this._skip!==e.getSkipCount())return!1;if(this._deleteMark!==e._getDeleteMark())return!1;if(this._countQuery!==e._isCountQuery())return!1;if(this._projection){if(!e.getProjection())return!1;if(!exports._compareObject(this._projection,e.getProjection()))return!1}else if(e.getProjection())return!1;if(this._clause){if(!e.getClause())return!1;if(!exports._compareObject(this._clause.json(),e.getClause().json()))return!1}else if(e.getClause())return!1;return exports._compareObject(this._sort,e.getSortOrder())},u.prototype.setClause=function(e){if(!(null===e||e instanceof Clause))throw new Error("clause must be instanceof Nebula.Clause or null");return this._clause=e,this},u.prototype.setLimit=function(e){if(!(-1<=e))throw new Error("Invalid limit range");return this._limit=e,this},u.prototype.setSkipCount=function(e){if(!(0<=e))throw new Error("Invalid skip range");return this._skip=e,this},u.prototype.setSort=function(e){return this._sort=e,this},u.prototype.setSortOrder=function(e,t){if(!e)throw new Error("No key");if("boolean"!=typeof t)throw new Error("isAsc must be boolean");return t?this._sort.push(e):this._sort.push("-"+e),this},u.prototype.clearSortOrder=function(e){if(void 0===e&&(e=null),e)for(var t=0;t<this._sort.length;t++){var r=this._sort[t];if(r===e||r==="-"+e){this._sort.splice(t,1);break}}else this._sort=[];return this},u.prototype._setCountQuery=function(e){if("boolean"!=typeof e)throw new Error("countQuery must be boolean");return this._countQuery=e,this},u.prototype._isCountQuery=function(){return this._countQuery},u.prototype.setProjection=function(e){if(e&&exports._isObject(e))this._projection=e;else{if(null!==e)throw new Error("projection must be object or null");this._projection=null}return this},u}();exports.ObjectQuery=ObjectQuery;var User=function(){function n(e){void 0===e&&(e=exports.Nebula),this._service=e,this.__id=null,this._username=null,this._email=null,this._password=null,this._options=null,this._groups=null,this._createdAt=null,this._updatedAt=null,this._lastLoginAt=null,this._etag=null,this._sessionToken=null,this._expire=null,this._clientCertUser=null,this._federated=!1,this._primaryLinkedUserId=null}return Object.defineProperty(n.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"email",{get:function(){return this._email},set:function(e){this._email=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"password",{get:function(){return this._password},set:function(e){this._password=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"updatedAt",{get:function(){return this._updatedAt},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastLoginAt",{get:function(){return this._lastLoginAt},set:function(e){this._lastLoginAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"etag",{get:function(){return this._etag},set:function(e){this._etag=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sessionToken",{get:function(){return this._sessionToken},set:function(e){this._sessionToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"expire",{get:function(){return this._expire},set:function(e){this._expire=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"clientCertUser",{get:function(){return this._clientCertUser},set:function(e){this._clientCertUser=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"federated",{get:function(){return this._federated},set:function(e){this._federated=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"primaryLinkedUserId",{get:function(){return this._primaryLinkedUserId},set:function(e){this._primaryLinkedUserId=e},enumerable:!0,configurable:!0}),n.prototype._setUserInfo=function(e){var t;exports.nbLogger("User._setUserInfo#start");try{t=JSON.parse(e)}catch(e){exports.nbError("User._setUserInfo#json error."),t=null}null!==t&&(void 0!==t._id&&(this._id=t._id),void 0!==t.username&&(this.username=t.username),void 0!==t.email&&(this.email=t.email),void 0!==t.password&&(this.password=t.password),void 0!==t.options&&(this.options=t.options),void 0!==t.groups&&(this.groups=t.groups),void 0!==t.createdAt&&(this.createdAt=t.createdAt),void 0!==t.updatedAt&&(this.updatedAt=t.updatedAt),void 0!==t.lastLoginAt&&(this.lastLoginAt=t.lastLoginAt),void 0!==t.etag&&(this.etag=t.etag),void 0!==t.sessionToken&&(this.sessionToken=t.sessionToken),void 0!==t.expire&&(this.expire=t.expire),void 0!==t.clientCertUser&&(this.clientCertUser=t.clientCertUser),void 0!==t.federated&&(this.federated=t.federated),void 0!==t.primaryLinkedUserId&&(this.primaryLinkedUserId=t.primaryLinkedUserId))},n.prototype.set=function(e,t){switch(e){case"_id":this._id=t;break;case"username":this.username=t;break;case"email":this.email=t;break;case"password":this.password=t;break;case"options":this.options=t;break;case"createdAt":this.createdAt=t;break;case"updatedAt":this._updatedAt=t;break;case"sessionToken":this.sessionToken=t;break;case"expire":this.expire=t;break;case"clientCertUser":this.clientCertUser=t;break;case"federated":this.federated=t;break;case"primaryLinkedUserId":this.primaryLinkedUserId=t;break;default:throw exports.nbError("Invalid property: "+e),new Error("Invalid property: "+e)}},n.prototype.get=function(e){switch(e){case"_id":return this._id;case"username":return this.username;case"email":return this.email;case"password":return this.password;case"options":return this.options;case"groups":return this.groups;case"createdAt":return this.createdAt;case"updatedAt":return this.updatedAt;case"sessionToken":return this.sessionToken;case"expire":return this.expire;case"clientCertUser":return this.clientCertUser;case"federated":return this.federated;case"primaryLinkedUserId":return this.primaryLinkedUserId;default:throw exports.nbError("Invalid property"),new Error("Invalid property name")}},n.prototype.register=function(e){var t,r,o=this;if(exports.nbLogger("User.register#start"),this._service.isOffline())t=new _SdeRequest("NebulaUser","register");else{exports.nbLogger("User.register#REST API Request path = /users"),(t=new HttpRequest(this._service,"/users")).setMethod("POST"),t.setContentType("application/json")}!0===this.clientCertUser?r={clientCertUser:!0,username:this.username}:(r={email:this.email,password:this.password},null!=this.username&&(r.username=this.username)),null!==this.options&&(r.options=this.options),t.setData(r);var n=t.execute().then(function(e){return exports.nbLogger("User.register#success callback start"),exports.nbLogger("User.register#response = "+e),o._setUserInfo(e),o}).catch(function(e){return exports.nbLogger("User.register#error callback start"),exports.nbLogger("User.register#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.register#end"),exports._promisify(n,e)},n.login=function(e,t){return null},n._login=function(t,e,r){if(exports.nbLogger("User.login#start"),null==e||null==e.email&&null==e.username&&null==e.token)throw new Error("User.login: No username nor email nor token");if(null==e.password&&null==e.token)throw new Error("User.login: No password nor token");var o;if(t.isOffline())o=new _SdeRequest("NebulaUser","login");else{exports.nbLogger("User.login#REST API Request path = /login"),(o=new HttpRequest(t,"/login")).setSessionToken(null),o.setMethod("POST"),o.setContentType("application/json")}o.setData(e);var n=new t.User;n.email=e.email,n.username=e.username;var s=o.execute().then(function(e){return exports.nbLogger("User.login#success callback start"),exports.nbLogger("User.login#response = "+e),n._setUserInfo(e),t.setCurrentUser(n),n}).catch(function(e){return exports.nbLogger("User.login#error callback start"),exports.nbLogger("User.login#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.login#end"),exports._promisify(s,r)},n.logout=function(e){return null},n._logout=function(t,e){var r;if(exports.nbLogger("User.logout#start"),t.isOffline())r=new _SdeRequest("NebulaUser","logout");else{exports.nbLogger("User.logout#REST API Request path = /login"),(r=new HttpRequest(t,"/login")).setMethod("DELETE"),r.setContentType("application/json")}var o=r.execute().then(function(e){exports.nbLogger("User.logout#success callback start"),exports.nbLogger("User.logout#response = "+e),t.removeCurrentUser()}).catch(function(e){return exports.nbLogger("User.logout#error callback start"),exports.nbLogger("User.logout#error = "+exports._errorText(e)),t.removeCurrentUser(),Promise.reject(e)});return exports.nbLogger("User.logout#end"),exports._promisify(o,e)},n.current=function(e){return null},n._current=function(e,t){var r=null,o=e.getCurrentUser();return null!==o&&(r=new e.User)._setUserInfo(JSON.stringify(o)),t&&t.success&&t.success(r),r},n.saveCurrent=function(e){},n._saveCurrent=function(e,t){if(e.isOffline())throw new Error("Not supported in offline mode");if(null===t)e.removeCurrentUser();else{var r=e.getCurrentUser()||{};for(var o in t)t.hasOwnProperty(o)&&(r[o]=t[o]);var n=new e.User;n._setUserInfo(JSON.stringify(r)),e.setCurrentUser(n)}},n.queryCurrent=function(e){return null},n._queryCurrent=function(r,e){var t;if(exports.nbLogger("User.queryCurrent#start"),r.isOffline()){var o=r.getCurrentUser();if(null===o)return exports._promisify(Promise.resolve(null),e);t=new _SdeRequest("NebulaUser","current")}else{var n="/users/current";exports.nbLogger("User.queryCurrent#REST API Request path = "+n),(t=new HttpRequest(r,n)).setMethod("GET"),t.setContentType("application/json")}var s=t.execute().then(function(e){exports.nbLogger("User.queryCurrent#success callback start"),exports.nbLogger("User.queryCurrent#response = "+e);var t=new r.User;return t._setUserInfo(e),t}).catch(function(e){return exports.nbLogger("User.queryCurrent#error callback start"),exports.nbLogger("User.queryCurrent#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.queryCurrent#end"),exports._promisify(s,e)},n.query=function(e,t){return null},n._query=function(i,u,e){var t;if(exports.nbLogger("User.query#start"),i.isOffline())t=new _SdeRequest("NebulaUser","query"),null!==u&&t.setData(u);else{var r="/users",o={};u&&(u._id?r="/users/"+encodeURIComponent(u._id):u.email?o.email=u.email:u.username&&(o.username=u.username),null!=u.skip&&(o.skip=u.skip),null!=u.limit&&(o.limit=u.limit)),exports.nbLogger("User.query#REST API Request path = "+r),(t=new HttpRequest(i,r)).setMethod("GET"),t.setQueryParams(o),t.setContentType("application/json")}var n=t.execute().then(function(e){exports.nbLogger("User.query#success callback start"),exports.nbLogger("User.query#response = "+e);var t=JSON.parse(e),r=[],o=[],n=0;for(void 0===t.results?r.push(t):r=t.results;n<r.length;){var s=new i.User;s._setUserInfo(JSON.stringify(r[n])),o.push(s),n++}return null!=u&&u.countQuery?{users:o,count:t.count}:o}).catch(function(e){return exports.nbLogger("User.query#error callback start"),exports.nbLogger("User.query#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.query#end"),exports._promisify(n,e)},n.update=function(e,t){return null},n._update=function(e,t,r){if(!(t instanceof n))throw new Error("User.update: not User instance");if(t._service!==e)throw new Error("Service does not match");return t._update(r)},n.prototype._update=function(e){var t,r,o,n=this;if(exports.nbLogger("User.update#start"),null===this._id)return exports.nbLogger("User.update: no user id"),o=exports._createError(400,"Bad Request (local)","no user id."),exports._promisify(Promise.reject(o),e);var s={};this._service.isOffline()?(r=new _SdeRequest("NebulaUser","update"),s._id=this._id):(t="/users/"+this._id,exports.nbLogger("User.update#REST API Request path = "+t),(r=new HttpRequest(this._service,t)).setMethod("PUT"),r.setContentType("application/json"),delete s._id),null!==this.email&&(s.email=this.email),null!==this.username&&(s.username=this.username),null!==this.password&&(s.password=this.password),null!==this.options&&(s.options=this.options),r.setData(s);var i=r.execute().then(function(e){return exports.nbLogger("User.update#success callback start"),exports.nbLogger("User.update#response = "+e),n._setUserInfo(e),n}).catch(function(e){return exports.nbLogger("User.update#error callback start"),exports.nbLogger("User.update#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.update#end"),exports._promisify(i,e)},n.remove=function(e,t){return null},n._remove=function(e,t,r){if(!(t instanceof n))throw new Error("User.remove: not User instance");if(t._service!==e)throw new Error("User.remove: service does not match");return t._remove(r)},n.prototype._remove=function(e){var t,r=this;if(exports.nbLogger("User.remove#start"),null===this._id){exports.nbLogger("User.remove: no user id.");var o=exports._createError(400,"Bad argument (local)","no user id.");return exports._promisify(Promise.reject(o),e)}if(this._service.isOffline())(t=new _SdeRequest("NebulaUser","delete")).setData({_id:this._id});else{var n="/users/"+this._id;exports.nbLogger("User.remove#REST API Request path = "+n),(t=new HttpRequest(this._service,n)).setMethod("DELETE")}var s=t.execute().then(function(e){exports.nbLogger("User.remove#success callback start"),exports.nbLogger("User.remove#response = "+e);var t=r._service.getCurrentUser();null!==t&&r._id===t._id&&(exports.nbLogger("User.remove#delete user is current user"),r._service.removeCurrentUser())}).catch(function(e){return exports.nbLogger("User.remove#error callback start"),exports.nbLogger("User.remove#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.remove#end"),exports._promisify(s,e)},n.resetPassword=function(e,t){return null},n._resetPassword=function(e,t,r){if(exports.nbLogger("User.resetPassword#start"),null==t||null==t.email&&null==t.username)throw new Error("User.resetPassword: bad arguments");var o,n;if(e.isOffline())o=new _SdeRequest("NebulaUser","resetPassword");else{var s="/request_password_reset";exports.nbLogger("User.resetPassword#REST API Request path = "+s),(o=new HttpRequest(e,s)).setSessionToken(null),o.setMethod("POST"),o.setContentType("application/json")}void 0!==t.email&&void 0!==t.username?n={email:t.email,username:t.username}:void 0!==t.email&&void 0===t.username?n={email:t.email}:void 0===t.email&&void 0!==t.username&&(n={username:t.username}),o.setData(n);var i=o.execute().then(function(e){exports.nbLogger("User.resetPassword#success callback start"),exports.nbLogger("User.resetPassword#response = "+e)}).catch(function(e){return exports.nbLogger("User.resetPassword#error callback start"),exports.nbLogger("User.resetPassword#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.delete#end"),exports._promisify(i,r)},n.getAccountLinks=function(e,t){return null},n._getAccountLinks=function(e,t,r){if(!(t instanceof n))throw new Error("User.getAccountLinks: not User instance");if(t._service!==e)throw new Error("User.getAccountLinks: Service does not match");return t._getAccountLinks(r)},n.prototype._getAccountLinks=function(e){if(exports.nbLogger("User.getAccountLinks#start"),this._service.isOffline())throw new Error("User.getAccountLinks: offline mode is not supported");if(null===this._id)throw new Error("User.getAccountLinks: no user id");var t="/users/"+this._id+"/links";exports.nbLogger("User.getAccountLinks#REST API Request path = "+t);var r=new HttpRequest(this._service,t);r.setMethod("GET");var o=r.execute().then(function(e){exports.nbLogger("User.getAccountLinks#response = "+e);var t=JSON.parse(e),r=t.results,o=[];if(null!=r)for(var n=0,s=r;n<s.length;n++){var i=s[n],u=new AccountLink;u._setAccountLink(i),o.push(u)}return o}).catch(function(e){return exports.nbLogger("User.getAccountLinks#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.getAccountLinks#end"),exports._promisify(o,e)},n.deleteAccountLink=function(e,t,r){return null},n._deleteAccountLink=function(e,t,r,o){if(!(t instanceof n))throw new Error("User.deleteAccountLink: not User instance");if(t._service!==e)throw new Error("User.deleteAccountLink: Service does not match");if(null==r)throw new Error("User.deleteAccountLink: no linkedUserId");return t._deleteAccountLink(r,o)},n.prototype._deleteAccountLink=function(e,t){if(exports.nbLogger("User.deleteAccountLink#start"),this._service.isOffline())throw new Error("User.deleteAccountLink: offline mode is not supported");if(null===this._id)throw new Error("User.deleteAccountLink: no user id");if(null!==this.primaryLinkedUserId&&this.primaryLinkedUserId===e)throw new Error("User.deleteAccountLink: linkedUserId is primaryLinkedUserId");var r="/users/"+this._id+"/links/"+e;exports.nbLogger("User.deleteAccountLink#REST API Request path = "+r);var o=new HttpRequest(this._service,r);o.setMethod("DELETE");var n=o.execute().then(function(e){exports.nbLogger("User.deleteAccountLink#response = "+e)}).catch(function(e){return exports.nbLogger("User.deleteAccountLink#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("User.deleteAccountLink#end"),exports._promisify(n,t)},n}();exports.User=User,exports.declareUser=function(n){var e;n.User=((e=function(o){function e(){var e=o.call(this,n)||this;return exports.nbLogger("User.constructor"),e}return __extends(e,o),e.login=function(e,t){return o._login.call(this,n,e,t)},e.logout=function(e){return o._logout.call(this,n,e)},e.current=function(e){return o._current.call(this,n,e)},e.saveCurrent=function(e){o._saveCurrent.call(this,n,e)},e.queryCurrent=function(e){return o._queryCurrent.call(this,n,e)},e.query=function(e,t){return o._query.call(this,n,e,t)},e.update=function(e,t){return o._update.call(this,n,e,t)},e.remove=function(e,t){return o._remove.call(this,n,e,t)},e.resetPassword=function(e,t){return o._resetPassword.call(this,n,e,t)},e.getAccountLinks=function(e,t){return o._getAccountLinks.call(this,n,e,t)},e.deleteAccountLink=function(e,t,r){return o._deleteAccountLink.call(this,n,e,t,r)},e}(User)).delete=e.remove,e)};var Group=function(){function o(e,t){void 0===t&&(t=exports.Nebula),this._service=t,this._id=null,this.groupname=null,this.users=[],this.groups=[],this.acl=null,this.createdAt=null,this.updatedAt=null,this.etag=null,"string"==typeof e&&""!==e&&(this.groupname=e)}return Object.defineProperty(o.prototype,"_id",{get:function(){return this.__id},set:function(e){this.__id=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"groupname",{get:function(){return this._groupname},set:function(e){this._groupname=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"users",{get:function(){return this._users},set:function(e){this._users=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"acl",{get:function(){return this._acl},set:function(e){if(null!=e&&!(e instanceof Acl))throw new Error("acl is not Acl instance!");this._acl=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"updatedAt",{get:function(){return this._updatedAt},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"etag",{get:function(){return this._etag},set:function(e){this._etag=e},enumerable:!0,configurable:!0}),o.prototype._setGroupInfo=function(e){var t;try{t=JSON.parse(e)}catch(e){return void exports.nbError("Group._setGroupInfo#json error.")}if(void 0!==t._id&&(this._id=t._id),void 0!==t.name&&(this.groupname=t.name),void 0!==t.users&&(this.users=t.users),void 0!==t.groups&&(this.groups=t.groups),void 0!==t.ACL&&(this.acl=new Acl,this.acl._set(t.ACL),void 0!==t.ACL.owner&&this.acl._setOwner(t.ACL.owner)),void 0!==t.createdAt&&(this.createdAt=t.createdAt),void 0!==t.updatedAt&&(this.updatedAt=t.updatedAt),void 0!==t.etag)return this.etag=t.etag},o.prototype.set=function(e,t){switch(e){case"_id":this._id=t;break;case"groupname":this.groupname=t;break;case"users":this.users=t;break;case"groups":this.groups=t;break;case"acl":this.acl=t;break;case"createdAt":this.createdAt=t;break;case"updatedAt":this.updatedAt=t;break;case"etag":this.etag=t;break;default:throw exports.nbError("Invalid property: "+e),new Error("Invalid property: "+e)}},o.prototype.get=function(e){switch(e){case"_id":return this._id;case"groupname":return this.groupname;case"users":return this.users;case"groups":return this.groups;case"acl":return this.acl;case"createdAt":return this.createdAt;case"updatedAt":return this.updatedAt;case"etag":return this.etag;default:throw exports.nbError("Invalid property: "+e),new Error("Invalid property: "+e)}},o.prototype.addEntry=function(e){exports.nbLogger("Group.addEntry#start");var t=[],r=null;if(e instanceof this._service.User)r=e._id,t=this.users;else{if(!(e instanceof this._service.Group))throw new Error("Group.addEntry: Invalid entry");r=e.groupname,t=this.groups}for(var o=!1,n=0,s=t;n<s.length;n++){var i=s[n];i===r&&(o=!0)}return o||t.push(r),exports.nbLogger("Group.addEntry#end"),!0},o.prototype.removeEntry=function(e){exports.nbLogger("Group.removeEntry#start");var t=[],r=null;if(e instanceof this._service.User)r=e._id,t=this.users;else{if(!(e instanceof this._service.Group))throw new Error("Group.removeEntry: Invalid entry");r=e.groupname,t=this.groups}for(var o=0;o<t.length;o++)if(t[o]===r){t.splice(o,1);break}return exports.nbLogger("Group.removeEntry#end"),!0},o.prototype.save=function(e){var t=this;if(exports.nbLogger("Group.save#start"),null==this.groupname)throw new Error("Group.save: no group name");var r,o={};if(this._service.isOffline())r=new _SdeRequest("NebulaGroup","save"),o.groupname=this.groupname,null!=this.etag&&(o.etag=this.etag);else{var n="/groups/"+encodeURIComponent(this.groupname);exports.nbLogger("Group.save#REST API Request path = "+n),r=new HttpRequest(this._service,n),null!=this.etag&&r.setQueryParam("etag",this.etag),r.setMethod("PUT"),r.setContentType("application/json")}o.users=this.users,o.groups=this.groups,null!==this.acl&&(o.ACL=this.acl._toJsonObject()),r.setData(o);var s=r.execute().then(function(e){return exports.nbLogger("Group.save#success callback start"),exports.nbLogger("Group.save#response = "+e),t._setGroupInfo(e),t}).catch(function(e){return exports.nbLogger("Group.save#error callback start"),exports.nbLogger("Group.save#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("Group.save#end"),exports._promisify(s,e)},o.prototype.addMembers=function(e,t,r){return this._addRemoveMembers("add",e,t,r)},o.prototype.removeMembers=function(e,t,r){return this._addRemoveMembers("remove",e,t,r)},o.prototype._addRemoveMembers=function(t,e,r,o){var n=this;if(exports.nbLogger("Group."+t+"Members#start"),null==this.groupname)throw new Error("No group name");if(this._service.isOffline())throw new Error("offline mode is not supported.");var s="/groups/"+encodeURIComponent(this.groupname)+"/"+t+"Members",i=new HttpRequest(this._service,s);i.setMethod("PUT"),i.setContentType("application/json");var u={users:null!=e?e:[],groups:null!=r?r:[]};i.setData(u);var a=i.execute().then(function(e){return exports.nbLogger("Group."+t+"Members#response = "+e),n._setGroupInfo(e),n}).catch(function(e){return exports.nbLogger("Group."+t+"Members#error = "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(a,o)},o.remove=function(e,t){return null},o._remove=function(e,t,r){if(!(t instanceof o))throw new Error("Group.remove: not Group instance!");if(t._service!==e)throw new Error("Service does not match");return t._remove(r)},o.prototype._remove=function(e){var t;if(exports.nbLogger("Group.remove#start"),this._service.isOffline()){t=new _SdeRequest("NebulaGroup","delete");var r={groupname:this.groupname},o=this.etag;null!=o&&(r.etag=o),t.setData(r)}else{var n="/groups/"+encodeURIComponent(this.groupname);exports.nbLogger("Group.remove#REST API Request path = "+n),t=new HttpRequest(this._service,n);var o=this.etag;null!=o&&t.setQueryParam("etag",o),t.setMethod("DELETE")}var s=t.execute().then(function(e){exports.nbLogger("Group.remove#success callback start"),exports.nbLogger("Group.remove#response = "+e)}).catch(function(e){return exports.nbLogger("Group.remove#error callback start"),exports.nbLogger("Group.remove#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("Group.remove#end"),exports._promisify(s,e)},o.query=function(e,t){return null},o._query=function(a,e,t){exports.nbLogger("Group.query#start");var r,o=null;if(null!=e){if(null==e.groupname)throw new Error("Group.query: no groupname in conditions");o=e.groupname}if(a.isOffline())r=new _SdeRequest("NebulaGroup","query"),null!==o&&r.setData({groupname:o});else{var n=void 0;n=null!==o?"/groups/"+encodeURIComponent(o):"/groups",exports.nbLogger("Group.query#REST API Request path = "+n),(r=new HttpRequest(a,n)).setMethod("GET"),r.setContentType("application/json")}var s=r.execute().then(function(e){exports.nbLogger("Group.query#response = "+e);var t=JSON.parse(e),r=[],o=[];void 0===t.results?r.push(t):r=t.results;for(var n=0,s=r;n<s.length;n++){var i=s[n],u=new a.Group(i.name);u._setGroupInfo(JSON.stringify(i)),o.push(u)}return o}).catch(function(e){return exports.nbLogger("Group.query#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("Group.query#end"),exports._promisify(s,t)},o}();exports.Group=Group,exports.declareGroup=function(o){var e;o.Group=((e=function(r){function e(e){var t=r.call(this,e,o)||this;return exports.nbLogger("Group.constructor"),t}return __extends(e,r),e.remove=function(e,t){return r._remove.call(this,o,e,t)},e.query=function(e,t){return r._query.call(this,o,e,t)},e}(Group)).delete=e.remove,e)};var FileMetadata=function(){function e(){this._createdAt=null,this._updatedAt=null,this._acl=null,this._contentType=null,this._publicUrl=null,this._fileName=null,this._fileSize=-1,this._syncState=e.SYNC_STATE_UNDEFINED,this._lastSyncTime=null,this._metaId=null,this._metaETag=null,this._fileETag=null,this._options=null,this._cacheDisabled=!1}return e.prototype.getFileName=function(){return this._fileName},e.prototype.setFileName=function(e){return exports.nbLogger("FileMetadata.setFileName(), "+this._fileName+" ---\x3e "+e),this._fileName=e,this},e.prototype.getAcl=function(){return this._acl},e.prototype.setAcl=function(e){if(null!=e&&!(e instanceof Acl))throw new Error("FileMetadata.setAcl: Not Acl instance!");return this._acl=e,this},e.prototype.getContentType=function(){return this._contentType},e.prototype.setContentType=function(e){return exports.nbLogger("FileMetadata.setContentType(), "+this._contentType+" -> "+e),this._contentType=e,this},e.prototype.getCreatedAt=function(){return this._createdAt},e.prototype._setCreatedAt=function(e){return this._createdAt=e,this},e.prototype.getUpdatedAt=function(){return this._updatedAt},e.prototype._setUpdatedAt=function(e){return this._updatedAt=e,this},e.prototype.getSize=function(){return this._fileSize},e.prototype._setSize=function(e){return this._fileSize=e,this},e.prototype.getPublicUrl=function(){return this._publicUrl},e.prototype._setPublicUrl=function(e){return this._publicUrl=e,this},e.prototype.getFileSyncState=function(){return this._syncState},e.prototype._setFileSyncState=function(e){return this._syncState=e,this},e.prototype.getLastSyncTime=function(){return this._lastSyncTime},e.prototype._setLastSyncTime=function(e){return this._lastSyncTime=e,this},e.prototype.getMetaId=function(){return this._metaId},e.prototype._setMetaId=function(e){return this._metaId=e,this},e.prototype.getMetaETag=function(){return this._metaETag},e.prototype._setMetaETag=function(e){return this._metaETag=e,this},e.prototype.getFileETag=function(){return this._fileETag},e.prototype._setFileETag=function(e){return this._fileETag=e,this},e.prototype.getOptions=function(){return this._options},e.prototype.setOptions=function(e){return this._options=e,this},e.prototype.isCacheDisabled=function(){return this._cacheDisabled},e.prototype.setCacheDisabled=function(e){return this._cacheDisabled=e,this},e.prototype._setMetadata=function(e){if(null!=e.filename&&this.setFileName(e.filename),null!=e.contentType&&this.setContentType(e.contentType),null!=e.ACL){var t=new Acl(e.ACL);this.setAcl(t)}return null!=e.length&&this._setSize(e.length),null!=e.publicUrl&&this._setPublicUrl(e.publicUrl),null!=e.createdAt&&this._setCreatedAt(e.createdAt),null!=e.updatedAt&&this._setUpdatedAt(e.updatedAt),null!=e.lastSyncTime&&this._setLastSyncTime(e.lastSyncTime),null!=e.metaId&&this._setMetaId(e.metaId),null!=e.metaETag&&this._setMetaETag(e.metaETag),null!=e.fileETag&&this._setFileETag(e.fileETag),null!=e.options&&this.setOptions(e.options),null!=e.cacheDisabled&&this.setCacheDisabled(e.cacheDisabled),null!=e.fileSyncState&&this._setFileSyncState(e.fileSyncState),this},e.SYNC_STATE_UNDEFINED=-1,e.SYNC_STATE_SYNCED=0,e.SYNC_STATE_DIRTY=1,e.SYNC_STATE_SYNCING=3,e.SYNC_STATE_CONFLICTED=5,e}();exports.FileMetadata=FileMetadata;var BaseBucket=function(){function a(e,t,r,o){void 0===o&&(o=exports.Nebula.BUCKET_MODE_ONLINE),this._service=e,this._type=r,this._name=t,this._acl=null,this._contentAcl=null,this._description=null,o!==exports.Nebula.BUCKET_MODE_ONLINE&&o!==exports.Nebula.BUCKET_MODE_REPLICA&&o!==exports.Nebula.BUCKET_MODE_LOCAL?this._mode=exports.Nebula.BUCKET_MODE_ONLINE:this._mode=o}return a._baseLoadBucket=function(l,p,g,f,e){var t;if(exports.nbLogger("BaseBucket.loadBucket(), name="+g+", type="+l+", callbacks="+e+", mode="+f),p.isOffline()){t=new _SdeRequest(a.getClassName(l),"loadBucket");var r={bucketName:g};f!==exports.Nebula.BUCKET_MODE_ONLINE&&f!==exports.Nebula.BUCKET_MODE_REPLICA&&f!==exports.Nebula.BUCKET_MODE_LOCAL&&(f=exports.Nebula.BUCKET_MODE_ONLINE),r.bucketMode=f,t.setData(r)}else{var o="/buckets/"+l+"/"+encodeURIComponent(g);(t=new HttpRequest(p,o)).setMethod("GET"),t.setContentType("application/json")}var n=t.execute().then(function(e){try{exports.nbLogger("BaseBucket.loadBucket(), success : "+e);var t=JSON.parse(e),r=t.name;if(null==r){exports.nbLogger("BaseBucket.loadBucket(), invalid bucket name, name="+r);var o=exports._createError(0,"Invalid response","",g);return Promise.reject(o)}exports.nbLogger("BaseBucket.loadBucket(), new Bucket, name="+r);var n=void 0;n="file"===l?new p.FileBucket(r):new p.ObjectBucket(r,f);var s=t.ACL;if(null!=s){exports.nbLogger("BaseBucket.loadBucket(), acl="+s);var i=new Acl;i._set(s),n.setAcl(i)}var u=t.contentACL;if(null!=u){exports.nbLogger("BaseBucket.loadBucket(), contentAcl="+u);var a=new Acl;a._set(u),n.setContentAcl(a)}var c=t.description;return null!=c&&(exports.nbLogger("BaseBucket.loadBucket(), description="+c),n.setDescription(c)),Promise.resolve(n)}catch(e){exports.nbLogger("BaseBucket.loadBucket(), error : exception"+e);var o=exports._createError(0,e,e.toString(),g);return Promise.reject(o)}},function(e){return exports.nbLogger("BaseBucket.loadBucket(), error: "+exports._errorText(e)),e.data=g,Promise.reject(e)});return exports._promisify(n,e)},a._baseGetBucketList=function(e,t,r,o){var n;if(exports.nbLogger("BaseBucket.getBucketList(), type="+e+", callbacks="+o),t.isOffline()){var s="getBucketList";r&&(s="getLocalBucketList"),n=new _SdeRequest(a.getClassName(e),s)}else{var i="/buckets/"+e;(n=new HttpRequest(t,i)).setMethod("GET"),n.setContentType("application/json")}var u=n.execute().then(function(e){try{exports.nbLogger("BaseBucket.getBucketList(), success : "+e);var t=JSON.parse(e),r=t.results;if(null!=r){exports.nbLogger("BaseBucket.getBucketList(), buckets="+r);for(var o=[],n=0,s=r;n<s.length;n++){var i=s[n];exports.nbLogger("BaseBucket.getBucketList(), success : add bucketName = "+i.name),null!=i.name?o.push(i.name):exports.nbLogger("BaseBucket.getBucketList(), [WARNING] No name in response")}return Promise.resolve(o)}exports.nbLogger("BaseBucket.getBucketList(), invalid response");var u=exports._createError(0,"Invalid response","",name);return Promise.reject(u)}catch(e){exports.nbLogger("BaseBucket.getBucketList(), error : exception"+e);var u=exports._createError(0,e,e);return Promise.reject(u)}},function(e){return exports.nbLogger("BaseBucket.getBucketList(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(u,o)},a.prototype.saveBucket=function(e){var t,r=this;if(exports.nbLogger("BaseBucket.saveBucket(), callbacks="+e),this._service.isOffline())t=new _SdeRequest(a.getClassName(this._type),"saveBucket");else{var o=this.getPath();(t=new HttpRequest(this._service,o)).setMethod("PUT"),t.setContentType("application/json")}var n={};null!=this._acl&&(n.ACL=this._acl._toJsonObject()),null!=this._contentAcl&&(n.contentACL=this._contentAcl._toJsonObject()),null!=this._description&&(n.description=this._description),this._service.isOffline()&&(n.bucketName=this.getBucketName(),n.bucketMode=this.getBucketMode()),t.setData(n),exports.nbLogger("BaseBucket.saveBucket(), body="+JSON.stringify(n));var s=t.execute().then(function(e){exports.nbLogger("success : "+e),exports.nbLogger("bucketName : "+r.getBucketName());try{exports.nbLogger("success : "+e);var t=JSON.parse(e);return null!=t.ACL&&(r._acl||(r._acl=new Acl),r._acl._set(t.ACL)),null!=t.contentACL&&(r._contentAcl||(r._contentAcl=new Acl),r._contentAcl._set(t.contentACL)),Promise.resolve(r)}catch(e){return exports.nbLogger("error : "+e),Promise.reject(e)}},function(e){return exports.nbLogger("error: "+exports._errorText(e)),e.data=r,Promise.reject(e)});return exports._promisify(s,e)},a.prototype.deleteBucket=function(e){var t,r=this;if(exports.nbLogger("BaseBucket.deleteBucket(), callbacks="+e),this._service.isOffline()){t=new _SdeRequest(a.getClassName(this._type),"deleteBucket");var o={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(o)}else{var n=this.getPath();(t=new HttpRequest(this._service,n)).setMethod("DELETE"),t.setContentType("application/json")}var s=t.execute().then(function(){return exports.nbLogger("BaseBucket.deleteBucket(), success"),r},function(e){return exports.nbLogger("BaseBucket.deleteBucket(), error: "+exports._errorText(e)),e.data=r,Promise.reject(e)});return exports._promisify(s,e)},a.prototype.setAcl=function(e){if(null!=e&&!(e instanceof Acl))throw new Error("setAcl: not Acl instance!");this._acl=e},a.prototype.getAcl=function(){return this._acl},a.prototype.setContentAcl=function(e){if(null!=e&&!(e instanceof Acl))throw new Error("setContentAcl: not Acl instance!");this._contentAcl=e},a.prototype.getContentAcl=function(){return this._contentAcl},a.prototype.setDescription=function(e){this._description=e},a.prototype.getDescription=function(){return this._description},a.prototype.getBucketName=function(){return this._name},a.prototype.setBucketName=function(e){this._name=e},a.prototype.getBucketMode=function(){return this._mode},a.prototype.getPath=function(e){var t="/buckets/"+this._type+"/"+encodeURIComponent(this._name);return null!=e&&(t+=e),t},a.prototype.getDataPath=function(e){var t="objects";"file"===this._type&&(t="files");var r="/"+t+"/"+encodeURIComponent(this._name);return null!=e&&(r+=e),r},a.getClassName=function(e){var t="NebulaObjectBucket";return"file"===e&&(t="NebulaFileBucket"),t},a.prototype.getClassName=function(){return a.getClassName(this._type)},a}(),ObjectBucket=function(n){function e(e,t,r){void 0===t&&(t=exports.Nebula.BUCKET_MODE_ONLINE),void 0===r&&(r=exports.Nebula);var o=n.call(this,r,e,"object",t)||this;return o._resolveId=null,o}return __extends(e,n),e.loadBucket=function(e,t,r){return null},e._loadBucket=function(e,t,r,o){return exports.nbLogger("ObjectBucket.loadBucket(), name="+t+", callbacks="+r),BaseBucket._baseLoadBucket("object",e,t,o,r)},e.getBucketList=function(e){return null},e._getBucketList=function(e,t){return exports.nbLogger("ObjectBucket.getBucketList(), callbacks="+t),BaseBucket._baseGetBucketList("object",e,!1,t)},e.getLocalBucketList=function(e){return null},e._getLocalBucketList=function(e,t){return exports.nbLogger("ObjectBucket.getLocalBucketList(), callbacks="+t),BaseBucket._baseGetBucketList("object",e,!0,t)},e.prototype.saveBucket=function(e){return n.prototype.saveBucket.call(this,e)},e.prototype.deleteBucket=function(e){return n.prototype.deleteBucket.call(this,e)},e.prototype.setAcl=function(e){return n.prototype.setAcl.call(this,e),this},e.prototype.getAcl=function(){return n.prototype.getAcl.call(this)},e.prototype.setContentAcl=function(e){return n.prototype.setContentAcl.call(this,e),this},e.prototype.getContentAcl=function(){return n.prototype.getContentAcl.call(this)},e.prototype.setDescription=function(e){return n.prototype.setDescription.call(this,e)},e.prototype.getDescription=function(){return n.prototype.getDescription.call(this)},e.prototype.getBucketName=function(){return n.prototype.getBucketName.call(this)},e.prototype._setBucketName=function(e){return n.prototype.setBucketName.call(this,e)},e.prototype.getBucketMode=function(){return n.prototype.getBucketMode.call(this)},e.prototype.load=function(o,e){if(exports.nbLogger("ObjectBucket.load()"),null==o)throw exports.nbError("ObjectBucket.load(), Parameter is invalid"),new Error("No objectId");var t;if(this._service.isOffline()){t=new _SdeRequest(this.getClassName(),"load");var r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:o};t.setData(r)}else{var n=this.getDataPath("/"+o);(t=new HttpRequest(this._service,n)).setMethod("GET"),t.setContentType("application/json")}var s=t.execute().then(function(t){try{var e=JSON.parse(t);return exports.nbLogger("ObjectBucket.load(), success : response="+t),Promise.resolve(e)}catch(e){exports.nbLogger("ObjectBucket.load(), error : response="+t);var r=exports._createError(0,"Invalid response from server",e);return r.data=o,Promise.reject(r)}},function(e){return exports.nbLogger("ObjectBucket.load(), error: "+exports._errorText(e)),e.data=o,Promise.reject(e)});return exports._promisify(s,e)},e.prototype.remove=function(t,e,r){if(exports.nbLogger("ObjectBucket.delete)"),null==t)throw exports.nbError("ObjectBucket.remove(), Parameter is invalid"),new Error("No objectId");var o;if(this._service.isOffline()){o=new _SdeRequest(this.getClassName(),"delete");var n={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:t};r&&(n.etag=r),o.setData(n)}else{var s=this.getDataPath("/"+t);(o=new HttpRequest(this._service,s)).setMethod("DELETE"),o.setContentType("application/json"),r&&o.setQueryParam("etag",r)}var i=o.execute().then(function(e){return exports.nbLogger("ObjectBucket.delete(), success"),t},function(e){return exports.nbLogger("ObjectBucket.delete(), error: "+exports._errorText(e)),e.objectId=t,Promise.reject(e)});return exports._promisify(i,e)},e.prototype.delete=function(e,t,r){return this.remove(e,t,r)},e.prototype.save=function(o,e){if(exports.nbLogger("ObjectBucket.save()"),!o)throw exports.nbError("ObjectBucket.save(), Parameter is invalid"),new Error("No object");var t;if(this._service.isOffline()){t=new _SdeRequest(this.getClassName(),"save");var r={object:o,bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r)}else{var n={},s=void 0,i=void 0;null!=o._id?(s=this.getDataPath("/"+o._id),i="PUT",null!=o.etag&&(n.etag=o.etag)):(s=this.getDataPath(),i="POST"),exports.nbLogger("ObjectBucket.save(), path="+s),(t=new HttpRequest(this._service,s)).setContentType("application/json"),t.setMethod(i),t.setQueryParams(n),t.setData(o)}var u=t.execute().then(function(e){try{var t=JSON.parse(e);return exports.nbLogger("ObjectBucket.save(), success"),t}catch(e){exports.nbLogger("ObjectBucket.save(), error : exception="+e);var r=exports._createError(0,"Invalid response from server",e);return r.data=o,Promise.reject(r)}},function(e){return exports.nbLogger("ObjectBucket.save(), error: "+exports._errorText(e)),e.data=o,Promise.reject(e)});return exports._promisify(u,e)},e.prototype.query=function(e,t){return this._query(e,{longQuery:this._service.ObjectBucket.useLongQuery},t)},e.prototype.longQuery=function(e,t){return this._query(e,{longQuery:!0},t)},e.prototype.queryWithCount=function(e,t){return this._query(e,{countQuery:!0,longQuery:this._service.ObjectBucket.useLongQuery},t)},e.prototype.longQueryWithCount=function(e,t){return this._query(e,{countQuery:!0,longQuery:!0},t)},e.prototype._query=function(s,e,t){var r,o;if(exports.nbLogger("ObjectBucket.query()"),e.countQuery&&(null==s&&(s=new ObjectQuery),s._setCountQuery(e.countQuery)),this._service.isOffline()){r=new _SdeRequest(this.getClassName(),"query");var n={};null!=s&&(null!=s.getClause()&&null!=s.getClause().json()&&(n.clause=s.getClause().json()),n.limit=s.getLimit(),n.skip=s.getSkipCount(),n.sort=s.getSort(),n.deleteMark=s._getDeleteMark(),n.countQuery=s._isCountQuery()),n.bucketName=this.getBucketName(),n.bucketMode=this.getBucketMode(),r.setData(n)}else e.longQuery?(o=this.getDataPath("/_query"),(r=new HttpRequest(this._service,o)).setMethod("POST"),r.setContentType("application/json"),r.setData(null!=s?s._toParamJson():{})):(o=this.getDataPath(),(r=new HttpRequest(this._service,o)).setMethod("GET"),null!=s&&r.setQueryParams(s._toParam()));var i=r.execute().then(function(e){try{var t=JSON.parse(e),r=t.results;if(exports.nbLogger("ObjectBucket.query(), success : size="+r.length),null!=s&&!0===s._isCountQuery()){var o=-1;return null!=t.count&&(o=t.count),{objects:r,count:o}}return r}catch(e){exports.nbLogger("ObjectBucket.query(), error : exception="+e);var n=exports._createError(0,e.toString(),e);return Promise.reject(n)}},function(e){return exports.nbLogger("ObjectBucket.query(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(i,t)},e.prototype._checkOfflineService=function(){if(this._service!==exports.Nebula)throw exports.nbError("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!this._service.isOffline())throw exports.nbError("ObjectBucket.setSyncScope(), supported offline mode only"),new Error("No offline mode enabled")},e.prototype.aggregate=function(e,t,r){exports.nbLogger("ObjectBucket.aggregate()");var o=this.getDataPath("/_aggregate"),n=new HttpRequest(this._service,o);n.setMethod("POST"),n.setContentType("application/json");var s={pipeline:e};null!=t&&(s.options=t),n.setData(s);var i=n.execute().then(function(e){try{var t=JSON.parse(e),r=t.results;return exports.nbLogger("ObjectBucket.aggregate(), success : size="+r.length),r}catch(e){exports.nbLogger("ObjectBucket.aggregate(), error : exception="+e);var o=exports._createError(0,e.toString(),e);return Promise.reject(o)}},function(e){return exports.nbLogger("ObjectBucket.aggregate(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(i,r)},e.prototype.setSyncScope=function(e,t){this._checkOfflineService();var r=new _SdeRequest(BaseBucket.getClassName(),"setSyncScope"),o={},n={};null!=e&&(null!=e.getClause()&&null!=e.getClause().json()&&(n.clause=e.getClause().json()),o.scope=n),o.bucketName=this.getBucketName(),o.bucketMode=this.getBucketMode(),exports.nbLogger("ObjectBucket.setSyncScope(), body="+JSON.stringify(o)),r.setData(o);var s=r.execute().then(function(e){exports.nbLogger("ObjectBucket.setSyncScope(), success : response="+e)},function(e){return exports.nbLogger("ObjectBucket.setSyncScope(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(s,t)},e.prototype.getSyncScope=function(e){this._checkOfflineService();var t=new _SdeRequest(BaseBucket.getClassName(),"getSyncScope"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){exports.nbLogger("ObjectBucket.getSyncScope(), success : response="+e);try{var t=JSON.parse(e);if(null!=t.scope){var r=null;return exports._compareObject(t.scope,{})||(r=ObjectQuery._toObjectQuery(t.scope)),exports.nbLogger("ObjectBucket.getSyncScope(), success : callback_data="+t.scope),Promise.resolve(r)}return exports.nbLogger("ObjectBucket.getSyncScope(), error : no scope property"),Promise.reject(exports._createError(0,"Invalid response - no scope property",""))}catch(e){return exports.nbLogger("ObjectBucket.getSyncScope(), error : exception="+e),Promise.reject(exports._createError(0,e.toString(),e))}},function(e){return exports.nbLogger("ObjectBucket.getSyncScope(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,e)},e.prototype.getResolveConflictPolicy=function(e){exports.nbLogger("ObjectBucket.getResolveConflictPolicy()"),this._checkOfflineService();var t=new _SdeRequest(BaseBucket.getClassName(),"getResolveConflictPolicy"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){exports.nbLogger("ObjectBucket.getResolveConflictPolicy(), success : response="+e);try{var t=JSON.parse(e);return null!=t.results?Promise.resolve(t.results):(exports.nbLogger("ObjectBucket.getResolveConflictPolicy(), error : no results"),Promise.reject(exports._createError(0,"No results","")))}catch(e){return exports.nbLogger("ObjectBucket.getResolveConflictPolicy(), error : exception="+e),Promise.reject(exports._createError(0,e.toString(),e))}},function(e){return exports.nbLogger("ObjectBucket.getResolveConflictPolicy(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,e)},e.prototype.setResolveConflictPolicy=function(e,t){if(exports.nbLogger("ObjectBucket.setResolveConflictPolicy()"),this._checkOfflineService(),null==e)throw exports.nbError("ObjectBucket.setResolveConflictPolicy(), invalid parameter: no policy"),new Error("No policy");var r=new _SdeRequest(BaseBucket.getClassName(),"setResolveConflictPolicy"),o={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),policy:e};r.setData(o);var n=r.execute().then(function(e){exports.nbLogger("ObjectBucket.setResolveConflictPolicy(), success : response="+e)},function(e){return exports.nbLogger("ObjectBucket.setResolveConflictPolicy(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(n,t)},e.prototype.removeCacheBucket=function(e){exports.nbLogger("ObjectBucket.removeCacheBucket()"),this._checkOfflineService();var t=new _SdeRequest(BaseBucket.getClassName(),"removeCacheBucket"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){exports.nbLogger("ObjectBucket.removeCacheBucket(), success : response="+e)},function(e){return exports.nbLogger("ObjectBucket.removeCacheBucket(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,e)},e.prototype.setSyncEventListener=function(e){return this._checkOfflineService(),_SdeSyncEventListener.setListener(this,e)},e.sync=function(e){return null},e._sync=function(e,t){if(exports.nbLogger("ObjectBucket.sync()"),e!==exports.Nebula)throw exports.nbError("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!e.isOffline())throw exports.nbError("ObjectBucket.sync(), supported offline mode only"),new Error("No offline mode enabled");var r=new _SdeRequest(BaseBucket.getClassName(),"sync"),o=r.execute().then(function(e){exports.nbLogger("ObjectBucket.sync(), success : response="+e)},function(e){return exports.nbLogger("ObjectBucket.sync(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,t)},e.prototype.syncBucket=function(e){exports.nbLogger("ObjectBucket.syncBucket()"),this._checkOfflineService();var t=new _SdeRequest(BaseBucket.getClassName(),"syncBucket"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){exports.nbLogger("ObjectBucket.syncBucket(), success : response="+e)},function(e){return exports.nbLogger("ObjectBucket.syncBucket(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,e)},e.prototype.resolveConflict=function(e,t){if(exports.nbLogger("ObjectBucket.resolveConflict()"),this._checkOfflineService(),null==e||null==t||null==this._resolveId)throw exports.nbError("ObjectBucket.syncObject(), invalid parameter, objectId="+e+", resolve="+t+", resolveId="+this._resolveId),new Error("No objectId/resolve/resolveId");var r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode(),objectId:e,resolveId:this._getResolveId(),resolve:t};return _SdeSyncEventListener.resolveConflict(r)},e.prototype.setIndexToLocal=function(e,t){if(exports.nbLogger("ObjectBucket.setIndexLocal()"),this._checkOfflineService(),!e)throw exports.nbError("ObjectBucket.setIndexLocal(), parameter is invalid"),new Error("No index");if(!e.index)throw exports.nbError("ObjectBucket.setIndexLocal(), index is invalid"),new Error("No index property");var r=new _SdeRequest(this.getClassName(),"setIndexToLocal");e.bucketName=this.getBucketName(),e.bucketMode=this.getBucketMode(),r.setData(e);var o=r.execute().then(function(){exports.nbLogger("ObjectBucket.setIndexLocal(), success")},function(e){return exports.nbLogger("ObjectBucket.setIndexLocal(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,t)},e.prototype.getIndexFromLocal=function(e){exports.nbLogger("ObjectBucket.getIndexLocal()"),this._checkOfflineService();var t=new _SdeRequest(this.getClassName(),"getIndexFromLocal"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){exports.nbLogger("ObjectBucket.getIndexLocal(), success");try{var t=JSON.parse(e),r=t.results;return r}catch(e){exports.nbLogger("ObjectBucket.getIndexLocal(), success : exception="+e);var o=exports._createError(0,e.toString(),e);return Promise.reject(o)}},function(e){return exports.nbLogger("ObjectBucket.getIndexLocal(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,e)},e.prototype.getLastSyncTime=function(e){exports.nbLogger("ObjectBucket.getLastSyncTime()"),this._checkOfflineService();var t=new _SdeRequest(BaseBucket.getClassName(),"getLastSyncTime"),r={bucketName:this.getBucketName(),bucketMode:this.getBucketMode()};t.setData(r);var o=t.execute().then(function(e){exports.nbLogger("ObjectBucket.getLastSyncTime(), success : response="+e);try{var t=JSON.parse(e);return null!=t.results?t.results:(exports.nbLogger("ObjectBucket.getLastSyncTime(), success : no results"),null)}catch(e){return exports.nbLogger("ObjectBucket.getLastSyncTime(), error : exception="+e),Promise.reject(exports._createError(0,e.toString(),e))}},function(e){return exports.nbLogger("ObjectBucket.getLastSyncTime(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,e)},e.prototype._getResolveId=function(){return exports.nbLogger("ObjectBucket._getResolveId(), resolveId="+this._resolveId),this._resolveId},e.prototype._setResolveId=function(e){return exports.nbLogger("ObjectBucket._setResolveId(), cur="+this._resolveId+", new="+e),this._resolveId=e},e.prototype.batch=function(e,t){var r=this.getDataPath("/_batch"),o=new HttpRequest(this._service,r);o.setMethod("POST"),o.setContentType("application/json"),o.setData(e.json);var n=o.execute().then(function(e){for(var t=JSON.parse(e),r=0,o=0,n=t.results;o<n.length;o++){var s=n[o];"ok"!==s.result&&r++}return t.failedCount=r,t},function(e){return Promise.reject(e)});return exports._promisify(n,t)},e.useLongQuery=!1,e.CONFLICT_POLICY_MANUAL=0,e.CONFLICT_POLICY_CLIENT=1,e.CONFLICT_POLICY_SERVER=2,e.RESOLVE_CONFLICT_UNDEFINED=-1,e.RESOLVE_CONFLICT_CLIENT=1,e.RESOLVE_CONFLICT_SERVER=2,e.SYNC_ERROR_UNDEFINED=-1,e.SYNC_ERROR_PUSH=0,e.SYNC_ERROR_PULL=1,e.SYNC_ERROR_OVERLAP_ID=2,e.SYNC_ERROR_PUSH_RESYNCING=3,e}(exports.BaseBucket=BaseBucket);exports.ObjectBucket=ObjectBucket,exports.declareObjectBucket=function(n){var e;n.ObjectBucket=((e=function(o){function e(e,t){return void 0===t&&(t=exports.Nebula.BUCKET_MODE_ONLINE),o.call(this,e,t,n)||this}return __extends(e,o),e.loadBucket=function(e,t,r){return o._loadBucket.call(this,n,e,t,r)},e.getBucketList=function(e){return o._getBucketList.call(this,n,e)},e.getLocalBucketList=function(e){return o._getLocalBucketList.call(this,n,e)},e.sync=function(e){return o._sync.call(this,n,e)},e}(ObjectBucket)).useLongQuery=!1,e)};var FileBucket=function(o){function i(e,t){void 0===t&&(t=exports.Nebula);var r=o.call(this,t,e,"file")||this;return r._resolveId=null,r}return __extends(i,o),i.loadBucket=function(e,t){return null},i._loadBucket=function(e,t,r){return exports.nbLogger("FileBucket.loadBucket(), name="+t+", callbacks="+r),BaseBucket._baseLoadBucket("file",e,t,exports.Nebula.BUCKET_MODE_ONLINE,r)},i.getBucketList=function(e){return null},i._getBucketList=function(e,t){return BaseBucket._baseGetBucketList("file",e,!1,t)},i.prototype.saveBucket=function(e){return o.prototype.saveBucket.call(this,e)},i.prototype.deleteBucket=function(e){return o.prototype.deleteBucket.call(this,e)},i.prototype.setAcl=function(e){return o.prototype.setAcl.call(this,e),this},i.prototype.getAcl=function(){return o.prototype.getAcl.call(this)},i.prototype.setContentAcl=function(e){return o.prototype.setContentAcl.call(this,e),this},i.prototype.getContentAcl=function(){return o.prototype.getContentAcl.call(this)},i.prototype.setDescription=function(e){return o.prototype.setDescription.call(this,e),this},i.prototype.getDescription=function(){return o.prototype.getDescription.call(this)},i.prototype.getBucketName=function(){return o.prototype.getBucketName.call(this)},i.prototype._setBucketName=function(e){return o.prototype.setBucketName.call(this,e),this},i.prototype._save=function(o,e,n,t,r){if(exports.nbLogger("FileBucket._save()"),!o)throw exports.nbLogger("FileBucket._save(), Parameter is invalid : fileName"),new Error("No fileName");if(!e)throw exports.nbLogger("FileBucket._save(), Parameter is invalid : data"),new Error("No data");if(!("undefined"!=typeof Blob&&null!==Blob||"undefined"!=typeof Buffer&&null!==Buffer))throw exports.nbLogger("FileBucket._save(), Not supported Blob nor Buffer"),new Error("No Blob/Buffer support");if(!("string"==typeof e||"undefined"==typeof Blob||null===Blob||e instanceof Blob||"undefined"==typeof Buffer||null===Buffer||Buffer.isBuffer(e)))throw exports.nbLogger("FileBucket._save(), Data is not String, Blob nor Buffer"),new Error("data is not String, Blob nor Buffer");if(!(t||n&&n.getContentType()))throw exports.nbLogger("FileBucket._save(), Parameter is invalid : metadata.contentType"),new Error("No contentType in metadata");var s=this.getDataPath("/"+encodeURIComponent(o));exports.nbLogger("FileBucket._save(), path="+s);var i=new HttpRequest(this._service,s);t?i.setMethod("PUT"):(i.setMethod("POST"),i.setContentType(n.getContentType()),null!=n.getAcl()&&i.addRequestHeader("X-ACL",n.getAcl()._toString()),null!=n.getOptions()&&i.addRequestHeader("X-Meta-Options",JSON.stringify(n.getOptions()))),i.setData(e);var u=i.execute().then(function(e){try{var t=JSON.parse(e);return null===n&&(n=new FileMetadata),n._setMetadata(t),Promise.resolve(n)}catch(e){exports.nbLogger("FileBucket._save(), success: exception="+e);var r=exports._createError(0,"Invalid response from server",e,o);return Promise.reject(r)}},function(e){return exports.nbLogger("FileBucket._save(), error: "+exports._errorText(e)),e.data=o,Promise.reject(e)});return exports._promisify(u,r)},i.prototype.saveAs=function(e,t,r,o){return this._save(e,t,r,!1,o)},i.prototype.save=function(e,t,r){return this._save(e,t,null,!0,r)},i.prototype.load=function(t,e){if(exports.nbLogger("FileBucket.load()"),null==t)throw exports.nbLogger("FileBucket.load(), Parameter is invalid : fileName"),new Error("No fileName");if(!("undefined"!=typeof Blob&&null!==Blob||"undefined"!=typeof Buffer&&null!==Buffer))throw exports.nbLogger("FileBucket.load(), Not supported Blob nor Buffer"),new Error("No Blob/Buffer support");var r=this.getDataPath("/"+encodeURIComponent(t));exports.nbLogger("FileBucket.load(), path="+r);var o=new HttpRequest(this._service,r);o.setMethod("GET"),"undefined"!=typeof Blob&&null!==Blob?o.setResponseType("blob"):"undefined"!=typeof Buffer&&null!==Buffer&&o.setResponseType("buffer");var n=o.execute().then(function(e){return e},function(e){return exports.nbLogger("FileBucket.load(), error: "+exports._errorText(e)),e.data=t,Promise.reject(e)});return exports._promisify(n,e)},i.prototype.remove=function(t,e){if(exports.nbLogger("FileBucket.delete()"),null==t)throw exports.nbLogger("FileBucket.delete(), Parameter is invalid : fileName"),new Error("No fileName");var r;if(this._service.isOffline()){r=new _SdeRequest(this.getClassName(),"delete");var o={bucketName:this.getBucketName(),fileName:t};r.setData(o)}else{var n=this.getDataPath("/"+encodeURIComponent(t));exports.nbLogger("FileBucket.delete(), path="+n),(r=new HttpRequest(this._service,n)).setMethod("DELETE")}var s=r.execute().then(function(e){return exports.nbLogger("FileBucket.delete(), success: "+t),t},function(e){return exports.nbLogger("FileBucket.delete(), error: "+exports._errorText(e)+" : "+t),e.data=t,Promise.reject(e)});return exports._promisify(s,e)},i.prototype.delete=function(e,t){return this.remove(e,t)},i.prototype._createMetadata=function(e){var t=new FileMetadata;return t._setMetadata(e),t},i.prototype._publish=function(n,e,t){var r,s=this;if(exports.nbLogger("FileBucket._publish(), fileName="+n+", setFlg="+e),null==n)throw exports.nbLogger("FileBucket._publish(), Parameter is invalid : fileName"),new Error("No fileName");if(this._service.isOffline()){r=new _SdeRequest(this.getClassName(),"publish");var o={bucketName:this.getBucketName(),fileName:n,published:e};r.setData(o)}else{var i=this.getDataPath("/"+encodeURIComponent(n)+"/publish");exports.nbLogger("FileBucket._publish(), path="+i),r=new HttpRequest(this._service,i),e?r.setMethod("PUT"):r.setMethod("DELETE")}var u=r.execute().then(function(e){exports.nbLogger("FileBucket._publish(), success: "+n);try{var t=JSON.parse(e),r=s._createMetadata(t);return Promise.resolve(r)}catch(e){exports.nbLogger("FileBucket._publish(), success: exception="+e);var o=exports._createError(0,"Invalid response from server",e);return o.data=n,Promise.reject(o)}},function(e){return exports.nbLogger("FileBucket._publish(), error: "+exports._errorText+" : "+n),e.data=n,Promise.reject(e)});return exports._promisify(u,t)},i.prototype.publish=function(e,t){return exports.nbLogger("FileBucket.publish()"),this._publish(e,!0,t)},i.prototype.unpublish=function(e,t){return exports.nbLogger("FileBucket.unpublish()"),this._publish(e,!1,t)},i.prototype._getList=function(e,t,r){var o,c=this;if(exports.nbLogger("FileBucket._getList(), published="+e),this._service.isOffline()){o=new _SdeRequest(this.getClassName(),"getList");var n={bucketName:this.getBucketName(),published:e,deleteMark:t};o.setData(n)}else{var s=this.getDataPath();exports.nbLogger("FileBucket._getList(), path="+s),(o=new HttpRequest(this._service,s)).setMethod("GET"),e&&o.setQueryParam("published","1"),t&&o.setQueryParam("deleteMark","1")}var i=o.execute().then(function(e){exports.nbLogger("FileBucket._getList(), success");try{var t=JSON.parse(e),r=t.results,o=[];if(null!=r)for(var n=0,s=r;n<s.length;n++){var i=s[n],u=c._createMetadata(i);o.push(u)}return Promise.resolve(o)}catch(e){exports.nbLogger("FileBucket._getList(), success: exception="+e);var a=exports._createError(0,"Invalid response from server",e);return Promise.reject(a)}},function(e){return exports.nbLogger("FileBucket._getList(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(i,r)},i.prototype.getList=function(e){return exports.nbLogger("FileBucket.getList()"),this._getList(!1,!1,e)},i.prototype.getPublishedList=function(e){return exports.nbLogger("FileBucket.getPublishedList()"),this._getList(!0,!1,e)},i.prototype.getMetadata=function(n,e){var t,s=this;if(exports.nbLogger("FileBucket.getMetadata(), fileName="+n),null==n)throw exports.nbLogger("FileBucket.getMetadata(), Parameter is invalid : fileName"),new Error("No fileName");if(this._service.isOffline()){t=new _SdeRequest(this.getClassName(),"getMetadata");var r={bucketName:this.getBucketName(),fileName:n};t.setData(r)}else{var o=this.getDataPath("/"+encodeURIComponent(n)+"/meta");exports.nbLogger("FileBucket.getMetadata(), path="+o),(t=new HttpRequest(this._service,o)).setMethod("GET")}var i=t.execute().then(function(t){exports.nbLogger("FileBucket.getMetadata(), success");try{var e=JSON.parse(t),r=s._createMetadata(e);return Promise.resolve(r)}catch(e){exports.nbLogger("FileBucket.getMetadata(), Invalid response : "+t);var o=exports._createError(0,"Invalid response from server",e);return o.data=n,Promise.reject(o)}},function(e){return exports.nbLogger("FileBucket.getMetadata(), error: "+exports._errorText(e)),e.data=n,Promise.reject(e)});return exports._promisify(i,e)},i.prototype.updateMetadata=function(o,n,e){if(exports.nbLogger("FileBucket.updateMetadata(), fileName="+o),null==o||""===o)throw exports.nbLogger("FileBucket.updateMetadata(), Parameter is invalid : fileName"),new Error("No fileName");if(!(n instanceof FileMetadata))throw exports.nbLogger("FileBucket.updateMetadata(), Parameter is invalid : metadata"),new Error("metadata is not instance of FileMetadata");var t,r={};if(this._service.isOffline())t=new _SdeRequest(this.getClassName(),"updateMetadata"),r.bucketName=this.getBucketName(),r.targetFileName=o,r.cacheDisabled=n.isCacheDisabled();else{var s=this.getDataPath("/"+encodeURIComponent(o)+"/meta");exports.nbLogger("FileBucket.updateMetadata(), path="+s),(t=new HttpRequest(this._service,s)).setMethod("PUT")}null!=n.getFileName()&&(r.filename=n.getFileName()),null!=n.getContentType()&&(r.contentType=n.getContentType()),null!=n.getAcl()&&(r.ACL=n.getAcl()._toJsonObject()),null!=n.getOptions()&&(r.options=JSON.stringify(n.getOptions())),t.setData(r);var i=t.execute().then(function(e){exports.nbLogger("FileBucket.updateMetadata(), success");try{var t=JSON.parse(e);return n._setMetadata(t),Promise.resolve(n)}catch(e){exports.nbLogger("FileBucket.updateMetadata(), success: exception="+e);var r=exports._createError(0,"Invalid response from server",e);return r.data=o,Promise.reject(r)}},function(e){return exports.nbLogger("FileBucket.updateMetadata(), error: "+exports._errorText(e)),e.data=o,Promise.reject(e)});return exports._promisify(i,e)},i._checkOfflineService=function(e){if(e!==exports.Nebula)throw exports.nbLogger("ObjectBucket.setSyncScope(): Can't use for multitenant instance"),new Error("No multitenant support");if(!e.isOffline())throw exports.nbLogger("ObjectBucket.setSyncScope(), supported offline mode only"),new Error("No offline mode enabled")},i.selectUploadFile=function(e){return null},i._selectUploadFile=function(e,t){exports.nbLogger("FileBucket.selectUploadFile()"),this._checkOfflineService(e);var r=new _SdeRequest(BaseBucket.getClassName("file"),"selectUploadFile"),o=r.execute().then(function(e){try{var t=JSON.parse(e);return Promise.resolve(t)}catch(e){exports.nbLogger("FileBucket.selectUploadFile(), success: exception="+e);var r=exports._createError(0,"Invalid response from server",e);return Promise.reject(r)}},function(e){return exports.nbLogger("FileBucket.selectUploadFile(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,t)},i.selectDirectory=function(e){return null},i._selectDirectory=function(e,t){exports.nbLogger("FileBucket.selectDirectory()"),this._checkOfflineService(e);var r=new _SdeRequest(BaseBucket.getClassName("file"),"selectDirectory"),o=r.execute().then(function(e){try{var t=JSON.parse(e);return Promise.resolve(t.path)}catch(e){exports.nbLogger("FileBucket.selectUploadFile(), success: exception="+e);var r=exports._createError(0,"Invalid response from server",e);return Promise.reject(r)}},function(e){return exports.nbLogger("FileBucket.selectDirectory(), error: "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(o,t)},i.prototype._uploadFile=function(o,e,n,t,r){if(exports.nbLogger("FileBucket._uploadFile()"),!this._service.isOffline())throw exports.nbLogger("FileBucket._uploadFile(), only offline mode"),new Error("No offline mode enabled");if(!o||""===o)throw exports.nbLogger("FileBucket._uploadFile(), Parameter is invalid : fileName"),new Error("No fileName");if(!e||""===e)throw exports.nbLogger("FileBucket._uploadFile(), Parameter is invalid : filePath"),new Error("No filePath");if(!n||!n.getContentType()||""===n.getContentType())throw exports.nbLogger("FileBucket._uploadFile(), Parameter is invalid : metadata"),new Error("No metadata.contentType");var s="uploadNewFile";t&&(s="uploadUpdateFile");var i=new _SdeRequest(this.getClassName(),s),u={};u.bucketName=this.getBucketName(),u.fileName=o,u.filePath=e,u.cacheDisabled=n.isCacheDisabled(),u.contentType=n.getContentType(),null!=n.getAcl()&&(u.ACL=n.getAcl()._toJsonObject()),null!=n.getOptions()&&(u.options=JSON.stringify(n.getOptions())),i.setData(u);var a=i.execute().then(function(e){try{var t=JSON.parse(e);return null===n&&(n=new FileMetadata),n._setMetadata(t),Promise.resolve(n)}catch(e){exports.nbLogger("FileBucket.uploadNewFile(), success: exception="+e);var r=exports._createError(0,"Invalid response from server",e);return r.data=o,Promise.reject(r)}},function(e){return exports.nbLogger("FileBucket.uploadNewFile(), error: "+exports._errorText(e)),e.data=o,Promise.reject(e)});return exports._promisify(a,r)},i.prototype.uploadNewFile=function(e,t,r,o){return exports.nbLogger("FileBucket.uploadNewFile()"),this._uploadFile(e,t,r,!1,o)},i.prototype.uploadUpdateFile=function(e,t,r,o){return exports.nbLogger("FileBucket.uploadUpdateFile()"),this._uploadFile(e,t,r,!0,o)},i.prototype.downloadFile=function(r,e,t){if(exports.nbLogger("FileBucket.downloadFile()"),i._checkOfflineService(this._service),!r||""===r)throw exports.nbLogger("FileBucket.downloadFile(), Parameter is invalid : fileName"),new Error("No fileName");if(!e||""===e)throw exports.nbLogger("FileBucket.downloadFile(), Parameter is invalid : filePath"),new Error("No filePath");var o=new _SdeRequest(this.getClassName(),"downloadFile"),n={bucketName:this.getBucketName(),fileName:r,filePath:e};o.setData(n);var s=o.execute().then(function(e){try{JSON.parse(e);return exports.nbLogger("FileBucket.downloadFile(), response="+e),Promise.resolve(r)}catch(e){exports.nbLogger("FileBucket.downloadFile(), success: exception="+e);var t=exports._createError(0,"Invalid response from server",e);return t.data=r,Promise.reject(t)}},function(e){return exports.nbLogger("FileBucket.downloadFile(), error: "+exports._errorText(e)),e.data=r,Promise.reject(e)});return exports._promisify(s,t)},i.prototype.requestCancel=function(r,e){if(exports.nbLogger("FileBucket.requestCancel()"),i._checkOfflineService(this._service),null==r||""===r)throw exports.nbLogger("FileBucket.requestCancel(), Parameter is invalid : fileName"),new Error("No fileName");var t=new _SdeRequest(this.getClassName(),"requestCancel"),o={bucketName:this.getBucketName(),fileName:r};t.setData(o);var n=t.execute().then(function(e){try{return exports.nbLogger("FileBucket.requestCancel(), response="+e),Promise.resolve(r)}catch(e){exports.nbLogger("FileBucket.requestCancel(), success: exception="+e);var t=exports._createError(0,"Invalid response from server",e);return t.data=r,Promise.reject(t)}},function(e){return exports.nbLogger("FileBucket.requestCancel(), error: "+exports._errorText(e)),e.data=r,Promise.reject(e)});return exports._promisify(n,e)},i}(BaseBucket);exports.FileBucket=FileBucket,exports.declareFileBucket=function(o){o.FileBucket=function(r){function e(e){return r.call(this,e,o)||this}return __extends(e,r),e.loadBucket=function(e,t){return r._loadBucket.call(this,o,e,t)},e.getBucketList=function(e){return r._getBucketList.call(this,o,e)},e.selectUploadFile=function(e){return r._selectUploadFile.call(this,o,e)},e.selectDirectory=function(e){return r._selectDirectory.call(this,o,e)},e}(FileBucket)};var CustomApi=function(){function e(e,t,r,o){void 0===o&&(o=exports.Nebula),this._service=o,this.apiname=e,this.method=t,this.subpath=r,this.headers={},this.queryParams={},this.receiveResponseHeaders=!1,this.path="/api/"+e,r&&(0!==r.indexOf("/")&&(this.path+="/"),this.path+=r)}return e.prototype.clearHeaders=function(){this.headers={}},e.prototype.setContentType=function(e){return this.contentType=e,this},e.prototype.addHeader=function(e,t){return this.headers[e]=t,this},e.prototype.addQueryParam=function(e,t){return this.queryParams[e]=t,this},e.prototype.setBinaryResponse=function(){if("undefined"!=typeof Blob&&null!==Blob)this.responseType="blob";else{if("undefined"==typeof Buffer||null===Buffer)throw new Error("No blob / buffer");this.responseType="buffer"}return this},e.prototype.setReceiveResponseHeaders=function(e){return this.receiveResponseHeaders=e,this},e.prototype.execute=function(e,t){var r=new HttpRequest(this._service,this.path);r.setMethod(this.method),r.addQueryParams(this.queryParams),e&&("GET"===this.method||"DELETE"===this.method?r.addQueryParams(e):r.setData(e)),null!=this.responseType&&r.setResponseType(this.responseType),null!=this.contentType&&r.setContentType(this.contentType);for(var o=0,n=Object.keys(this.headers);o<n.length;o++){var s=n[o];r.addRequestHeader(s,this.headers[s])}r.setReceiveResponseHeaders(this.receiveResponseHeaders);var i=r.execute().then(function(e){return exports.nbLogger("CustomApi#success"),e}).catch(function(e){return exports.nbLogger("CustomApi#error "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(i,t)},e}();exports.CustomApi=CustomApi,exports.declareCustomApi=function(n){n.CustomApi=function(o){function e(e,t,r){return o.call(this,e,t,r,n)||this}return __extends(e,o),e}(CustomApi)};var ApnsFields=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"badge",{get:function(){return this._fields.badge},set:function(e){if(!this._isInteger(e))throw new Error("ApnsFields.badge, Not integer: "+e);this._fields.badge=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._fields.sound},set:function(e){if("string"!=typeof e)throw new Error("ApnsFields.sound, Not string: "+e);this._fields.sound=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentAvailable",{get:function(){return this._fields["content-available"]},set:function(e){if(!this._isInteger(e))throw new Error("ApnsFields.contentAvailable, Not integer: "+e);this._fields["content-available"]=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"category",{get:function(){return this._fields.category},set:function(e){if("string"!=typeof e)throw new Error("ApnsFields.category, Not string: "+e);this._fields.category=e},enumerable:!0,configurable:!0}),e.prototype._isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},e}();exports.ApnsFields=ApnsFields;var GcmFields=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"title",{get:function(){return this._fields.title},set:function(e){if("string"!=typeof e)throw new Error("GcmFields.title, Invalid value: "+e);this._fields.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uri",{get:function(){return this._fields.uri},set:function(e){if("string"!=typeof e)throw new Error("GcmFields.uri, Invalid value: "+e);this._fields.uri=e},enumerable:!0,configurable:!0}),e}();exports.GcmFields=GcmFields;var SseFields=function(){function e(){this._fields={}}return Object.defineProperty(e.prototype,"eventId",{get:function(){return this._fields.sseEventId},set:function(e){if("string"!=typeof e)throw new Error("SseFields.eventId, Not string: "+e);this._fields.sseEventId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventType",{get:function(){return this._fields.sseEventType},set:function(e){if("string"!=typeof e)throw new Error("SseFields.eventType, Not string: "+e);this._fields.sseEventType=e},enumerable:!0,configurable:!0}),e}();exports.SseFields=SseFields;var PushSender=function(){function e(e){void 0===e&&(e=exports.Nebula),this._service=e}return e.prototype.send=function(e){exports.nbLogger("PushSender.send()");var t=new HttpRequest(this._service,"/push/notifications");t.setMethod("POST"),t.setContentType("application/json"),t.setData(this._toJson());var r=t.execute().then(function(e){exports.nbLogger("PushSender.send#success : response = "+e);try{return JSON.parse(e)}catch(e){exports.nbLogger("PushSender.send#error : exception="+e);var t=exports._createError(0,"Invalid response from server",e);return Promise.reject(t)}},function(e){return exports.nbLogger("PushSender.send#error = "+exports._errorText(e)),Promise.reject(e)});return exports._promisify(r,e)},e.prototype._toJson=function(){var e={};return null!=this._clause&&(e.query=this._clause.json()),null!=this._message&&(e.message=this._message),null!=this._allowedReceivers&&(e.allowedReceivers=this._allowedReceivers),null!=this._apnsFields&&this._copyKeys(this._apnsFields._fields,e),null!=this._gcmFields&&this._copyKeys(this._gcmFields._fields,e),null!=this._sseFields&&this._copyKeys(this._sseFields._fields,e),e},e.prototype._copyKeys=function(e,t){for(var r=0,o=Object.keys(e);r<o.length;r++){var n=o[r];t[n]=e[n]}},Object.defineProperty(e.prototype,"clause",{get:function(){return this._clause},set:function(e){if(!(e instanceof Clause))throw new Error("PushSender.clause, Invalid type");this._clause=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){if("string"!=typeof e)throw new Error("PushSender.message, Not string: "+e);this._message=e,exports.nbLogger("push.message = "+this._message)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowedReceivers",{get:function(){return this._allowedReceivers},set:function(e){if(!Array.isArray(e))throw new Error("PushSender.allowedReceivers, Not Array");this._allowedReceivers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apnsFields",{get:function(){return this._apnsFields},set:function(e){if(!(e instanceof ApnsFields))throw new Error("PushSender.apnsFields, Invalid instance type");this._apnsFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcmFields",{get:function(){return this._gcmFields},set:function(e){if(!(e instanceof GcmFields))throw new Error("PushSender.gcmFields, Invalid instance type");this._gcmFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sseFields",{get:function(){return this._sseFields},set:function(e){if(!(e instanceof SseFields))throw new Error("PushSender.sseFields, Invalid instance type");this._sseFields=e},enumerable:!0,configurable:!0}),e.ApnsFields=ApnsFields,e.GcmFields=GcmFields,e.SseFields=SseFields,e}();exports.PushSender=PushSender,exports.declarePushSender=function(r){r.PushSender=function(e){function t(){return e.call(this,r)||this}return __extends(t,e),t}(PushSender)};var BatchRequest=function(){function e(){this.requests=[],this.json={requests:this.requests}}return e.prototype.addInsertRequest=function(e){if(e.etag)throw new Error("ETag exists");this.requests.push({op:"insert",data:e})},e.prototype.addUpdateRequest=function(e){if(!e._id)throw new Error("No id");var t={op:"update",_id:e._id,data:{$full_update:e}};e.etag&&(t.etag=e.etag),this.requests.push(t)},e.prototype.addDeleteRequest=function(e){if(!e._id)throw new Error("No id");var t={op:"delete",_id:e._id};e.etag&&(t.etag=e.etag),this.requests.push(t)},e}();exports.BatchRequest=BatchRequest;var LocalStorageInMemory=function(){function e(){this.data={}}return e.prototype.getItem=function(e){return this.data[e]},e.prototype.setItem=function(e,t){this.data[e]=t},e.prototype.removeItem=function(e){delete this.data[e]},e}();exports.LocalStorageInMemory=LocalStorageInMemory;var NebulaConfig=function(e){if(this.offline=!1,this.allowSelfSignedCert=!1,this.debugMode="release",this.tenant=e.tenant,this.appId=e.appId,this.appKey=e.appKey,this.baseUri=e.baseUri,null==this.tenant)throw new Error("No tenant");if(null==this.appId)throw new Error("No appId");if(null==this.appKey)throw new Error("No appKey");if(null==this.baseUri)throw new Error("No baseUri");"/"===this.baseUri.slice(-1)&&(this.baseUri=this.baseUri.slice(0,-1)),void 0!==e.offline&&!0===e.offline&&(this.offline=e.offline),void 0!==e.allowSelfSignedCert&&!0===e.allowSelfSignedCert&&(this.allowSelfSignedCert=e.allowSelfSignedCert),void 0!==e.serviceId&&(this.serviceId=e.serviceId),void 0!==e.debugMode&&(this.debugMode=e.debugMode)};exports.NebulaConfig=NebulaConfig;var NebulaService=function(){function o(){this.BUCKET_MODE_ONLINE=0,this.BUCKET_MODE_REPLICA=1,this.BUCKET_MODE_LOCAL=2,exports.declareUser(this),exports.declareGroup(this),exports.declareObjectBucket(this),exports.declareFileBucket(this),exports.declareCustomApi(this),exports.declarePushSender(this),this.NebulaService=o,this.HttpRequest=HttpRequest,this.AclPermission=exports.AclPermission,this.AclGroup=exports.AclGroup,this.Acl=Acl,this.RegexOption=exports.RegexOption,this.Clause=Clause,this.ObjectQuery=ObjectQuery,this.FileMetadata=FileMetadata,this.BatchRequest=BatchRequest,this.AccountLink=AccountLink,this._SdeRequest=_SdeRequest,this._SdeNetworkEventListener=_SdeNetworkEventListener,this._SdeSyncEventListener=_SdeSyncEventListener}return o.prototype.getRestApiVersion=function(){return 1},o.prototype.getTenantID=function(){return void 0===this._config?null:this._config.tenant},o.prototype.getBaseUri=function(){return void 0===this._config?null:this._config.baseUri},o.prototype.getAppID=function(){return void 0===this._config?null:this._config.appId},o.prototype.getAppKey=function(){return void 0===this._config?null:this._config.appKey},o.prototype.setAppKey=function(e){if(!this._config)throw new Error("Not initialized");return this._config.appKey=e,this},o.prototype.getServiceID=function(){return void 0===this._config?null:this._config.serviceId},o.prototype.getDebugMode=function(){return void 0===this._config?null:this._config.debugMode},o.prototype.isOffline=function(){return this._config.offline},o.prototype.isAllowSelfSignedCert=function(){return this._config.allowSelfSignedCert},o.prototype.setClientCertificate=function(e){return this._config.clientCertOptions=e,this},o.prototype.isClientCertSet=function(){return null!=this._config.clientCertOptions},o.prototype.getCurrentUser=function(){var e=this._localStorage.getItem(this._userItemKey());if(!e)return null;try{var t=JSON.parse(e);return"expire"in t&&!(t.expire<(new Date).getTime()/1e3)||(t=null),t}catch(e){return exports.nbLogger("Nebula.getCurrentUser#"+e.message),null}},o.prototype.setCurrentUser=function(e){var t={_id:e._id,username:e.username,email:e.email,sessionToken:e.sessionToken,expire:e.expire,options:e.options,groups:e.groups};return this._localStorage.setItem(this._userItemKey(),JSON.stringify(t)),this},o.prototype.setSessionToken=function(e){var t=(new Date).getTime()/1e3+31536e5,r=this.getCurrentUser();return null===r?r={_id:"",username:"",email:"",sessionToken:e,expire:t,options:{},groups:[]}:(r.sessionToken=e,r.expire=t),this._localStorage.setItem(this._userItemKey(),JSON.stringify(r)),this},o.prototype.removeCurrentUser=function(){return this._localStorage.removeItem(this._userItemKey()),this},o.prototype._userItemKey=function(){var e=this.getServiceID();return void 0!==e?this.getTenantID()+"_"+this.getAppID()+"_"+e:this.getTenantID()+"_"+this.getAppID()},o.prototype.initialize=function(e){var t=this;if(this._config=new NebulaConfig(e),this._localStorage=void 0!==localStorage&&null!=localStorage?localStorage:new LocalStorageInMemory,this._config.offline){if(this!==exports.Nebula)throw new Error("No offline mode supported for multi-tenant instance.");try{var r=new _SdeRequest("Nebula","initialize"),o={tenant:this.getTenantID(),appId:this.getAppID(),appKey:this.getAppKey(),baseUri:this.getBaseUri(),offline:this.isOffline(),allowSelfSignedCert:this.isAllowSelfSignedCert(),debugMode:this.getDebugMode()};r.setData(o),r.execute().then(function(e){exports.nbLogger("Nebula.initialize#Success"),exports.nbLogger("Nebula.initialize#response = "+e)}).catch(function(e){exports.nbLogger("Nebula.initialize#Error = "+exports._errorText(e)),t._config.offline=!1})}catch(e){exports.nbLogger("Nebula.initialize#"+e.message),this._config.offline=!1}}return this},o.prototype.setLoginCacheValidTime=function(e,t){if(exports.nbLogger("Nebula.setLoginCacheValidTime#start"),e<=0)throw new Error("Nebula.setLoginCacheValidTime: bad expire");if(!this.isOffline())throw new Error("Not offline mode!");var r=new _SdeRequest("Nebula","setLoginCacheValidTime"),o={expire:e};r.setData(o);var n=r.execute().then(function(){exports.nbLogger("Nebula.setLoginCacheValidTime#Success")}).catch(function(e){return exports.nbLogger("Nebula.setLoginCacheValidTime#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("Nebula.setLoginCacheValidTime#end"),exports._promisify(n,t)},o.prototype.getLoginCacheValidTime=function(e){if(exports.nbLogger("Nebula.getLoginCacheValidTime#start"),!this.isOffline())throw new Error("Not offline mode!");var t=new _SdeRequest("Nebula","getLoginCacheValidTime"),r=t.execute().then(function(e){var t;exports.nbLogger("Nebula.getLoginCacheValidTime#Success");try{t=JSON.parse(e)}catch(e){exports.nbError("Nebula.getLoginCacheValidTime#"+e.message),t=null}if(null!==t)return Promise.resolve(t.expire);var r=exports._createError(400,"Bad Response","Response json error.");return Promise.reject(r)}).catch(function(e){return exports.nbLogger("Nebula.getLoginCacheValidTime#error callback start"),exports.nbLogger("Nebula.getLoginCacheValidTime#error = "+exports._errorText(e)),Promise.reject(e)});return exports.nbLogger("Nebula.getLoginCacheValidTime#end"),exports._promisify(r,e)},o.prototype.setNetworkEventListener=function(e){exports.nbLogger("Nebula.setNetworkEventListener#start");var t=!1;if(1===arguments.length&&(null!=e&&void 0!==e.onNetworkStateChanged&&(t=!0),null===e&&(t=!0)),t)return this.isOffline()?_SdeNetworkEventListener.setCallback(e):exports.nbLogger("Nebula.setNetworkEventListener#Disabled Offline"),exports.nbLogger("Nebula.setNetworkEventListener#end"),this;exports.nbError("Nebula.setNetworkEventListener#invalid parameter.")},o.prototype.setHttpProxy=function(e){var t=null;null!=e&&(o.verifyProxy(e),t=exports._node_require("tunnel").httpOverHttp({proxy:e})),HttpRequest.setProxy(e),HttpRequest.setHttpAgent(t)},o.prototype.setHttpsProxy=function(e,t){var r=null;null!=e&&(null==t&&(t={}),t.proxy=e,o.verifyProxy(e),(r=exports._node_require("tunnel").httpsOverHttp(t)).defaultPort=443),HttpRequest.setProxy(e),HttpRequest.setHttpsAgent(r,t)},o.verifyProxy=function(e){if("object"!=typeof e)throw new Error("Bad proxy: not object");if(null==e.host||"string"!=typeof e.host)throw new Error("Bad proxy: host");if(null==e.port||"number"!=typeof e.port)throw new Error("Bad proxy: port")},o}();exports.NebulaService=NebulaService,exports.initHttpXhr(),exports.initHttpNode(),exports.Nebula=new NebulaService}).call(xv,zv,Av),"undefined"!=typeof module&&void 0!==module.exports&&"undefined"!=typeof process&&"undefined"!=typeof require?module.exports=Av:xv.Nebula=Av.Nebula}(this);
//# sourceMappingURL=baas.min.js.map
